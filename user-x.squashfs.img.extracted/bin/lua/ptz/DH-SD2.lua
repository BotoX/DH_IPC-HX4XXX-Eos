-- 这是雅安3D协议,已调好，但辅助开关无效
local Protocol = {};

-- 表示数值可以用16或10进制(最小值，最大值)
Protocol.Attr = 
{
	-- 协议的显示名称,不能超过16字符，目前暂不支持中文
	Name = "DH-SD2",	
		
	-- 指明是云台协议还是矩阵协议，使用"PTZ", "MATRIX"表示
	Type = "PTZ",
	
	-- 以ms为单位
	Internal = 400,
				
	-- 没有对应的地址范围，请都设成0xff
	-- 云台地址范围
	CamAddrRange 		= {0x00, 0xFF}, 
	-- 监视地址范围
	MonAddrRange		= {0x00, 0xFF},	
	-- 预置点范围
	PresetRange 		= {0x00, 0xff},
	-- 自动巡航线路范围
	TourRange			= {0x00, 8},
	-- 轨迹线路范围
	PatternRange		= {0x00, 4},
	-- 垂直速度范围
	TileSpeedRange 		= {0x01, 0xFF},
	-- 水平速度范围
	PanSpeedRange 		= {0x01, 0xFF},
	-- 自动扫描范围
	ScanRange 			= {0x01, 5},
	
	-- 辅助范围
	AuxRange 			= {0x01, 0xFF},
}

Protocol.CommandAttr =
{
	-- 协议中需要更改的位置，用LUA下标表示，即下标从１开始,用10进制表示
	AddrPos 		= 2, 
	PresetPos 		= 5, 
	TileSpeedPos 	= 5,
	PanSpeedPos 	= 4,
	AuxPos 			= 5,
}

Protocol.Command = 
{
	-- 写具体协议时只能用16进制或字符表示,没有的话就注释掉
	Start= 
	{
		--写上下左右, 左上，左下，右上，右下
		TileUp 		= "0xA5, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00,",
		TileDown 	= "0xA5, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00,",
		PanLeft 	= "0xA5, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00,", 
		PanRight 	= "0xA5, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,",
		LeftUp 		= "0xA5, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x00,",
		LeftDown 	= "0xA5, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00,",
		RightUp		= "0xA5, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00,",
		RightDown 	= "0xA5, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00,",

		ZoomWide 	= "0xA5, 0x00, 0x42, 0x00, 0x00, 0x00, 0x00",
		ZoomTele 	= "0xA5, 0x00, 0x41, 0x00, 0x00, 0x00, 0x00",
		FocusNear	= "0xA5, 0x00, 0x48, 0x00, 0x00, 0x00, 0x00",
		FocusFar 	= "0xA5, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00",
		IrisSmall 	= "0xA5, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00",
		IrisLarge 	= "0xA5, 0x00, 0x50, 0x00, 0x00, 0x00, 0x00",
			
		-- 翻转
		Flip 		= "0xA5, 0x00, 0x87, 0x00, 0x0A, 0x00, 0x00",
		Reset 		= "0xA5, 0x00, 0x87, 0x00, 0x0B, 0x00, 0x00",	
			
		-- 灯光
		--LightOn		= "0xff, 0x01, 0x88, 0x00, 0x00, 0x00, 0x00",
		--LightOff  	= "0xff, 0x01, 0x08, 0x00, 0x00, 0x00, 0x00",
			
		-- 预置点操作（设置，清除，转置)
		SetPreset 	= "0xA5, 0x00, 0x81, 0x00, 0x00, 0x00, 0x00",
		--ClearPreset	= "0xA5, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00",
		GoToPreset 	= "0xA5, 0x00, 0x83, 0x00, 0x00, 0x00, 0x00",			
			
		AutoPanOn		= "0xA5, 0x00, 0x83, 0x01, 0x62, 0x00, 0x00",
		AutoPanOff		= "0xA5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00",
		
		SetLeftLimit 	= "0xA5, 0x00, 0x81, 0x00, 0x51, 0x00, 0x00",
		SetRightLimit	= "0xA5, 0x00, 0x81, 0x00, 0x52, 0x00, 0x00", 
		AutoScanOn 		= "0xA5, 0x00, 0x83, 0x00, 0x5b, 0x00, 0x00,",
		AutoScanOff		= "0xA5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00",
			
		-- 自动巡航，一般指在预置点之间巡航

		AddTour 		= "0xA5, 0x00, 0x84, 0x00, 0x00, 0x00, 0x00",
		DeleteTour 		= "0xA5, 0x00, 0x82, 0x00, 0x00, 0x00, 0x00",
		StartTour 		= "0xA5, 0x00, 0x83, 0x00, 0x63, 0x00, 0x00",
		StopTour 		= "0xA5, 0x00, 0x83, 0x00, 0x5a, 0x00, 0x00",
		--ClearTour		= "0xff, 0x01, 0x00, 0x1D, 0x00, 0x00, 0x00",

			
		-- 轨迹巡航, 一般指模式(设置开始，设置结束，运行，停止，清除模式
		SetPatternStart = "0xA5, 0x00, 0x85, 0x00, 0x01, 0x00, 0x00",
		SetPatternStop 	= "0xA5, 0x00, 0x85, 0x00, 0x02, 0x00, 0x00",
		StartPattern 	= "0xA5, 0x00, 0x85, 0x00, 0x00, 0x00, 0x00",
		StopPattern	= "0xA5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00",
		--ClearPattern 	= "0xff, 0x01, 0x00, 0x1D, 0x00, 0x00, 0x00",
		
		AuxOn 	= "0xA5, 0x00, 0x87, 0x00, 0x00, 0x00, 0x00",
		AuxOff 	= "0xA5, 0x00, 0x88, 0x00, 0x00, 0x00, 0x00",
		
		-- 对于特殊的命令，可以自己定义特定信息，利用这个特定信息来处理
		Position = "0xA5, 0x00, 0x90, 0x00, 0x00, 0x00, 0x00",	

	},
	Stop = 
	{
		TileUp 		= "0xA5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00",
		TileDown 	= "0xA5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00",
		PanLeft 	= "0xA5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00",
		PanRight 	= "0xA5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,",
		LeftUp 		= "0xA5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,",
		LeftDown 	= "0xA5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,",
		RightUp		= "0xA5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,",
		RightDown 	= "0xA5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,",
		
		ZoomWide 	= "0xA5, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00,",
		ZoomTele 	= "0xA5, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00,",
		FocusNear = "0xA5, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00,",
		FocusFar 	= "0xA5, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00,",
		IrisSmall = "0xA5, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00,",
		IrisLarge = "0xA5, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00,",
	},
}

Protocol.Checksum = function (s)
		s[7] = math.mod((s[1] + s[2] + s[3] + s[4] + s[5] + s[6]), 256);
	return s;
end;

Protocol.MultipleProcess = function(s, multi)
	if s[3] == 0x48 or s[3] == 0x44 then
		--聚焦倍数
		s[4] = multi * 2;
		if s[4] ~= 0 then
			s[4] = s[4] -1;
		end;
	elseif s[3]== 0x42 or s[3] == 0x41 then
	 	s[5] = multi * 2;
	 	if s[5] ~= 0 then
			s[5] = s[5] -1;
		end;
	end;
	return s;
end;

Protocol.SetTourProcess = function(s, tour, preset)
		s[4] = tour;
		s[5] = preset;
	return s;
end;

Protocol.TourProcess = function(s, tour)
		s[4] = tour;
	return s;	
end;

Protocol.PatternProcess = function(s, num)
		s[4] = num;
	return s;	
end;

--[[
协议里左上为正，右下为负，而传进来的值刚好相反，zoom的最高位表示放大还是缩小
--]]
Protocol.PositionProcess = function(s, hor, ver, zoom)
	-- 下面只处理快速定位功能

	local max_pos_zoom = 16;
	if hor >= 0 then
		s[4] = 64 + math.floor(32 * hor / 8192);
	else
		s[4] = math.floor(32 * math.abs(hor) / 8192);
	end;
	s[5] = 0;

	if ver < 0 then
		s[5] = 64 + math.floor(32 * math.abs(ver) / 8192);
	else
		s[5] = math.floor(32 * ver / 8192);
	end;
	
	if zoom <= 0 then
		s[6] = 0;
	else
		if math.abs(zoom) > max_pos_zoom then
			s[6] = max_pos_zoom / 4; 
		else		
				s[6] = math.floor(math.abs(zoom)/4);
		end;
	end
	
	return s;
end;

--[[
下面的函数是可选的，除非有特殊处理过程才打开，没有的话，千万不要打开，否则会造成解析出错
Protocol.MonAddrProcess = function(s, addr)
	return s;
end;

Protocol.SpeedProcess = function(s, arg1, arg2)
	return s;
end;

Protocol.PresetProcess = function(s, arg)
	return s;
end;
--]]


return Protocol;