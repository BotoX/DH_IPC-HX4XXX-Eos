!function(a){define(function(require,b,c){function d(b){var c=this;c.e=a(b).empty().append(h).translation()}function e(){var b=0;return a.when(f.get("LensControl"),f.get("LensControlMix"),f.get("smallPtz")).then(function(a,c,d){return b=a&&a.Support?2:d&&d.Support?4:c&&c.Support?3:webApp.CHANNEL_NUMBER>1&&-1===webApp.DeviceType.indexOf("SD")?1:webApp.CHANNEL_NUMBER>1&&-1!==webApp.DeviceType.indexOf("SD")?5:1===webApp.CHANNEL_NUMBER&&-1!==webApp.DeviceType.indexOf("SD")?6:0})}var f=require("../ability"),g=require("../rpc"),h=require("./minPtzControl.html");a.fn.minPtzControl=function(){var b=arguments[0],c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],e=this;return this.each(function(){var f=a(this),g=f.data("minPtzControl");if(g||f.data("minPtzControl",g=new d(f,b)),"string"===a.type(b)&&a.isFunction(g[b])){var h=g[b].apply(g,c);if(void 0!==h)return e=h,!1}}),e},d.prototype.init=function(b){var c=this;if(c.options=a.extend({},b),e().done(function(a){c.type=a}),c.$("a[boatCmd]").mousedown(function(a){var b=c.$(a.target).addClass("mouse-down");return g.PTZ.start(b.attr("boatCmd"),c.$("#mptz_step").val()-0,0,0),!1}).mouseup(function(a){var b=c.$(a.target).removeClass("mouse-down");return g.PTZ.stop(b.attr("boatCmd"),c.$("#mptz_step").val()-0,0,0),!1}).mouseover(function(a){var b=c.$(a.target);return b.parent().addClass("ui-boat-current-"+b.attr("boatCmd").toLowerCase()),!1}).mouseout(function(a){var b=c.$(a.target),d=b.attr("boatCmd");return b.parent().removeClass("ui-boat-current-"+d.toLowerCase()),b.hasClass("mouse-down")?(b.removeClass("mouse-down"),g.PTZ.stop(d,c.$("#mptz_step").val()-0,0,0),!1):!1}),c.$("a[cmd]").on("mousedown",function(b){var d=c.$(b.currentTarget),e=c.$("#mptz_step").val()-0,f=0,h=d.attr("cmd"),i=!0,j=0,k=0,l=!1;if(-1===a.inArray(h,["ZoomWide","ZoomTele","FocusFar","FocusNear"])||1!==c.type&&2!==c.type&&(3!==c.type&&4!==c.type||1!==plugin.windowId))if(-1!==a.inArray(h,["IrisSmall","IrisLarge"])&&1===c.type){var m=-1;"IrisLarge"===h&&(m=1);var n=g.DevVideoInput.adjustIris(m,plugin.windowId)}else var n=g.PTZ.start(h,e,f,0);else{switch(i=!1,l=!1,h){case"ZoomWide":k=-1,j=-.5;break;case"ZoomTele":k=-1,j=.5;break;case"FocusFar":k=-.5,j=-1;break;case"FocusNear":k=.5,j=-1;break;default:k=-1,j=-1}if(4===c.type||1===c.type)var n=g.DevVideoInput.adjustFocusContinuously(k,j,plugin.windowId);else setTimeout(function(){if(i){var a=g.DevVideoInput.adjustFocus(k,j,plugin.windowId);a.done(function(){var a=-1===k?-1:0,b=-1===j?-1:0;g.DevVideoInput.adjustFocus(a,b,plugin.windowId)}),l=!0}else{var a=g.DevVideoInput.adjustFocusContinuously(k,j,plugin.windowId);l=!0}},200)}d.on("mouseup mouseout",function(){if(i=!0,d.off("mouseup mouseout"),-1!==a.inArray(h,["ZoomWide","ZoomTele","FocusFar","FocusNear"])&&(1===c.type||2===c.type||(3===c.type||4===c.type)&&1===plugin.windowId)){var b=-1===k?-1:0,m=-1===j?-1:0;return void(4===c.type||1===c.type?g.DevVideoInput.adjustFocusContinuously(b,m,plugin.windowId):l&&g.DevVideoInput.adjustFocusContinuously(b,m,plugin.windowId))}return-1!==a.inArray(h,["IrisSmall","IrisLarge"])&&1===c.type?void g.DevVideoInput.adjustIris(0,plugin.windowId):void n.done(function(){g.PTZ.stop(h,e,f,0)})})}),f.get("PTZCaps").done(function(a){a&&(a.Zoom===!1&&c.$("#mptz_zoom_wrap").remove(),a.Focus===!1&&c.$("#mptz_focus_wrap").remove(),a.Iris===!1&&c.$("#mptz_iris_wrap").remove(),1===c.type&&(c.$("#mptz_zoom_wrap").show(),c.$("#mptz_focus_wrap").show(),c.$("#mptz_iris_wrap").show()))}),-1===webApp.DeviceType.indexOf("SD")&&-1===webApp.DeviceType.indexOf("TPC"))return c.$("#miniPtzBoat").css("visibility","hidden"),c.$("#miniPtzStep").css("visibility","hidden"),c.$("#miniPtzAdjust").css("visibility","hidden"),!1;if(-1!==webApp.DeviceType.indexOf("SD_CA_ICT"))c.$("#miniPtzBoat").css("visibility","hidden"),c.$("#miniPtzStep").css("visibility","hidden");else if(-1!==webApp.DeviceType.indexOf("TPC")){if(1===webApp.CHANNEL_NUMBER&&-1===webApp.DeviceType.indexOf("SD"))return c.$("#miniPtzBoat").css("visibility","hidden"),c.$("#miniPtzStep").css("visibility","hidden"),c.$("#miniPtzAdjust").css("visibility","hidden"),!1;webApp.CHANNEL_NUMBER>1&&-1===webApp.DeviceType.indexOf("SD")&&(c.$("#miniPtzBoat").css("visibility","hidden"),c.$("#miniPtzStep").css("visibility","hidden"))}},d.prototype.$=function(a){return this.e.find(a)},d.prototype.changeChannel=function(a){var b=this;(1===b.type||6===b.type)&&(a?b.$("#miniPtzAdjust").hide():b.$("#miniPtzAdjust").show())},d.prototype.togglePTZ=function(a){var b=this;b.$("#miniPtzBoat,#miniPtzStep,#miniPtzAdjust").toggle(!!a)},c.exports=d})}(jQuery);