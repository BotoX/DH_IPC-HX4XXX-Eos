!function(a){define(function(require,b,c){function d(b,c){var d=this;d.options=a.extend({},r,c),d.e=a(b).empty().append(o).translation(),d.init()}function e(b){var c=a(b.target);c.siblings(".current").removeClass("current"),c.addClass("current");var d=c.attr("data-for")-0,e=c.attr("id");g(e),n.SetFeInstallMode(d),a("#fisheyeOCX_playMode li:first").click()}function f(b){var c=a(b.target);c.siblings(".current").removeClass("current"),c.addClass("current");var d=c.attr("data-for")-0;n.SetFeShowMode(d),0==d?this.options.openIVS():this.options.closeIVS()}function g(b){a("#fisheyeOCX_playMode li").each(function(c,d){a(d).attr("support-for").indexOf(b)>-1?a(d).show():a(d).hide()})}function h(){switch(n.SetFisheyeParamsEx(0,0,0,0,0,0),t.calibrateMode){case"Single":t.currFishModel=8;break;case"FourEPtzRegion":t.currFishModel=10;break;case"OriginalPlusThreeEPtzRegion":t.currFishModel=4;break;case"Original":t.currFishModel=0;break;case"Panorama":t.currFishModel=5;break;case"DoublePanorama":t.currFishModel=3;break;case"Normal":t.currFishModel=0;break;case"TwoEPtzRegion":t.currFishModel=9}i()}function i(){q.DevVideoInput.getFishEyeWinInfo([1,2,3,4]).done(function(b){var c=t.FishEye[0].Position[t.calibrateMode],d=b;a.each(d,function(b,d){n.SetFisheyeParamsEx(d.winID,d.focusX,d.focusY,d.hAngle,d.vAngle,t.currFishModel),c&&a.each(c,function(a,b){return b.WinID==d.winID?(b.X=d.focusX,b.Y=d.focusY,!1):void 0})})})}function j(a,b,c,d,e){t.currFishWinID=a,b==d||c==e?m("TapView",b,c):m("ShowRegion",parseInt((d+b)/2),parseInt((c+e)/2),d-b,e-c)}function k(a,b,c,d,e){3===b&&(e>0?m("ZoomIn",5):m("ZoomOut",5))}function l(a,b,c,d,e,f){if(t.currFishWinID=a,0==b&&0==c&&0==d&&0==e)return void(1===f&&i());var g=t.calibrateMode,h=t.FishEye[0].Position;if(h[g]){for(var j=null,k=0;k<h[g].length;k++)if(h[g][k].WinID===t.currFishWinID){j=h[g][k];break}j?(j.X=b,j.Y=c,j.HorizontalAngle=d,j.VerticalAngle=e):h[g].push({WinID:a,X:b,Y:c,HorizontalAngle:d,VerticalAngle:e})}else h[g]=[],h[g].push({WinID:a,X:b,Y:c,HorizontalAngle:d,VerticalAngle:e});q.ConfigManager.setConfig("FishEye",t.FishEye).done(function(){1===f&&i()})}function m(a,b,c,d,e){b=b||0,c=c||0,d=d||0,e=e||0,q.DevVideoInput.setFishEyeEPtz(t.currFishWinID,a,b,c,d,e),"TapView"!==a&&i()}var n=require("../plugin"),o=require("./fishEye.html"),p=require("../ability"),q=require("../rpc"),r=null,s=null,t={currFishWinID:1};a.fn.fishEye=function(){var b=arguments[0],c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],e=this;return this.each(function(){var f=a(this),g=f.data("fishEye");if(g||f.data("fishEye",g=new d(f,b)),"string"===a.type(b)&&a.isFunction(g[b])){var h=g[b].apply(g,c);if(void 0!==h)return e=h,!1}}),e},d.prototype.init=function(){var a=this;n.LoadFisheyeModule(),p.get("VideoInputCapsEx").done(function(b){s=b.VideoInFishEye,"180CeilMode"==b.VideoInFishEye.MountMode[0]&&(a.$("#WallMode").addClass("current"),a.$("#fisheyeOCX_fitMode, .fisheye_fit").hide())}),a.$("#fisheyeOCX_fitMode").delegate("li","click",e),a.$("#fisheyeOCX_playMode").delegate("li","click",function(b){f.call(a,b)})},d.prototype.render=function(){var a=this;n.addEvent("RegionChanged",j),n.addEvent("MousePtzEvent",k),n.addEvent("FisheyeParamsEx",l),q.ConfigManager.getConfig("VideoInOptions").done(function(b){a.config=b[0].FishEye||{CalibrateMode:"Original",PlaceHolder:1},"Original"==a.config.CalibrateMode&&"Chip"!=s.Type?(a.options.pluginMode(),n.ControlFe(!0),a.renderPlugin(),webApp.hideIVS=!1):(a.options.chipMode(),a.renderChip(),webApp.hideIVS=!0)})},d.prototype.renderPlugin=function(){var a=this;fitTarget=a.$("#fisheyeOCX_fitMode li[data-for = "+a.config.PlaceHolder+"]"),fitTarget.click()},d.prototype.renderChip=function(){var a=this;q.ConfigManager.getConfig("FishEye").done(function(b){t.FishEye=b,q.ConfigManager.setConfig("FishEye",t.FishEye).done(function(){t.calibrateMode=a.config.CalibrateMode,h()})})},d.prototype.leave=function(){var a=this;a.config&&"Original"==a.config.CalibrateMode?(n.SetFeShowMode(0),n.ControlFe(!1),a.options.openIVS()):n.SetFisheyeParamsEx(0,0,0,0,0,0),n.addEvent("RegionChanged",null),n.addEvent("MousePtzEvent",null),n.addEvent("FisheyeParamsEx",null)},d.prototype.$=function(a){return this.e.find(a)},c.exports=d})}(jQuery);