!function(a){define(function(require,b,c){function d(b,c){var d=this;d.options=a.extend({},l,c),d.e=a(b),d.e.empty().append(a(i).siblings("[zf-type="+d.options.type+"]")).translation(),a.when(g.get("VideoInputCapsEx"),g.get("VideoInputCaps")).done(function(a,b){var c=d.$("#zf_title"),e="w_zoomFocus";a&&a.VideoInFocus&&a.VideoInFocus.SupportFocusRegion?d.$("#zf_Region").show():d.$("#zf_Region").hide(),a&&a.ABFFunction.Support&&(e="W_focus",d.$("#zf_zoom").hide(),d.$("[name=desc]").hide()),b&&b.SyncFocus&&(e="W_zoom",d.$("#zf_focus").hide(),d.$("#zff_AutoFocus").hide(),d.$("[name=desc]").hide()),c.attr("t",e).parent().translation()}),d.init()}function e(a,b){void 0===b&&(b=!0),a.prop("disabled",b),b?a.addClass("disabled"):a.removeClass("disabled")}var f=require("../plugin"),g=require("../ability"),h=require("../rpc"),i=require("./zoomFocus.html");require("widget/js/dui.slider");var j,k,l={type:"setting"};a.fn.zoomFocus=function(){var b=arguments[0],c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],e=this;return this.each(function(){var f=a(this),g=f.data("zoomFocus");if(g||f.data("zoomFocus",g=new d(f,b)),"string"===a.type(b)&&a.isFunction(g[b])){var h=g[b].apply(g,c);if(void 0!==h)return e=h,!1}}),e},d.prototype.init=function(){var b=this;b.b_zoom=!1,b.b_focus=!1,b.b_autofocus=!1,b.initSlider=h.DevVideoInput.getFocusStatus().always(function(a){j=a.ZoomMotorSteps||2e3,k=a.FocusMotorSteps||2e3,b.$("#zfz_slider").slider({prompt:!1,min:0,max:j,change:function(){b.b_zoom=!0,b.b_autofocus=!1},complete:function(a,c){b.b_zoom=!0,b.b_autofocus=!1,b.$("#zfz_slider").slider("disable"),h.DevVideoInput.adjustFocus(b.$("#zff_slider").slider("value")/k,c.value/j).done(function(){window.setTimeout(function(){b.getStatusByRPC()},500)})},start:function(a,b){h.DevVideoInput.adjustFocusContinuously(-1,"add"===b.oper?.032:-.032)},end:function(){h.DevVideoInput.adjustFocusContinuously(-1,0)}}),b.$("#zff_slider").slider({prompt:!1,min:0,max:k,change:function(){b.b_focus=!0,b.b_autofocus=!1},complete:function(a,c){function d(){b.b_focus=!0,b.b_autofocus=!1,b.$("#zfz_slider").slider("disable"),h.DevVideoInput.adjustFocus(c.value/k,b.$("#zfz_slider").slider("value")/j).done(function(){window.setTimeout(function(){b.getStatusByRPC()},500)})}b.b_focus||b.b_zoom?h.DevVideoInput.stopAutoFocus().done(d):d()},start:function(a,c){function d(){h.DevVideoInput.adjustFocusContinuously("add"===c.oper?.02:-.02,-1)}b.b_focus||b.b_zoom?h.DevVideoInput.stopAutoFocus().done(d):d()},end:function(){h.DevVideoInput.adjustFocusContinuously(0,-1)}})}),b.$(".u-tab").tab(),b.$("#zfz_step").on("change",function(){return b.$("#zfz_slider").slider("step",a(this).val()-0),!1}),b.$("#zff_step").on("change",function(){return b.$("#zff_slider").slider("step",a(this).val()-0),!1}),b.$("#zff_AutoFocus").on("click",function(){return b.$(this).prop("disabled")?!1:(h.DevVideoInput.autoFocus(),!1)}),b.$("#zf_Refresh").on("click",function(){return b.$(this).prop("disabled")?!1:(b._getStatus(),!1)}),b.$("#zf_Restory").on("click",function(){return b.$(this).prop("disabled")?!1:(b.$("#zfz_step").val(20).change(),b.$("#zff_step").val(20).change(),h.DevVideoInput.adjustFocus(-1,-1),!1)}),b.$("#zf_Region").on("click",function(){var a=b.$(this);return a.prop("disabled")?!1:(f.activeLocalFocus(a),!1)})},d.prototype.render=function(){var a=this;a.initSlider.always(function(){f.addEvent("FocusZoomStatus",function(b,c,d){(!a.b_zoom&&!a.b_focus||"Normal"!==d||a.b_autofocus)&&(!a.b_zoom&&a.$("#zfz_slider").slider("value",c*j,!1),!a.b_focus&&a.$("#zff_slider").slider("value",b*k,!1),"Normal"===d?(a.b_zoom=!1,a.b_focus=!1,e(a.$("a.u-button"),!1),a.$("#zfz_slider").slider("enable")):(a.b_autofocus=!0,e(a.$("a.u-button"))))}),a.$("#zfz_step").val(20).change(),a.$("#zff_step").val(20).change(),a._getStatus()})},d.prototype.leave=function(){f.addEvent("FocusZoomStatus",null),f.state("activeLocalFocus")&&f.state("activeLocalFocus",!1)},d.prototype.$=function(a){return this.e.find(a)},d.prototype._getStatus=function(){var a=arguments,b=this;e(b.$("a.u-button")),h.DevVideoInput.getFocusStatus().done(function(c){b.$("#zfz_slider").slider("value",c.Zoom.toFixed(6)*j,!1),b.$("#zff_slider").slider("value",c.Focus.toFixed(6)*k,!1),"Autofocus"===c.Status?(e(b.$("a.u-button")),a.callee.call(b)):e(b.$("a.u-button"),!1)}).fail(function(a){a&&a.error&&403===a.error.code&&e(b.$("a.u-button"))})},d.prototype.getStatusByRPC=function(){var a=arguments,b=this;h.DevVideoInput.getFocusStatus().done(function(c){"Normal"!=c.Status?a.callee.call(b):(b.$("#zfz_slider").slider("value",c.Zoom.toFixed(6)*j,!1),b.$("#zff_slider").slider("value",c.Focus.toFixed(6)*k,!1),b.b_zoom=!1,b.b_focus=!1,b.$("#zfz_slider").slider("enable"),e(b.$("a.u-button"),!1))})},c.exports=d})}(jQuery);