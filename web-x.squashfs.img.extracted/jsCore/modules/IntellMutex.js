define(function(require,a,b){function c(a){return!!a.then}function d(a,b){if(this.element="element"===typeOf(a)?a:$(a),this.options=b||{},!this.element)throw new Error("IntellMutex could not find the element: "+a);this.time=this.options.time,void 0===this.time&&(this.time=1e4),this.type=this.options.type||"warning",this.mutexts={}}d.prototype={add:function(a,b){var c=new Element("div",{"class":"ui-tip-container ui-tip-"+this.type,html:'<span class="ui-tip-icon"></span><lable>'+b+"</lable>"});return this.mutexts[a]={element:c},c.inject(this.element).translation(),this},setCtrl:function(a,b){this.mutexts[a].ctrl=b},_getElements:function(){var a=new Elements;return Object.each(this.mutexts,function(b){a.push(b.element)}),a},_show:function(a){a.element.setStyle("display","block"),this.time&&(a.intval=setTimeout(function(){a.element.setStyle("display","none")},this.time))},show:function(){var a=this.mutexts,b=this;Object.each(a,function(a){c(a.ctrl)?a.ctrl.then(function(){b._show(a)}):(a.ctrl===!0||a.ctrl())&&b._show(a)})},hide:function(){var a=this._getElements(),b=this.mutexts;a.setStyle("display","none"),Object.each(b,function(a){clearTimeout(a.intval)})}},d.getIntellMutexTip=function(a,b){var c=b.SupportedScene,d=b.SupportedRules;if(void 0===d){d=[];for(var e in b.SupportedScenes)for(var f in b.SupportedScenes[e].SupportedRules)d.push(f)}var g='<span class="intell-mutex-tip">                    <span t="intellMutexTip1"></span> {content} <span t="intellMutexTip2"></span>                  </span>',h=[],i=a;return["HeatMap","ParkingDetection"].contains(a)&&(i="Normal"),c.some(function(a){return a!==i})?("FaceDetection"===i?(c.contains("Normal")&&h.push("w_IVS_Analyse"),c.contains("NumberStat")&&h.push("w_flowrate"),(d.contains("ParkingDetection")||d.contains("RetrogradeDetection"))&&h.push("w_carDetection"),c.contains("Traffic")&&h.push("TrafficJunction")):"NumberStat"===i?(c.contains("Normal")&&h.push("w_IVS_Analyse"),c.contains("FaceDetection")&&h.push("w_faceDetection"),(d.contains("ParkingDetection")||d.contains("RetrogradeDetection"))&&h.push("w_carDetection"),c.contains("Traffic")&&h.push("TrafficJunction")):"Normal"===i?(c.contains("FaceDetection")&&h.push("w_faceDetection"),c.contains("NumberStat")&&h.push("w_flowrate"),c.contains("Traffic")&&h.push("TrafficJunction")):"Traffic"===i&&(c.contains("Normal")&&h.push("w_IVS_Analyse"),c.contains("FaceDetection")&&h.push("w_faceDetection"),c.contains("NumberStat")&&h.push("w_flowrate"),(d.contains("ParkingDetection")||d.contains("RetrogradeDetection"))&&h.push("w_carDetection")),h.length>0?(h=h.map(function(a){return'<strong t="'+a+'"></strong>'}),g.substitute({content:h.join(tl("w_d"))})):null):null},b.exports=d});