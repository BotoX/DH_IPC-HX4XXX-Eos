!function(a){define(function(require,b,c){function d(b,c){var d=this;d.options=a.extend({},A,c),d.e=a(b).empty().append(z).translation(),d.init()}function e(){y.ConfigManager.getConfig("HeatImagingThermometry").done(function(a){B="Centigrade"==a.TemperatureUnit?"°C":"°F",C=a.TemperEnable,S&&S!==B?(H=!0,Q=[],clearInterval(G),t()):H=!1,S=B,l()})}function f(b){R&&R.destroy(),R=null,R=R?g(R,b):a.jqplot("temRep_report",b,{seriesDefaults:{label:"",lineWidth:1,pointLabels:{show:!1},placement:"outsideGrid"},markerOptions:{show:!0,style:"filledCircle",size:9},axesDefaults:{tickOptions:{textColor:"#5c5c5c",mark:"outside",showGridline:!0,showMark:!0,markSize:4},showTicks:!0,showTickMarks:!1},seriesColors:M,axes:{xaxis:{renderer:a.jqplot.CategoryAxisRenderer,ticks:O,tickRenderer:a.jqplot.CanvasAxisTickRenderer,tickOptions:{markSize:5,_styles:{borderColor:"#ff9900","margin-top":"0","margin-left":"0px"},showGridline:!0,angle:70}},yaxis:{label:B,ticks:N,tickOptions:{_styles:{"margin-left":"20px"}}}},grid:{drawGridLines:!1,gridLineColor:"#5c5c5c",background:"#373737",borderColor:"#5c5c5c",borderWidth:1,renderer:a.jqplot.CanvasGridRenderer},highlighter:{show:!0,borderWidth:1,background:"#ff9900",sizeAdjust:5,fadeTooltip:!0,tooltipOffset:2},cursor:{show:!1,showTooltip:!1,followMouse:!1,tooltipOffset:6}})}function g(a,b){return k(a,b),a.axes.yaxis.reset(),a.axes.yaxis.ticks=N,a.axes.xaxis.reset(),a.axes.xaxis.ticks=O,a.seriesColors=M,a.data=b,a.replot(b,{data:b,seriesColors:M,resetAxes:!0,clear:!0}),a}function h(b,c){if(0==F.length)return void j(b);var d=[];return N=[],b&&b.series[c]&&(b.series[c].data=[]),Q[c]?Q.splice(c,1):Q[c-1]&&Q.splice(c-1,1),b.data=Q,a.each(Q,function(b,c){a.each(c,function(a,b){"null"!==b&&d.push(b)})}),N=x(d),b.axes.yaxis.reset(),b.axes.yaxis.ticks=N,f(Q),b}function j(a){return a?(R.destroy(),R=null,O=[],F=[],clearInterval(G),G=null,Q=[],a):void 0}function k(a,b){for(var c=0;c<b.length;c++){a.series[c].data||(a.series[c].data=[]);for(var d=0;d<b[c].length;d++)a.series[c].data[d]||(a.series[c].data[d]=[],a.series[c].data[d][0]=d+1),a.series[c].data[d][1]=b[c][d];a.series[c].color=M[c]||M[0],a.series[c].fillColor=M[c]||M[0],a.series[c].seriesColors=M[c]||M[0],a.series[c].markerOptions.color=M[c]||M[0],a.series[c].markerRenderer.color=M[c]||M[0]}}function l(){var b=E.concat();y.ConfigManager.getConfig("ThermometryRule").done(function(c){return E.empty(),null!=c&&""!=c&&null!=c[D]&&null!=c[D][0]&&C?(a.each(c[D],function(a,b){b.PresetId==I&&1==b.Enable&&E.push(b)}),E.length?void(b.length?p(b):o()):void m()):(F=[],void m())})}function m(){R&&j(R),a("#mtemper_collect")&&a("#mtemper_collect").html("")}function n(){J=a("#mtemper_period").val()-0,F.length>0&&(Q=[],O=[],clearInterval(G),G=null,t())}function o(){var b="";for(b+='<li class="mtemper-item" id="temperRuleAll0"><input type="checkbox" id="temperRuleAll"/><span for="temperRuleALL_enable" title="'+tl("w_Check All")+'">'+tl("w_Check All")+"</span></li>",i=0;i<E.length;i++){var c=E[i].RuleId-1;b+='<li class="mtemper-item" id="temperRule'+c+'"><input type="checkbox" id="temperRule_enable'+c+'"/><span class="Pretemper-name" for="temperRule_enable'+c+'" title="'+E[i].Name+'">'+E[i].Name+'</span><i class="i-flir-'+K[c]+E[i].Type.toLowerCase()+'"></i></li>'}a("#mtemper_collect").html(b),a("#mtemper_collect").on("click","input",r)}function p(b){var c=[];E.length>0&&(a("#temperRuleAll").show(),a.each(b,function(a,b){c.push(b.RuleId)})),a.each(E,function(d,e){var f=!0;if(a.each(b,function(b,d){d.RuleId===e.RuleId&&d.Type===e.Type&&d.PresetId===e.PresetId&&(f=!1,c.splice(a.inArray(e.RuleId,c),1),d.Name!==e.Name&&(a(".Pretemper-name").eq(b).text(e.Name),a(".Pretemper-name").eq(b).attr("title",e.Name)))}),f){var g=q(e);a("#mtemper_collect").append(g),a("#temperRuleAll").prop("checked",!1)}}),0===c.length?G&&f(Q):c.length>0&&a.each(c,function(b,c){var d=c-1,e=a("#temperRule"+d);e.remove(),F=a.grep(F,function(a,b){return a==d&&M.splice(b,1),a!=d}),a.each(P,function(a,b){b===d&&h(R,a)})}),0==F.length&&(clearInterval(G),G=null)}function q(b){var c=b.RuleId-1,d=new Element("li",{id:"temperRule"+c,"class":"mtemper-item"}),e='<input type="checkbox" id="temperRule_enable'+c+'"/><span class="Pretemper-name" for="temperRule_enable'+c+'" title="'+b.Name+'">'+b.Name+'</span><i class="i-flir-'+K[c]+b.Type.toLowerCase()+'"></i>';return a(d).html(e),d}function r(){if("temperRuleAll"==this.id)return void s();var b=this.id.replace(/[^\d]/g,"")-0;if(a(this).prop("checked"))F.push(b),F.length==a("#mtemper_collect input").length-1?a("#temperRuleAll").prop("checked",!0):a("#temperRuleAll").prop("checked",!1);else{if(a("#temperRuleAll").prop("checked",!1),F=a.grep(F,function(a,c){return a==b&&M.splice(c,1),a!=b}),0==F.length)return j(R),F=[],clearInterval(G),void(G=null);a.each(P,function(a,c){c===b&&h(R,a)})}G||t()}function s(){if(a("#temperRuleAll").prop("checked")){if(F=[],0==a("#mtemper_collect input").length)return;a("#mtemper_collect input").each(function(b,c){if("temperRuleAll"!=c.id){{c.id.replace(/[^\d]/g,"")-0}0==a(c).prop("checked")&&a(c).prop("checked",!0),F.push(E[b-1].RuleId-1)}}),G||t()}else a("#mtemper_collect input").each(function(b,c){a(c).prop("checked",!1)}),j(R),F=[],clearInterval(G),G=null}function t(){var b=function(){var b=new Date,c=a.pad(b.getHours(),2)+":"+a.pad(b.getMinutes(),2);O.push(c),O.length>60&&O.shift();var d={};a.each(E,function(a,b){d[b.RuleId-0-1]=b});for(var e=0;e<F.length;e++)Q[e]||(Q[e]=[]);P=[],a.each(F,function(a,b){P.push(b);var e={};e.PresetId=d[b].PresetId,e.RuleId=d[b].RuleId,e.Type=d[b].Type,e.Name=d[b].Name,e.channel=D;var g=0,h=function(){g++,y.RadiometryManager.getTemper(e).done(function(b){if(Q[a].length+1<Q[0].length){for(var c=0;c<Q[0].length-1;c++)Q[a].push("null");Q[a].push(b.TempInfo.TemperAver.round(2))}else Q[a].push(b.TempInfo.TemperAver.round(2));Q[a].length>60&&Q[a].shift(),a==F.length-1&&(u(Q),f(Q))}).fail(function(){if(11>g)h();else{Q[a]||(Q[a]=[]);var b=[];b[0]=c,b[1]="",Q[a].push(b),a==F.length-1&&(u(Q),f(Q))}})};h()})};G?H?(clearInterval(G),G=null,setTimeout(function(){R&&(R.destroy(),R=null),Q=[],O=[],b(),G=setInterval(b,6e4*J),H=!1},1e3)):F.length>0&&(b(),G=setInterval(b,6e4*J)):(H?setTimeout(function(){b(),G=setInterval(b,6e4*J),H=!1},1e3):F.length>0&&(b(),G=setInterval(b,6e4*J)),isOpen=!0)}function u(){var b=[];a.each(Q,function(c,d){a.each(d,function(a,c){parseInt(d.length/10);"null"!=c&&b.push(c)})}),N=x(b),M.empty(),a.each(F,function(a,b){M.push(L[b])})}function v(a,b){var c=Math.pow(10,b||0);return Math.ceil(a*c)/c}function w(a,b){var c=Math.pow(10,b||0);return Math.floor(a*c)/c}function x(a){var b=Math.max.apply(null,a),c=Math.min.apply(null,a),d=[],e=5;b=v(b,-1),c=w(c,-1);for(var f=0;e>=f;f++)d.push(c+(b-c)*f/e);return d}var y=require("../rpc"),z=(require("common/common"),require("./temperReport.html")),A=(require("lib/jquery.jqplot"),null),B=null,C=!0,D=0,E=[],F=[],G=null,H=!1,I=0,J=1,K=["g","b","y","p","lb","r","o","lg","lp","i","cn","gd","t","ma","lh","ny","s","cy","pvr","pk"],L=["#24ff00","#0284fe","#fff000","#d031ff","#00fff5","#ff2523","#fe7e01","#ccff02","#ffb6c1","#ffd700","#008080","#4b0082","#dc143c","#ff00ff","#fff0f5","#00008B","#708090","#00ffff","#db7093","#ffc0cb"],M=["#24ff00","#0284fe","#fff000","#d031ff","#00fff5","#ff2523","#fe7e01","#ccff02","#ffb6c1","#ffd700","#008080","#4b0082","#dc143c","#ff00ff","#fff0f5","#00008B","#708090","#00ffff","#db7093","#ffc0cb"],N=[0,20,40,60,80,100],O=[],P=[],Q=[],R=null,S=null;a.fn.temperReport=function(){var b=arguments[0],c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],e=this;return this.each(function(){var f=a(this),g=f.data("temperReport");if(g||f.data("temperReport",g=new d(f,b)),"string"===a.type(b)&&a.isFunction(g[b])){var h=g[b].apply(g,c);if(void 0!==h)return e=h,!1}}),e},d.prototype.init=function(){D=webApp.CHANNEL_NUMBER>1?1:0,a("#mtemper_period").on("change",n)},d.prototype.render=function(){y.PTZ.getPresets(0).done(function(a){a?webApp.PresetID?I!==webApp.PresetID&&(I=webApp.PresetID):I=webApp.PresetID:(webApp.PresetID=0,I=webApp.PresetID),e()})},d.prototype.resize=function(){R&&setTimeout(function(){var b=a(".main-bottom-container").width();a("#temRep_report").css("width",b),f(Q)},0)},d.prototype.destroy=function(){a("#mtemper_collect").html(""),B=null,E=[],R&&j(R)},d.prototype.$=function(a){return this.e.find(a)},c.exports=d})}(jQuery);