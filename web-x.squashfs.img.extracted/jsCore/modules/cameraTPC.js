!function(a){define(function(require,b,c){function d(b,c){var d=this;d.options=a.extend({},H,c),d.e=a(b),d.$=function(a){return d.e.find(a)},d.e.html(G).translation(),d.init()}function e(b){var c="",d="",e=I.$("#c_a_colorization"),f=I.$("#c_a_ROIType");a.each(b.PresetColorization,function(a,b){c+='<option value="'+b+'" t="'+b+'"></option>'}),e.empty().append(c),e.change(function(){z()}).translation(),a.each(b.PresetROIModes,function(a,b){d+='<option value="'+b+'" t="'+b+'"></option>'}),f.empty().append(d),f.change(function(){var a=I.$("#c_a_ROIType").val();z(a)}).translation()}function f(){D.DevVideoInput.getCapsEx(S,"All").done(function(a){I.$("[boxKey]").each(function(b,c){var d=I.$(c),e=d.attr("cfg"),f=d.attr("boxKey");if("Flip"==f)if(a[e]&&(a[e][f]||a[e].Rotate90)){var g=I.$("#c_a_flipEx"),h="";h=a[e][f]&&a[e].Rotate90?'<option value="0" t="w_noFlipEx"></option><option value="1" t="w_clockwise90Ex"></option><option value="2" t="w_clockwise90Ex2"></option><option value="3" t="w_Flip180Ex"></option>':a[e][f]?'<option value="0" t="w_noFlipEx"></option><option value="3" t="w_Flip180Ex"></option>':'<option value="1" t="w_clockwise90Ex"></option><option value="2" t="w_clockwise90Ex2"></option>',g.empty().append(h).translation(),d.show()}else d.hide();else a[e]&&a[e][f]?"VideoInDenoise"==e?a[e][f].Support?d.show():d.hide():d.show():d.hide()})})}function g(a){I.$("[slider][key]").each(function(b,c){var d=I.$(c),e=d.attr("key");"FFCPeriod"==e?a[e]&&D.ConfigManager.getConfig("VideoStandard").done(function(b){var c="PAL"==b?a[e].MaxP:a[e].MaxN;d.slider({min:a[e].Min,max:c,complete:function(a,b){t(),K.FlatFieldCorrection[S].Period=b.value,A("FlatFieldCorrection",K.FlatFieldCorrection)}})}):d.slider("3D"==e?{min:1,max:100,complete:function(a,b){K.VideoInDenoise[S][0]["3DAutoType"].AutoLevel=b.value,K.VideoInDenoise[S][1]["3DAutoType"].AutoLevel=b.value,K.VideoInDenoise[S][2]["3DAutoType"].AutoLevel=b.value,A("VideoInDenoise",K.VideoInDenoise)}}:{min:a[e].Min,max:a[e].Max,step:a[e].Step?a[e].Step:1,complete:function(a,b){"Brightness"==e||"Gamma"==e?(K.VideoColor[S][0][e]=b.value,K.VideoColor[S][1][e]=b.value,K.VideoColor[S][2][e]=b.value,A("VideoColor",K.VideoColor)):"Sharpness"==e?(I.$("#c_a_sceneEnable").prop("checked")&&I.$("#c_a_scene").get(0).selectedIndex<3&&(I.$("#c_a_sceneEnable, #c_a_presetEnable").prop("checked",!1),I.$("#c_a_scene, #c_a_preset, #c_a_name").prop("disabled",!0)),K.VideoInSharpness[S][0][e]=b.value,K.VideoInSharpness[S][1][e]=b.value,K.VideoInSharpness[S][2][e]=b.value,A("VideoInSharpness",K.VideoInSharpness)):("Agc"==e||"AgcMaxGain"==e||"AgcPlateau"==e)&&t(),z()}})})}function h(){var b=I.$("#c_a_preset"),c="";D.PTZ.getPresets(0).done(function(d){null!=d&&0!=d.length&&webApp.DeviceType.contains("SD")?(b.parent().show().next(".fn-horizontal-line").show(),a.each(d,function(a,b){c+="<option value = '"+b.Index+"'>"+b.Index+"</option>"}),b.empty().append(c),b.get(0).selectedIndex=0,L=b.val()-0):b.append("<option value = '0'>0</option>").parent().hide().next(".fn-horizontal-line").hide()}),b.change(function(){L=I.$("#c_a_preset").val()-0,D.PTZ.gotoPreset(L,null,0),n()})}function i(){j(),k();var a=K.VideoImageControl[S]?K.VideoImageControl[S]:null,b=K.VideoInFocus&&K.VideoInFocus[S]?K.VideoInFocus[S]:null,c=K.ThermographyOptions[S][0],d=K.FlatFieldCorrection[S]?K.FlatFieldCorrection[S]:null;a&&(I.$("#c_a_mirrorEnable").prop("checked",a.Mirror),I.$("#c_a_mirrorDisable").prop("checked",!a.Mirror),a.Flip?!a.Rotate90&&I.$("#c_a_flipEx").val(3):I.$("#c_a_flipEx").val(a.Rotate90),I.$("#c_a_freeze").prop("checked",a.Freeze)),b&&I.$("#c_a_focusMode").val(b[0].Mode),I.$("#c_a_colorization").val(c.Colorization),I.$("#c_a_ROIType").val(c.OptimizedRegion.Type),l(c.OptimizedRegion.Type),"LowTemperature"==c.Mode?(I.$("#c_a_gainLow").prop("checked",!0),I.$(".agcAuto").hide()):"HighTemperature"==c.Mode?(I.$("#c_a_gainHigh").prop("checked",!0),I.$(".agcAuto").hide()):(I.$("#c_a_gainAuto").prop("checked",!0),I.$(".agcAuto").show()),I.$("#c_a_gainLowToHigh").numberfield("value",c.Auto.LowToHigh),I.$("#c_a_gainHighToLow").numberfield("value",c.Auto.HighToLow),I.$("#c_a_gainLHRoi").numberfield("value",c.Auto.LHROI),I.$("#c_a_gainHLRoi").numberfield("value",c.Auto.HLROI),u(),d&&("Auto"==d.Mode?(I.$("#c_a_ffcAuto").prop("checked",!0),I.$("[slider][key=FFCPeriod]").parent().show()):(I.$("#c_a_ffcManu").prop("checked",!0),I.$("[slider][key=FFCPeriod]").parent().hide()))}function j(){var b=I.$("#c_a_scene"),c="";if(a.each(K.ThermographyOptionScene[S],function(a,b){if("Indoor"==b.SceneName||"Outdoor"==b.SceneName||"Default"==b.SceneName)c+='<option value="'+b.SceneName+'" t="'+b.SceneName+'Scene"></option>';else if("Custom1"==b.SceneName||"Custom2"==b.SceneName||"Custom3"==b.SceneName||"Custom4"==b.SceneName||"Custom5"==b.SceneName){var d=b.SceneName.replace(/[^\d]/g,"")-0;c+='<option value="'+b.SceneName+'" t="CustomScence+'+d+'"></option>'}else c+='<option value="'+b.SceneName+'" t="'+b.SceneName+'"></option>'}),b.empty().append(c).translation(),N)if(b.val(N),"Indoor"==N||"Outdoor"==N||"Default"==N)I.$("#c_a_name").val(tl(N+"Scene")).prop("disabled",!0);else if("Custom1"==N||"Custom2"==N||"Custom3"==N||"Custom4"==N||"Custom5"==N){var d=N.replace(/[^\d]/g,"")-0;I.$("#c_a_name").val(tl("CustomScence")+d).prop("disabled",!1)}else I.$("#c_a_name").val(tl(N)).prop("disabled",!1);else b.get(0).selectedIndex=0,I.$("#c_a_name").val(tl(I.$("#c_a_scene option:selected").attr("t")))}function k(){if(K.VideoInDenoise[S][0])if(I.$("#c_a_2DdepNoise").prop("checked",K.VideoInDenoise[S][0]["2DEnable"]),1==K.VideoInDenoise[S][0]["2DLevel"]?I.$("#c_a_2DdepNoiseLow").prop("checked",!0):2==K.VideoInDenoise[S][0]["2DLevel"]?I.$("#c_a_2DdepNoiseMiddle").prop("checked",!0):I.$("#c_a_2DdepNoiseHigh").prop("checked",!0),I.$("[slider][key=3D]").parent().hide(),K.VideoInDenoise[S][0]){var b=K.VideoInDenoise[S][0]["3DAutoType"].AutoLevel,c="Auto"==K.VideoInDenoise[S][0]["3DType"]&&0!==b?!0:!1;I.$("#c_a_3DdepNoise").prop("checked",c),I.$("[boxKey=3D]").show(),5!=b&&c?50==b?I.$("#c_a_3DdepNoiseMiddle").prop("checked",!0):100==b?I.$("#c_a_3DdepNoiseHigh").prop("checked",!0):(I.$("#c_a_3DdepNoiseCustom").prop("checked",!0),I.$("[slider][key=3D]").slider("value",b).parent().show(),-1!==webApp.DeviceType.indexOf("TPC")&&I.$(".tau_3DdepressLevel").addClass("fn-opacity"),a("#c_a_basicSet").slideDown(),I.$(".ui-switch-icon").eq(0).addClass("toggle")):I.$("#c_a_3DdepNoiseLow").prop("checked",!0)}else I.$("[boxKey=3D]").hide()}function l(b){var c=K.ThermographyOptions[S][0].OptimizedRegion.Regions;c=c?c:[],E&&E.SetRegionNum(0),E&&E.SetRegionNum(1),R=!1,"Custom"==b?c&&0!=c.length?a.each(c,function(a,b){b[0]!=b[1]&&b[2]!=b[3]&&E&&E.SetSelRegionByIndex(a,b[0],b[1],b[2],b[3]).done(function(){R=!0})}):R=!0:D.ThermographyManager.getOptimizedRegion(S).done(function(a){var b=a.optimizedRegion.Regions[0];E&&E.SetSelRegionByIndex(0,b[0],b[1],b[2],b[3]).done(function(){R=!0})})}function m(a){var b=K.ThermographyOptions[S][0],c=K.VideoInSharpness&&K.VideoInSharpness[S]?K.VideoInSharpness[S][0]:null,d=K.VideoColor[S][0],e=K.ThermographyOptionScene[S][P],f=K.ThermographyColorScene[S][Q]?K.ThermographyColorScene[S][Q]:K.VideoColor[S][0];I.$("[slider][key=Brightness]").slider("value",d.Brightness),K.FlatFieldCorrection&&I.$("[slider][key=FFCPeriod]").slider("value",K.FlatFieldCorrection[S].Period),"preset"==a?I.$("[slider][scene]").each(function(a,c){var d=I.$(c),e=d.attr("key");d.slider("value",b[e])}):"custom"==a?(I.$("[slider][scene]").each(function(a,c){var d=I.$(c),g=d.attr("key");"Sharpness"==g?d.slider("value",f[g]):"EZoom"==g?d.slider("value",b[g]):d.slider("value",e[g])}),e.HighTempGainMode&&I.$("[high][slider]").each(function(a,b){var c=I.$(b),d=c.attr("key");c.slider("value",e.HighTempGainMode[d])}),b.Mode=e.Mode,b.Auto.LowToHigh=e.Auto.LowToHigh,b.Auto.LHROI=e.Auto.LHROI,b.Auto.HighToLow=e.Auto.HighToLow,b.Auto.HLROI=e.Auto.HLROI,b.Colorization=e.Colorization):(I.$("[slider][scene]").each(function(a,d){var e=I.$(d),f=e.attr("key");"Sharpness"==f?c&&e.slider("value",c[f]):e.slider("value",b[f])}),b.HighTempGainMode&&I.$("[high][slider]").each(function(a,c){var d=I.$(c),e=d.attr("key");d.slider("value",b.HighTempGainMode[e])}))}function n(){var b=K.PresetThermographyBond;if(M=null,b&&b[S])M=b[S].filter(function(a){return a.PresetID===L}),M=M[M.length-1];else{b=[];for(var c=0;S>=c;c++)b.push([])}M||(b[S].push(a.extend(!0,{},O)),M=b[S][b[S].length-1],M.PresetID=L,M.EZoom=K.ThermographyOptions[S][0].EZoom,M.Colorization=K.ThermographyOptions[S][0].Colorization,M.Type=K.ThermographyOptions[S][0].OptimizedRegion.Type,M.Regions=K.ThermographyOptions[S][0].OptimizedRegion.Regions,M.Brightness=K.VideoColor[S][0].Brightness),I.$("#c_a_sceneEnable").prop("checked",!0),o(!0)}function o(b){I.$("#c_a_scene").prop("disabled",!1),N=I.$("#c_a_scene").val(),I.$("#c_a_scene").get(0).selectedIndex<3?(I.$("#c_a_name").prop("disabled",!0),p(b)):(I.$("#c_a_name").prop("disabled",!1),q(b)),a("#c_a_agcSet").slideDown(),I.$(".ui-switch-icon").eq(1).addClass("toggle")}function p(b){var c="Indoor"==N?"Low Contrast":"Outdoor"==N?"High Contrast":"Default",d=null;K.ThermographyOptionScene&&(P=s(K.ThermographyOptionScene[S],N)),K.ThermographyColorScene&&(Q=s(K.ThermographyColorScene[S],N)),D.ThermographyManager.getPresetParam(c,S).done(function(c){K.ThermographyOptions[S][0]=c.presetInfo,d=K.ThermographyOptions[S][0],K.VideoColor[S][0].Brightness=d.Brightness,K.VideoColor[S][1].Brightness=d.Brightness,K.VideoColor[S][2].Brightness=d.Brightness,K.VideoInSharpness[S][0].Sharpness=d.Sharpness,K.VideoInSharpness[S][1].Sharpness=d.Sharpness,K.VideoInSharpness[S][2].Sharpness=d.Sharpness,d.HighTempGainMode||(d.HighTempGainMode={},d.HighTempGainMode.Agc=d.Agc,d.HighTempGainMode.AgcMaxGain=d.AgcMaxGain,d.HighTempGainMode.AgcPlateau=d.AgcPlateau),1!=b?(m("preset"),I.$("#c_a_presetEnable").prop("checked")&&(M.EZoom=I.$("[slider][key=EZoom]").slider("value"),M.Brightness=I.$("[slider][key=Brightness]").slider("value"),M.OptionScene=I.$("#c_a_scene").val(),M.ColorScene=I.$("#c_a_scene").val(),M.Colorization=I.$("#c_a_colorization").val(),M.Type=I.$("#c_a_ROIType").val(),M.Regions=a.extend(!0,{},d.OptimizedRegion.Regions)),K.ThermographyColorScene[S][Q].Sharpness=I.$("[slider][key=Sharpness]").slider("value"),A(["ThermographyOptions","VideoInSharpness","VideoColor","ThermographyColorScene","PresetThermographyBond"],[K.ThermographyOptions,K.VideoInSharpness,K.VideoColor,K.ThermographyColorScene,K.PresetThermographyBond]),i()):r()}).fail(function(){1!=b&&a("#attr_tip").tip("error",tl("Saving failure"))})}function q(a){N=I.$("#c_a_scene").val(),I.$("#c_a_sceneEnable").prop("checked")&&(K.ThermographyOptionScene&&(P=s(K.ThermographyOptionScene[S],N)),K.ThermographyColorScene&&(Q=s(K.ThermographyColorScene[S],N)),1!=a?(m("custom"),i(),z()):r())}function r(){K.ThermographyOptions[S][0].EZoom=M.EZoom,K.ThermographyOptions[S][0].OptimizedRegion.Type=M.Type,K.ThermographyOptions[S][0].OptimizedRegion.Regions=M.Regions,K.ThermographyOptions[S][0].Colorization=M.Colorization,K.VideoColor[S][0].Brightness=M.Brightness,K.VideoColor[S][1].Brightness=M.Brightness,K.VideoColor[S][2].Brightness=M.Brightness,m(I.$("#c_a_scene").get(0).selectedIndex<3?"preset":"custom"),i(),A("VideoColor",K),z()}function s(b,c){var d;return a.each(b,function(a,b){return b.SceneName==c?(d=a,!1):void 0}),d}function t(){I.$("#c_a_sceneEnable").prop("checked")&&I.$("#c_a_scene").get(0).selectedIndex<3&&(I.$("#c_a_sceneEnable").prop("checked",!1),I.$("#c_a_scene, #c_a_name").prop("disabled",!0))}function u(){I.$("[gainTo]").each(function(a,b){{var c=I.$(b);c.numberfield("value")}}),I.$("[gainRoi]").each(function(a,b){{var c=I.$(b);c.numberfield("value")}})}function v(b){var c={keys:[],values:[]};return a.isPlainObject(b)?(a.each(b,function(a,d){b.hasOwnProperty(a)&&(c.keys.push(a),c.values.push(d))}),c):c}function w(){return D.ConfigManager.restoreTemporaryConfig(J)}function x(){var a=K.ThermographyOptionScene[S][P],b=K.ThermographyColorScene[S][Q];if(I.$("[scene][slider]").each(function(b,c){var d=I.$(c),e=d.attr("key");a[e]=d.slider("value")}),a.HighTempGainMode&&I.$("[high][slider]").each(function(b,c){var d=I.$(c),e=d.attr("key");a.HighTempGainMode[e]=d.slider("value")}),a.Colorization=I.$("#c_a_colorization").val(),a.Mode=I.$("[name=GainType]:checked").val(),I.$("[numberfield]").each(function(b,c){var d=I.$(c),e=d.attr("numberfield");a.Auto[e]=d.numberfield("value")}),a.OptimizedRegion.Regions)for(var c=a.OptimizedRegion.Regions.length;c--;)"0,0,0,0"==a.OptimizedRegion.Regions[c]&&a.OptimizedRegion.Regions.splice(c,1);b.Sharpness=I.$("[slider][key=Sharpness]").slider("value"),a.SceneName=N,b.SceneName=N}function y(a){I.$("[scene][slider]").each(function(b,c){var d=I.$(c),e=d.attr("key");"Sharpness"!=e&&(a[e]=d.slider("value"))}),a.HighTempGainMode&&I.$("[high][slider]").each(function(b,c){var d=I.$(c),e=d.attr("key");a.HighTempGainMode[e]=d.slider("value")}),a.Mode=I.$("[name=GainType]:checked").val(),I.$("[numberfield]").each(function(b,c){var d=I.$(c),e=d.attr("numberfield");a.Auto[e]=d.numberfield("value")}),a.Colorization=I.$("#c_a_colorization").val(),a.SceneName=I.$("#c_a_scene").val(),a.OptimizedRegion.Type=I.$("#c_a_ROIType").val(),a.Brightness=K.VideoColor[S][0].Brightness}function z(b){var c=!1,d=K.ThermographyOptions[S][0];I.$("#c_a_presetEnable").prop("checked")&&(M.EZoom=I.$("[slider][key=EZoom]").slider("value"),M.Brightness=I.$("[slider][key=Brightness]").slider("value"),M.OptionScene=I.$("#c_a_scene").val(),M.ColorScene=I.$("#c_a_scene").val(),M.Type=I.$("#c_a_ROIType").val(),M.Colorization=I.$("#c_a_colorization").val(),M.Regions=a.extend(!0,{},d.OptimizedRegion.Regions),D.ConfigManager.setTemporaryConfig("PresetThermographyBond",K.PresetThermographyBond).fail(function(){c=!0})),I.$("#c_a_sceneEnable").prop("checked")?(x(),D.ConfigManager.setTemporaryConfig(["ThermographyOptionScene","ThermographyColorScene"],[K.ThermographyOptionScene,K.ThermographyColorScene])):I.$("#c_a_sceneEnable").prop("checked")&&I.$("#c_a_scene").get(0).selectedIndex<3&&(I.$("#c_a_presetEnable").prop("checked")||I.$("#c_a_name").prop("disabled",!0));var e=d.OptimizedRegion.Regions;return e&&e.length>0&&0==e[0][0]&&0==e[0][1]&&0==e[0][2]&&0==e[0][3]?void a("#attr_tip").tip("error",tl("Please draw shape")):(y(d),void D.ConfigManager.setTemporaryConfig("ThermographyOptions",K.ThermographyOptions).done(function(){b&&l(b)}))}function A(a,b){D.ConfigManager.setTemporaryConfig(a,b)}function B(){D.ThermographyManager.doFFC(S).done(function(){a("#attr_tip").tip("success",tl("Operateingsuccess"))}).fail(function(){a("#attr_tip").tip("error",tl("Operateingfailure"))})}function C(a,b,c,d){var e=a-c,f=e>0?c:a,g=b-d,h=g>0?d:b;return[f,h,f+Math.abs(e),h+Math.abs(g)]}var D=require("/jsCore/rpc"),E=(require("/jsCore/pageBase"),require("/jsCore/plugin")),F=(require("common/common"),require("/jsCore/ability"));require("widget/js/dui.slider"),require("widget/js/dui.iconlist"),require("widget/js/dui.iconSelect");var G=require("./cameraTPC.html"),H={},I=null,J=["ThermographyOptions","VideoInSharpness","VideoColor","VideoImageControl","VideoInFocus","FlatFieldCorrection","ThermographyOptionScene","ThermographyColorScene","VideoInDenoise","PresetThermographyBond"],K={},L=null,M=null,N=null,O=null,P=null,Q=null,R=!0,S=webApp.CHANNEL_NUMBER>1?1:0;a.fn.cameraTPC=function(){var b=arguments[0],c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],e=this;return this.each(function(){var f=a(this),g=f.data("cameraTPC");if(g||f.data("cameraTPC",g=new d(f,b)),"string"===a.type(b)&&a.isFunction(g[b])){var h=g[b].apply(g,c);if(void 0!==h)return e=h,!1}}),e},d.prototype.init=function(){I=this,w(),D.ThermographyManager.getCaps(S,"All").done(function(a){var b=a.CamType;1!==webApp.CHANNEL_NUMBER||webApp.DeviceType.contains("SD")||2!==b||(I.$("#c_a_gaintype_wrap").hide(),I.$(".agcAuto").hide()),g(a),e(a),f(),!S&&I.render()}),F.get("LensControl").done(function(a){!!a&&I.$(".lensControl").hide()}),D.ConfigManager.getDefault("PresetThermographyBond").done(function(a){O=a[S],O||(O={PresetID:-1,EZoom:1,Type:"Full Screen",Regions:[[0,0,8191,8191]],Brightness:50,OptionScene:"Default",ColorScene:"Default",Colorization:"White Hot"})}),I.bind()},d.prototype.bind=function(){I.$("#c_a_presetEnable").click(function(a){I.$(a.target).prop("checked")?(L=I.$("#c_a_preset").val()-0,D.PTZ.gotoPreset(L,null,0),I.$("#c_a_preset").prop("disabled",!1),n()):I.$("#c_a_preset").prop("disabled",!0)}),I.$("#c_a_sceneEnable").click(function(a){I.$(a.target).prop("checked")?o():(I.$("#c_a_presetEnable").prop("checked",!1),I.$("#c_a_preset, #c_a_scene, #c_a_name").prop("disabled",!0))}),I.$("#c_a_scene").change(function(){o()}),I.$("#c_a_name").blur(function(b){var c=I.$(b.target).val();switch(b_Same=null,c){case tl("IndoorScene"):c="Indoor";break;case tl("OutdoorScene"):c="Outdoor";break;case tl("DefaultScene"):c="Default";break;case tl("CustomScence")+1:c="Custom1";break;case tl("CustomScence")+2:c="Custom2";break;case tl("CustomScence")+3:c="Custom3";break;case tl("CustomScence")+4:c="Custom4";break;case tl("CustomScence")+5:c="Custom5";break;default:c=c}return c!=I.$("#c_a_scene").val()?(b_Same=I.$("#c_a_scene option:checked").siblings().filter(function(){return a(this).val()==c}),b_Same&&0!=b_Same.length?void a("#attr_tip").tip("error",tl("w_noSameName")):(N=c,z(),i(),void 0)):void 0}),I.$(".ui-switch-icon").click(function(b){var c=I.$(b.target).toggleClass("toggle").attr("data-link");a("#"+c).slideToggle()}),I.$(".ui-switch-icon").eq(0).addClass("toggle"),a("#c_a_agcSet").hide(),a("#c_a_ffcSet").hide(),I.$("#c_a_mirrorEnable, #c_a_mirrorDisable").click(function(){K.VideoImageControl[S].Mirror=I.$("#c_a_mirrorEnable").prop("checked"),A("VideoImageControl",K.VideoImageControl)}),I.$("#c_a_flipEx").change(function(){var a=I.$("#c_a_flipEx").val();"3"==a?(K.VideoImageControl[S].Flip=!0,K.VideoImageControl[S].Rotate90=0):(K.VideoImageControl[S].Flip=!1,K.VideoImageControl[S].Rotate90=a-0),A("VideoImageControl",K.VideoImageControl)}),I.$("#c_a_freeze").click(function(a){K.VideoImageControl[S].Freeze=I.$(a.target).prop("checked"),A("VideoImageControl",K.VideoImageControl)}),I.$("#c_a_focusMode").change(function(){t(),K.VideoInFocus[S][0].Mode=I.$("#c_a_focusMode").val()-0,K.VideoInFocus[S][1].Mode=I.$("#c_a_focusMode").val()-0,K.VideoInFocus[S][2].Mode=I.$("#c_a_focusMode").val()-0,A("VideoInFocus",K.VideoInFocus)}),I.$("#c_a_2DdepNoise").click(function(a){var b=I.$(a.target).prop("checked");K.VideoInDenoise[S][0]["2DEnable"]=b,K.VideoInDenoise[S][1]["2DEnable"]=b,K.VideoInDenoise[S][2]["2DEnable"]=b,A("VideoInDenoise",K.VideoInDenoise)}),I.$("[name=2DdepNoise]").click(function(){var a=I.$("[name=2DdepNoise]:checked").val()-0;K.VideoInDenoise[S][0]["2DLevel"]=a,K.VideoInDenoise[S][1]["2DLevel"]=a,K.VideoInDenoise[S][2]["2DLevel"]=a,A("VideoInDenoise",K.VideoInDenoise)}),I.$("[name=3DdepNoise]").click(function(){var b=I.$("[name=3DdepNoise]:checked").val()-0,c=I.$("[slider][key=3D]");c.parent().hide(),b?(K.VideoInDenoise[S][0]["3DAutoType"].AutoLevel=b,K.VideoInDenoise[S][1]["3DAutoType"].AutoLevel=b,K.VideoInDenoise[S][2]["3DAutoType"].AutoLevel=b):(c.parent().show(),K.VideoInDenoise[S][0]["3DAutoType"].AutoLevel=c.slider("value"),K.VideoInDenoise[S][1]["3DAutoType"].AutoLevel=c.slider("value"),K.VideoInDenoise[S][2]["3DAutoType"].AutoLevel=c.slider("value")),a("#c_a_basicSet").slideDown(),A("VideoInDenoise",K.VideoInDenoise)}),I.$("#c_a_3DdepNoise").click(function(a){var b=I.$(a.target).prop("checked");K.VideoInDenoise[S][0]["3DType"]=b?"Auto":"Off",K.VideoInDenoise[S][1]["3DType"]=b?"Auto":"Off",K.VideoInDenoise[S][2]["3DType"]=b?"Auto":"Off",b||(K.VideoInDenoise[S][0]["3DAutoType"].AutoLevel=0,K.VideoInDenoise[S][1]["3DAutoType"].AutoLevel=0,K.VideoInDenoise[S][2]["3DAutoType"].AutoLevel=0),A("VideoInDenoise",K.VideoInDenoise)}),I.$("#c_a_gainLow, #c_a_gainHigh, #c_a_gainAuto").click(function(a){var b=I.$(a.target).val();t(),"Auto"==b?I.$(".agcAuto").show():I.$(".agcAuto").hide(),z()}),I.$("[gainRoi]").each(function(a,b){var c=I.$(b);c.numberfield({min:c.attr("min")-0,max:c.attr("max")-0}).blur(function(a){var b=I.$(a.target),c=b.attr("id"),d=b.val()-0;"c_a_gainLHRoi"==c?d+(I.$("#c_a_gainHLRoi").val()-0)<101&&I.$("#c_a_gainHLRoi").val(101-d):d+(I.$("#c_a_gainLHRoi").val()-0)<101&&I.$("#c_a_gainLHRoi").val(101-d),u(),t(),z()})}),I.$("[gainTo]").each(function(a,b){var c=I.$(b);c.numberfield({min:c.attr("min")-0,max:c.attr("max")-0}).blur(function(a){var b=I.$(a.target),c=b.attr("id"),d=b.numberfield("value")-0;t(),"c_a_gainLowToHigh"==c?d<=I.$("#c_a_gainHighToLow").numberfield("value")-0&&I.$("#c_a_gainHighToLow").numberfield("value",d-1):d>=I.$("#c_a_gainLowToHigh").numberfield("value")-0&&I.$("#c_a_gainLowToHigh").numberfield("value",d+1),u(),z()})}),I.$(".i-up").click(function(a){var b=I.$(a.target),c=b.attr("data-for"),d=I.$("#c_a_gain"+c),e=d.numberfield("value")-0,f=d.attr("max");if("LowToHigh"==c||"HighToLow"==c){if(e>=f)return;d.numberfield("value",e+1)}else{if(e>=f)return;d.numberfield("value",e+1)}d.trigger("blur"),t(),z()}),I.$(".i-down").click(function(a){var b=I.$(a.target),c=b.attr("data-for"),d=I.$("#c_a_gain"+c),e=d.numberfield("value")-0,f=d.attr("min");if("LowToHigh"==c||"HighToLow"==c){if(f>=e)return;d.numberfield("value",e-1)}else{if(f>=e)return;d.numberfield("value",e-1)}d.trigger("blur"),t(),z()}),I.$("input[name=FFCMode]").click(function(a){var b=I.$(a.target).val();"Auto"==b?I.$("[slider][key=FFCPeriod]").parent().show():I.$("[slider][key=FFCPeriod]").parent().hide(),t(),K.FlatFieldCorrection[S].Mode=b,A("FlatFieldCorrection",K.FlatFieldCorrection)}),I.$('[btn-for="onDoFFC"]').on("click",function(){B()})},d.prototype.render=function(b){E.cover("#attr_video",function(){E.SetRegionNum(0),E.SetModuleMode(1);var a="Monitor_0"+(S+1);login.chkAuthority(a)?(E.SetVisibleVideoWnd(1,S),E.ConnectRealVideoEx(S,S,0)):(E.SetVisibleVideoWnd(1,S),E.SetVideoWndTip(S,tl("noVideoAuthoity")))}),a("[page-btn=thermal]").removeClass("fn-hide").siblings("[page-btn=visible]").addClass("fn-hide"),I.$("#c_a_presetEnable, #c_a_sceneEnable").prop("checked",!1),I.$("#c_a_preset, #c_a_scene, #c_a_name").prop("disabled",!0),D.ConfigManager.getConfig("ThermographyVideoMode").done(function(a){"FPGA"==a[S].VideoMode?I.$(".FPGA").hide():I.$(".FPGA").show()}),D.ConfigManager.getConfig(J).done(function(b){a.each(J,function(a,c){K[c]=null,K[c]=b[a].params.table}),m(),N=null,i()}),E.addEvent("RegionChanged",function(a,b,c,d,e){if(R){var f=C(b,c,d,e),g=K.ThermographyOptions[S][0];g.OptimizedRegion.Regions=g.OptimizedRegion.Regions?g.OptimizedRegion.Regions:[],g.OptimizedRegion.Regions[a]=[f[0],f[1],f[2],f[3]],(f[0]==f[2]||f[1]==f[3])&&(g.OptimizedRegion.Regions[a]=[0,0,0,0]),K.ThermographyOptions[S][0].OptimizedRegion.Type="Custom",I.$("#c_a_ROIType").val("Custom"),z()}}),-1!==webApp.DeviceType.indexOf("SD")&&h(),b&&a("#attr_tip").tip("success",tl("Operateingsuccess"))},d.prototype.leave=function(){E.hide(),w(),E.addEvent("RegionChanged",null),E.DelSelReg(-1),E.SetRegionNum(0)},d.prototype.onDelete=function(){E.DelSelReg(-1),w()},d.prototype.onDefaultT=function(){var b=["ThermographyOptions","VideoInSharpness","VideoColor","PresetThermographyBond"],c=["VideoInFocus","VideoImageControl","VideoInDenoise","FlatFieldCorrection"],d=[];a.each(c,function(a,c){K[c]&&b.push(c)}),-1!==webApp.DeviceType.indexOf("SD")&&(b.push("ThermographyOptionScene"),b.push("ThermographyColorScene")),I.$("#c_a_presetEnable, #c_a_sceneEnable").prop("checked",!1),I.$("#c_a_preset, #c_a_scene, #c_a_name").prop("disabled",!0),D.ConfigManager.getDefault(b).done(function(c){a.each(b,function(a,b){"ThermographyOptions"==b||"ThermographyOptionScene"==b||"ThermographyColorScene"==b?(K[b]=null,K[b]=c[a].params.table):K[b][S]=c[a].params.table[S],d.push(K[b])}),D.ConfigManager.setTemporaryConfig(J,v(K).values).done(function(){m(),i()}),a("#attr_tip").tip("success",tl("Defaultsuccess"))}).fail(function(){a("#attr_tip").tip("error",tl("Operateingfailure"))})},d.prototype.onRefreshT=function(){w().done(function(){I.render(!0)}).fail(function(){a("#attr_tip").tip("error",tl("Operateingfailure"))})},d.prototype.onSaveT=function(){var b=!1,c=K.ThermographyOptions[S][0];I.$("#c_a_presetEnable").prop("checked")&&D.ConfigManager.setConfig("PresetThermographyBond",K.PresetThermographyBond).fail(function(){b=!0}),I.$("#c_a_sceneEnable").prop("checked")?(x(),D.ConfigManager.setConfig(["ThermographyOptionScene","ThermographyColorScene"],[K.ThermographyOptionScene,K.ThermographyColorScene]).fail(function(){a("#attr_tip").tip("error",tl("Saving failure"))})):I.$("#c_a_sceneEnable").prop("checked")&&I.$("#c_a_scene").get(0).selectedIndex<3&&(I.$("#c_a_presetEnable").prop("checked")||I.$("#c_a_name").prop("disabled",!0));var d=c.OptimizedRegion.Regions;if(d&&d.length>0&&0==d[0][0]&&0==d[0][1]&&0==d[0][2]&&0==d[0][3])return void a("#attr_tip").tip("error",tl("Please draw shape"));y(c);var e=v(K);D.ConfigManager.setConfig(e.keys,e.values).done(function(){b?a("#attr_tip").tip("error",tl("Saving failure")):a("#attr_tip").tip("success",tl("Succeed in saving configure"))}).fail(function(){a("#attr_tip").tip("error",tl("Saving failure"))})},c.exports=d})}(jQuery);