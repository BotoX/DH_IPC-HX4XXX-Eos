!function(a){define(function(require,b,c){function d(b){var c={},b=b;this.instance=function(d,f){var g=e.getSession(),h=JSON.stringify(a.extend(d,f));return c[g]&&c[g][h]&&"rejected"!==c[g][h].state()?c[g][h]:c[g]?c[g][h]=e.send(b,d,f):(c={},c[g]={},c[g][h]=e.send(b,d,f))}}var e=require("common/rpcBase"),f=require("common/common"),g=(f.Cookie,c.exports={});a.extend(!0,g,e),g.Integration=new function(){this.getLogCount=function(b){var c,d=this;return c=d.token?e.Log.stopFind(d.token).then(function(){return e.Log.startFind(b)}):e.Log.startFind(b),c.then(function(b){return b?(d.token=b,e.Log.getCount(d.token)):0===b?a.Deferred(function(a){a.resolve(0)}).promise():void 0})},this.getLog=function(b,c){return this.token?e.Log.doSeekFind(this.token,b,c):a.Deferred(function(a){a.reject()}).promise()},this.formatPatition=function(b,c,d){function f(){return e.DevStorage.formatPatition(b,c,d).always(function(){e.RecordManager.start(),e.SnapManager.start()})}var g=e.RecordManager.stop(),h=e.SnapManager.stop();return a.when(g,h).then(f,f)},this.formatPatitionOld=function(b,c){function d(){return e.send("devStorage.formatPatition",{pointer:b,part:c}).always(function(){e.RecordManager.start(),e.SnapManager.start()})}var f=e.RecordManager.stop(),g=e.SnapManager.stop();return a.when(f,g).then(d,d)}};var h=["PPPoE","Mobile","Wireless","DDNS","Wire802_1X","LDAP","PPPoE","SNMP","VPN","Email","NAS","WLan","VSP_GAYS"];g.ConfigManager.getConfig=function(b){return webApp.EncryptInfo&&webApp.EncryptInfo.asymmetric&&-1!==a.inArray(b,h)?a.Deferred(function(a){f.EncryptInfo(webApp.EncryptInfo.pub,{name:b}).done(function(b){g.Security.getConfig(b.salt,"AES-128",b.content).done(function(c){f.UnEncryptInfo(b.key,c).done(function(b){a.resolve(b.table)})}).fail(a.reject)})}).promise():e.ConfigManager.getConfig(b)},g.ConfigManager.setConfig=function(b,c){return webApp.EncryptInfo&&webApp.EncryptInfo.asymmetric&&-1!==a.inArray(b,h)?a.Deferred(function(a){f.EncryptInfo(webApp.EncryptInfo.pub,{name:b,table:c}).done(function(b){g.Security.setConfig(b.salt,"AES-128",b.content).done(function(c){c?f.UnEncryptInfo(b.key,c).done(function(b){a.resolve(b.options)}):a.resolve()}).fail(function(c){c.params&&c.params.content?f.UnEncryptInfo(b.key,c.params.content).done(function(b){c.params.options=b.options,a.reject(c)}):a.reject(c)})})}).promise():e.ConfigManager.setConfig(b,c)},g.UserManager.addUser=function(b){return webApp.EncryptInfo&&webApp.EncryptInfo.asymmetric?a.Deferred(function(a){f.EncryptInfo(webApp.EncryptInfo.pub,{user:b}).done(function(b){g.Security.addUser(b.salt,"AES-128",b.content).done(a.resolve).fail(a.reject)})}).promise():e.UserManager.addUser(b)},g.UserManager.modifyPassword=function(b,c,d){return webApp.EncryptInfo&&webApp.EncryptInfo.asymmetric?a.Deferred(function(a){f.EncryptInfo(webApp.EncryptInfo.pub,{name:b,pwd:c,pwdOld:d}).done(function(b){webCaps.OnvifSync?g.Security.modifyPasswordPlain(b.salt,"AES-128",b.content).done(a.resolve).fail(a.reject):g.Security.modifyPasswordByType(b.salt,"AES-128",b.content).done(a.resolve).fail(a.reject)})}).promise():e.UserManager.modifyPassword(b,c,d)},g.Storage.getDeviceAllInfo=function(){return e.send("storage.factory.instance").then(function(a){return e.send("storage.getDeviceAllInfo",void 0,{object:a.result}).then(function(a){return a.params.info||a.params})})},g.IntervideoManager.getVersion=function(b){return webApp.IsNewProtocol?e.IntervideoManager.getVersion(b):a.Deferred(function(a){e.send("IntervideoManager.factory.instance").done(function(c){c.result&&e.send("IntervideoManager.getVersion",{Name:b},{object:c.result}).done(function(b){a.resolve({Onvif:b.params.Version})})})}).promise()},g.DevAudioDetect.detachDetectData=function(a,b){return webApp.IsNewProtocol?e.DevAudioDetect.detachDetectData(a,b):e.send("devAudioDetect.detachDetectData",{proc:b,channel:a})},g.DevAudioDetect.attachDetectData=function(a,b){return webApp.IsNewProtocol?e.DevAudioDetect.attachDetectData(a,b):e.send("devAudioDetect.attachDetectData",{proc:b,channel:a})},g.PTZ.getProtocolList=function(b){return this.instance({channel:b||0}).then(function(b){return e.send("ptz.getProtocolList",void 0,{object:b.result}).then(function(b){return"boolean"===a.type(b.result)?b.params.list:b.result})})},g.PTZ.start=function(a,b,c,d,f,g){var h=this;return this.instance({channel:g||0}).then(function(i){return e.send("ptz.start",{code:a,arg1:b,arg2:c,arg3:d,arg4:f,channel:webApp.IsNewProtocol?void 0:g||0},{object:i.result,seq:h._getSeq()}).fail(function(a){a&&a.error&&285475072===a.error.code&&alert(tl("Please set PTZ protocol of this channel first!"))})})},g.PTZ.stop=function(a,b,c,d,f,g){var h=this;return this.instance({channel:g||0}).then(function(i){return e.send("ptz.stop",{code:a,arg1:b,arg2:c,arg3:d,arg4:f,channel:webApp.IsNewProtocol?void 0:g||0},{object:i.result,seq:h._getSeq()}).fail(function(a){a&&a.error&&285475072===a.error.code&&alert(tl("Please set PTZ protocol of this channel first!"))})})},g.PTZ.attachStatusProc=function(a,b){return this.instance({channel:a||0}).then(function(a){return e.send("ptz.attachStatusProc",{proc:b},{object:a.result}).then(function(a){return a.result})})},g.PTZ.detachStatusProc=function(a,b){return this.instance({channel:a||0}).then(function(a){return e.send("ptz.detachStatusProc",{proc:b},{object:a.result}).then(function(a){return a.result})})},g.NetApp.getUPnPStatus=function(){return e.send("netApp.getUPnPStatus").then(function(a){return a.params})},g.NetApp.refreshUpnpRouter=function(){return e.send("netApp.refreshUpnpRouter")},g.WorkDirectory.setType=function(a,b){return e.send("workDirectory.setType",{pointer:a,type:b})},g.RadiometryManager=new function(){this.getRandomPointTemper=function(a,b){return g.send("RadiometryManager.getRandomPointTemper",{coordinate:a,channel:b})},this.getTemper=function(a){return g.send("RadiometryManager.getTemper",{condition:a}).then(function(a){return a.params})},this.getCaps=function(a,b){return g.send("RadiometryManager.getCaps",{name:a||"All",channel:b||0}).then(function(a){return a.params.caps})},this.startFind=function(a){return g.send("RadiometryManager.startFind",{condition:a})},this.doFind=function(a,b,c){return g.send("RadiometryManager.doFind",{token:a,beginNumber:b,count:c})},this.stopFind=function(a){return g.send("RadiometryManager.stopFind",{token:a})},this.attachProc=function(a,b){return g.send("RadiometryManager.attachProc",{channel:b,proc:a})},this.detachProc=function(a,b){return g.send("RadiometryManager.detachProc",{channel:b,proc:a})},this.toFetch=function(a){return g.send("RadiometryManager.toFetch",{info:{Channel:a}})},this.startRadiometryCalibration=function(a,b){return g.send("RadiometryManager.startRadiometryCalibration",{channel:a,info:b})},this.radiometryCalibration=function(a,b,c,d){return g.send("RadiometryManager.radiometryCalibration",{channel:a,index:b,blackBody:{Temperature:c,HoleSize:d}})},this.saveRadiometryCalibration=function(a){return g.send("RadiometryManager.saveRadiometryCalibration",{channel:a})},this.abortRadiometryCalibration=function(a){return g.send("RadiometryManager.abortRadiometryCalibration",{channel:a})},this.getRadiometryCalibrationInfo=function(a){return g.send("RadiometryManager.getRadiometryCalibrationInfo",{channel:a}).then(function(a){return a.params})},this.getCalibrateCompleteInfo=function(a){return g.send("RadiometryManager.getCalibrateCompleteInfo",{channel:a}).then(function(a){return a.params.info})}},g.ThermographyNuc=new function(){this.getLensInfo=function(a){return g.send("ThermographyNuc.getLensInfo",{channel:a}).then(function(a){return a.params})},this.setLensId=function(a,b){return g.send("ThermographyNuc.setLensId",{channel:a,lensId:b})},this.start=function(a,b){return g.send("ThermographyNuc.start",{channel:a,backupEnable:b})},this.abort=function(a){return g.send("ThermographyNuc.abort",{channel:a})},this.getProgress=function(a,b){return g.send("ThermographyNuc.getProgress",{channel:a,type:b}).then(function(a){return a.params.progress})},this.captureGain=function(a,b){return g.send("ThermographyNuc.captureGain",{channel:a,blackbodyId:b})},this.saveGainMap=function(a){return g.send("ThermographyNuc.saveGainMap",{channel:a})},this.restorePrepare=function(a,b){return g.send("ThermographyNuc.restorePrepare",{channel:a,fileName:b})},this.restoreExecute=function(a){return g.send("ThermographyNuc.restoreExecute",{channel:a})},this.restoreFactoryGainMap=function(a){return g.send("ThermographyNuc.restoreFactoryGainMap",{channel:a})},this.getParams=function(a){return g.send("ThermographyNuc.getParams",{channel:a}).then(function(a){return a.params.info})},this.setParams=function(a,b){return g.send("ThermographyNuc.setParams",{channel:a,info:b})},this.getCoreExInfo=function(a){return g.send("ThermographyNuc.getCoreExInfo",{channel:a}).then(function(a){return a.params.info})},this.sffcStart=function(a){return g.send("ThermographyNuc.sffcStart",{channel:a})},this.sffcAbort=function(a){return g.send("ThermographyNuc.sffcAbort",{channel:a})},this.sffcBlackBody=function(a){return g.send("ThermographyNuc.sffcBlackBody",{channel:a})},this.sffcSave=function(a){return g.send("ThermographyNuc.sffcSave",{channel:a})},this.checkImgUniformity=function(a){return g.send("ThermographyNuc.checkImgUniformity",{channel:a}).then(function(a){return a.params.status})},this.getCalibrateCompleteInfo=function(a){return g.send("ThermographyNuc.getCalibrateCompleteInfo",{channel:a}).then(function(a){return a.params.info})},this.bpcStart=function(a){return g.send("ThermographyNuc.bpcStart",{channel:a})},this.bpcAbort=function(a){return g.send("ThermographyNuc.bpcAbort",{channel:a})},this.bpcSave=function(a){return g.send("ThermographyNuc.bpcSave",{channel:a})},this.bpcRestoreFactorySettings=function(a){return g.send("ThermographyNuc.bpcRestoreFactorySettings",{channel:a})},this.getBprAutoParam=function(a){return g.send("ThermographyNuc.getBprAutoParam",{channel:a}).then(function(a){return a.params.info})},this.setBprAutoParam=function(a,b,c){return g.send("ThermographyNuc.setBprAutoParam",{channel:a,info:{Enable:b,Threshold:c}})},this.getBprManualParam=function(a){return g.send("ThermographyNuc.getBprManualParam",{channel:a}).then(function(a){return a.params.info})},this.setBprManualParam=function(a,b,c){return g.send("ThermographyNuc.setBprManualParam",{channel:a,info:{Enable:b,BadPoints:c}})}},g.ThermographyManager=new function(){d.call(this,"ThermographyManager.factory.instance"),this.getCaps=function(a,b){return this.instance({channel:a||0}).then(function(c){return g.send("ThermographyManager.getCaps",{channel:a||0,name:b||"All"},{object:c.result}).then(function(a){return a.params.caps})})},this.getExternSystemInfo=function(a){return this.instance({channel:a||0}).then(function(b){return g.send("ThermographyManager.getExternSystemInfo",{channel:a},{object:b.result}).then(function(a){return a.params.sysInfo})})},this.getPresetParam=function(a,b){return this.instance({channel:b||0}).then(function(c){return g.send("ThermographyManager.getPresetParam",{mode:a,channel:b},{object:c.result}).then(function(a){return a.params})})},this.getOptimizedRegion=function(a){return this.instance({channel:a||0}).then(function(b){return g.send("ThermographyManager.getOptimizedRegion",{channel:a},{object:b.result}).then(function(a){return a.params})})},this.doFFC=function(a){return this.instance({channel:a||0}).then(function(b){return g.send("ThermographyManager.doFFC",{channel:a},{object:b.result}).then(function(a){return a.params})})},this.fixFocus=function(a,b,c){return this.instance({channel:a||0}).then(function(a){return g.send("ThermographyManager.fixFocus",{linkVideoChannel:b,speed:c},{object:a.result}).then(function(a){return a.params})})}},g.LaserDistMeasure=new function(){this.getDistance=function(a){return g.send("LaserDistMeasure.getDistance",{channel:a}).then(function(a){return a.params.distance})}},g.Encode.getConfigCaps=function(a,b,c){return-1!==webApp.DeviceType.indexOf("TPC")?g.send("encode.getConfigCaps",{channel:a,config:b}).then(function(a){return a.params.caps}):g.send("encode.getConfigCaps",{channel:a,config:b,stream:c||"All"}).then(function(a){return a.params.caps})},g.DevVideoAnalyse.getCollect=function(){return g.send("devVideoAnalyse.factory.getCollect").then(function(a){return a.params.channels||0})},g.DevVideoAnalyse.setModuleState=function(a,b,c){return this.instance({channel:c||0}).then(function(c){return g.send("devVideoAnalyse.setModuleState",{index:a,state:b},{object:c.result}).then(function(a){return a.result})})},g.PtzFunc=new function(){this.setPanGroup=function(a,b){return g.send("PtzFunc.setPanGroup",{channel:0,index:b.index,info:{Name:b.Name,Speed:b.Speed,Enable:b.Enable}})},this.getPanGroup=function(a){return g.send("PtzFunc.getPanGroup",{channel:a}).then(function(a){return a.params})}},g.LensManager=new function(){this.setLensParam=function(a,b){return g.send("LensManager.setLensParam",{channel:a,lensParam:b})},this.getLensParam=function(a){return g.send("LensManager.getLensParam",{channel:a}).then(function(a){return a.params})}}})}(jQuery);