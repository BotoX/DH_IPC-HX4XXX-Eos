!function(a){define(function(require,b,c){function d(b){a.each(A,function(a,c){b!==c&&s.state(c)&&s.state(c,!1)})}function e(){return o.ConfigManager.getConfig("RTSP").done(function(a){var b="rtsp://"+s.ip+":"+a.Port+"/cam/realmonitor?channel="+(s.channel+1)+"&subtype="+(s.stream-1);t.html('<div style="position:absolute;left:0; top:0; bottom:32px; width:100%;">                                <div id="qt" style="position:absolute;left:0;top:0;width:100%;height:100%;">                                    <embed src="../js/sample.mov" qtsrc="'+b+'" width="100%" height="100%" SCALE="ToFit" autoplay="true" loop="false" controller="false" wmode="transparent" type="video/quicktime">                                    </embed>                                    <div id="overShadow" style="width:100%;height:100%;-moz-opacity:.01;opacity:.01;filter:alpha(opacity=1);position:absolute;z-index:1000;top:0;left:0;" oncontextmenu="return false">                                    </div>                                </div>                            </div>                            <div class="download-plugin" style="bottom:0;top:auto;height:32px;">                                <a href="'+y+'" target="_download">                                    <span class="download-plugin-icon"></span>                                    <span t="w_no_plugins"></span>                                </a>                            </div>').translation()})}function f(){return o.ConfigManager.getConfig("RTSP").done(function(a){var b=r.getLoginInfo(),c="rtsp://"+b.username+":"+b.password+"@"+s.ip+":"+a.Port+"/cam/realmonitor?channel="+(s.channel+1)+"&subtype="+(s.stream-1);t.html('<div style="position:absolute;left:0; top:0; bottom:32px; width:100%;">                                <object id="qt" classid="clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921" style="position:absolute;left:0;top:0;width:100%;height:100%;">                                    <embed src="'+c+'" width="100%" height="100%" type="application/x-vlc-plugin">                                    </embed>                                </object>                            </div>                            <div class="download-plugin" style="bottom:0;top:auto;height:32px;">                                <a href="'+y+'" target="_download">                                    <span class="download-plugin-icon"></span>                                    <span t="w_no_plugins"></span>                                </a>                            </div>').translation()})}function g(){var b=!1;if(a.browser.ie&&a.browser.version<11)try{new ActiveXObject("QuickTime.QuickTime"),b=!0}catch(c){}else{navigator.plugins.refresh(!1);for(var d=0;d<navigator.plugins.length;d++)navigator.plugins[d].name.indexOf("QuickTime")>=0&&(b=!0)}return b}function h(){var b=!1;if(a.browser.ie);else{navigator.plugins.refresh(!1);for(var c=0;c<navigator.plugins.length;c++)navigator.plugins[c].name.indexOf("VLC")>=0&&(b=!0)}return b}function i(b,c,d){var e=o.getSession(),f=null;return"SetModuleMode"===b?(i("ShowToolbar",["visible"],[0===d[0]]),3===d[0]?i("SetWindowText",["winID","text"],[0,""]):i("SetWindowText",["winID","text"],[0,r.chkAuthority("Monitor_01")?"":tl("No Play right!")])):(c&&d&&c.length>=d.length&&(f={},a.each(d,function(a,b){f[c[a]]=b})),D[e]||(D={},C=1,D[e]={}),a.Deferred(function(a){var c=C++;D[e][c]=a,v.postMessage({method:b,params:f,id:c},"*")}).promise())}function j(a){var b=JSON.parse(a.data),c=b.id,d=b.event,e=o.getSession();return c||"close"!==d&&"reload"!==d?!c&&d?s.fireEvent(d,b.params):void(D[e]&&D[e][c]&&D[e][c].resolve(b.result)):(r.logout(),s.logout(),void window.removeEventListener("message",m,!1))}function k(){var a=location.hostname;return/:/.test(a)?/\[|\]/.test(a)?a:"["+a+"]":a}function l(){var b=location.port-0;if("http:"===location.protocol.toLowerCase())return b||80;var c=window.webCaps||{},d=c.HttpPort,e=c.HttpsPort,f=[];return c.eth0&&(f.push(c.eth0.IPAddress),f.push(p.v6ToCanonicalForm(c.eth0.IPv6Address))),c.eth2&&(f.push(c.eth2.IPAddress),f.push(p.v6ToCanonicalForm(c.eth2.IPv6Address))),b=b||443,!e&&d?b=d.InnerPort:d&&e.InnerPort&&(e.InnerPort!=e.OuterPort?b=b==e.InnerPort?d.InnerPort:d.OuterPort:s.ConvertDomainToIP(k()).done(function(c){c=c.replace(/\[|\]/g,""),p.Check.ipv6(c)&&(c=p.v6ToCanonicalForm(c)),b=-1!==a.inArray(c,f)?d.InnerPort:d.OuterPort})),b}function m(a){return"domready"==a.data?(v=a.source,a.source.postMessage("domready","*"),s.type="nacl",t.hide(),void w.resolve()):void j(a)}function n(){s.LoadFisheyeModule(),o.DevVideoEncode.getCaps().done(function(a){2===a.EncryptMask&&o.ConfigManager.getConfig("NetSerEncrypt").done(function(a){var b=a[s.channel][0],c=b.Address||b.BakAddress,d=(b.Port||b.BakPort)-0,e=b.NetID;s.SetDecodeKeyEx(0,c,d,e,"")})})}var o=require("jsCore/rpc"),p=require("common/common"),q=p.Cookie,r=require("jsCore/rpcLogin"),s=c.exports={ip:k(),port:l(),channel:0,stream:1,socket:0,type:"",window:1,windowId:0,containerId:null,shapeId:null},t=null,u=null,v=null,w=a.Deferred(),x={LiveSnapshot:1,LiveRecord:2,PlaybackSnapshot:3,PlaybackRecord:4,VideoClips:5,HeatMap:6,AroudWifiSearch:7},y=function(){return a.browser.chrome&&a.browser.version>41?"https://chrome.google.com/webstore/detail/nacl-web-plug-in/pbdcmagkbhnjpjlnpibbmggikpedpilc":a.browser.Platform.win?"/webplugin.exe":a.browser.Platform.mac?"/webplugin.pkg":"/webplugin.tar.bz2"}(),z={dualAudioEnable1:null,dualAudioEnable14:null,dualAudioEnable15:null,recordVideo:null,partialEnlarged:null,activeLocalFocus:null,activeZoneExpose:null,activePTZLocate:null,controlTalking:null,enableMousePtz:null,setAFEnable:null,activeManualLocate:null,recordAllVideo:null,activeMeasureDistance:null,messageMarkDuckClick:null},A=["partialEnlarged","activeLocalFocus","activeZoneExpose","activePTZLocate","activeManualLocate","cutResolute","activeMeasureDistance","messageMarkDuckClick","enableMousePtz"];!function(){function b(){var b,d=!1,e="";if(a.browser.Platform.win?e=webCaps.PluginVersion:a.browser.Platform.mac&&(e=webCaps.MacPluginVersion),a.browser.ie){try{b=new ActiveXObject(o);try{var f=b.GetVersion(),g=c(f,e);g||(d=!0,b.DestoryATLThread(),delete b)}catch(h){}delete b}catch(h){return!1}return d?!1:!0}if(a.browser.chrome&&a.browser.version>41)return!1;navigator.plugins.refresh(!1),b=navigator.mimeTypes[p+n];try{var f=b.enabledPlugin.description.split("-")[2],g=c(f,e);if(!g)return!1}catch(h){}return!(!b||!b.enabledPlugin)}function c(a,b){try{if(a=a.split("."),b=b.split("."),b[3]&&a[3]){var c=parseInt(b[2]-0,10).toString(2),d=parseInt(a[2]-0,10).toString(2),e=c.length,f=d.length,g=!1;if(f>=e)for(var h=d.substring(f-e,f),i=0;e>i;i++)c.charAt(i)>h.charAt(i)&&(g=!0);if(b[3]>a[3]||e>f||g)return!1}}catch(j){}return!0}function d(){function b(){try{u.AddEventListener("ThisIsForTestPluginInit",a.noop),a.each(f,function(b){s.AddEventListener(b,function(){-1!==j.indexOf(b)&&window.isPSS||a.isFunction(k[b])&&k[b].apply(null,arguments)})}),s.RegisterTranslateFunc(tl),s.type="general",w.resolve()}catch(c){setTimeout(b,10)}}if(a.browser.ie){var c=l+n.replace(/\./g,"");-1!==webApp.DeviceType.indexOf("TPC")&&(c=l),t.html('<object id="ocx" width="100%" height="100%" classid="CLSID:'+c+'">                                 <param name="lVideoWindNum" value="1">                                 <param name="VideoWindBarColor" value="414141">                                 <param name="VideoWindTextColor" value="9c9c9c">                               </object>'),u=-1!==webApp.DeviceType.indexOf("TPC")?t.find("#ocx")[0].CreatePlugin():t.find("#ocx")[0]}else t.html('<embed id="ocx" width="100%" height="100%" type='+(p+n)+'                                 VideoWindTextColor="9c9c9c"                                 VideoWindBarColor="414141">                               </embed>'),u=t.find("#ocx")[0];b()}var e={AddEventListener:null,LogoutDevice:null,LoginDevice:["ip","port","username","password"],GetConfigPath:["type"],SetConfigPath:["type","path"],GetDefaultConfigPath:["type"],ConnectRealVideo:["channel","streamType","socketType"],SetSocketType:["socketType"],SetStreamType:["streamType"],DisConnectRealVideo:["channel"],SetModuleMode:null,SetConfig:["name","value"],RegisterTranslateFunc:null,SetShowMode:["nMode"],SetDeviceMode:null,OpenAudioFile:["fileName"],SetFilename:null,ReadFile:["path"],WriteFile:["buffer","mode","path"],ShowFileBrowse:null,ShowSaveOrOpenDlg:["type","suggestedName","accepts"],MakeReport:null,SetIVSEnable:null,ResumePlayBack:["playerId"],SlowPlayBack:["playerId"],FastPlayBack:["playerId"],PausePlayBack:["playerId"],StopDownload:["saveName"],DownloadByFile:["fileInfo","path","saveName"],DownloadByTime:["fileInfo","startTime","endTime","path","saveName"],StopPlayBack:["playerId"],PlaySetVolume:["playerId","volume"],ControlVideoStable:null,SetRegionNum:["regionNum"],SetSelRegionByIndex:["regNoID","left","top","right","bottom"],SetFullScreen:null,SetRegionAttributeByIndex:["regNoID","tip","mode","reserved1","reserved2","reserved3"],DelSelReg:["mode"],SetCurrentDrawId:["nID"],SetFuntionInfo:["strFunction","strInfo"],SetGridNum:["nRow","nCol"],AddShape:null,SetCurShape:null,SetCurPtzID:null,DeleteShape:null,SetObjectConfig:null,SetIVSConfig:null,SetCurModule:null,AddDetectionRegion:null,AddExcludeRegion:null,SetCurName:null,SelectRule:null,CreateHeatMap:null,CreateHeatMapEx:null,EnableHeatMap:null,SubVideoWndCtrl:null,SetMaxPntNum:null,GetLength:null,SetCalibrateAndRules:null,PlaybackByFile:["fileInfo","playerId","channel","locateTime"],PlayOpenSound:["playerId"],PlayStopSound:["playerId"],PlayPreFrame:["playerId"],SetColor:["regionNum","brightness","contrast","saturation","hue"],SetAFEnable:["enable"],SetDelayTime:["level"],ControlTalking:["sampleRate","depth","encodeType","enable"],PartialEnlarged:["enable"],ActiveLocalFocus:["enable"],ActiveZoneExpose:["enable"],ActivePTZLocate:["enable"],ActiveManualLocate:["enable"],ConvertDomainToIP:["domainName"],DualAudioEnable:["channel","enable"],RecordVideo:["path","type","enable"],CatchPicture:["format","path"],CatchPictures:["format","path"],LoginWideView:null,ShowWideView:null,LogoutWideView:null,ShowToolbar:["visible"],RemoveMonDetectReg:null,RemoveAllMonDetectReg:null,SetTranslateString:["language"],SetMonitorEnable:["channel","enable"],OpenHelp:["src","state"],Reload:["href"],CheckFuncSupport:["funcType"],SetProductType:["szMode"],SetMouseDrawEnable:null,SetMouseDrawPen:null,SetVideoWndNum:["num"],EnableMousePtz:["enable"],ConnectAudioPath:null,EnableVideoAnalyseModule:["enable"],CreateMainVideoAnalyseShape:null,GetVideoAnalyseShapeConfigData:["shapeId"],DeleteAllVideoAnalyseShape:null,ShowIVSTrack:null,ShowRuleState:null,SetShowMultiScreenMode:["mode"],SetTrackMode:["mode"],SetRuleTrackAlarm:null,SetTrackTimeout:null,SetDecodeKey:["key"],ChooseFrame:["frameID"],SetDecodeKeyEx:null,SetTalkFromDeviceEnable:["enable"],SetVideoWndTip:["channel","tip"],SetVisibleVideoWnd:["windows","begin"],ConnectRealVideoEx:["curWindow","channel","streamType"],ConnectAllChannel:["channel","streamType"],SetIVSDrawingEnable:["enable"],ClearAllOpData:null,SetCalibrationRange:["CalibrationRange"],SetCalibrationEnable:["channel","enable"],SetCalibrationData:["CalibrationData"],CreateOneIntelShapeContainer:["ID",""],DeleteAllIntelShape:["id"],SetOneIntelShapeVisible:["id","enable"],SelectOneIntelShape:["shapeId","enable"],DeleteOneIntelShape:["shapeId"],GetIntelShapeData:["shapeId"],CreateOneIntelShape:["id","ReSpot","VideoAnalyzeConfig","Spot","name","data",""],SetOneIntelShapeThickness:["shapeId","1/2"],SetOneIntelShapeDisplayColor:["shapeId","normal","R","G","B"],SetOneIntelShapeVisible:["shapeId","enable"],SnatchAtHeatmapData:null,SetCGISessionID:null,ActiveCrossLocation:["bool"],ResetOneIntelShapeData:["data"],DisConnectAllChannel:null,RecordAllVideo:["enable"],SetCalWndSize:null,SetFullScreenMode:["mode"],RegionClip:["Width","Height","Left","Top","Right","Bottom"],CutResolute:null,LoadFisheyeModule:null,ControlFe:["enable"],SetFeInstallMode:["mode"],SetFeShowMode:["mode"],SetFisheyeParamsEx:["index","nx","ny","hangle","vangle","mode"],ActiveMeasureDistance:["enable"],SetJoinVideoNum:["lensType","num"],CatchSingleJoinPic:["index"],StartMultiVideoJoin:null,SetFisheyeParamsEx:null,GetLocalRecordFileList:null,StopAllPlayBack:null,SetIntelShapeDirection:null,RemoveOneIntelShapeContainer:null,AddOneSubIntelShape:["id","filterBoxID","RectangleShape","eventID","shapeID","","shapeData",""],ZoomActive:["id","enable"],SetBprManualConfig:["BadPoints"],SetOneBprManualEnable:["id","enable"],ClearAllBprManualData:null,ClearBprManualDataByID:["id"],BprManualZoomActive:["enable"],GetBackupGainMap:["channel"],SelectOneBprManual:["id"]},f={FocusZoomStatus:["Focus","Zoom","Status"],RegionChanged:["RegionID","left","top","right","bottom"],OutPutModuleRect:null,OutPutStringInfo:["szFunctionName","szOutputInfo"],OutPutWifiInfo:["szFunctionName","szOutputInfo"],FileDialogInfo:null,LocalFocus:null,StateChanged:["channel","state","winID","streamtype"],KeepAliveFailed:null,DeviceReconnected:null,RButtonDown:["winID"],ResolutionChange:["width","height"],PlaybackRecordfileFailed:null,RecordDiskFull:null,ErrorCode:null,CurPlayTime:["CurrentPlayTime"],PlayBackOneFileEnd:["winID","CurrentPlayTime"],DownloadPos:["percent","current","total"],MousePtzEvent:["winID","event","x","y","delta","time","reserve"],VideoAnalyzeConfig:null,CalibrationData:null,CalibrationRange:null,HeatmapData:null,WndSwitch:["windowId"],ZoomInStatus:["disable"],DownLoadError:null,PlayBackLocalFileFailed:null,BadPointsData:["id","BadPoints"],FeInstallMode:null,FisheyeParamsEx:["index","lx","ly","hangle","vangle","isStoped"],MultiVideoJoinInfo:["bResult","pano0","pano1","pano2","dist"]},j=["KeepAliveFailed","DeviceReconnected","RButtonDown","ResolutionChange","PlaybackRecordfileFailed","RecordDiskFull","ErrorCode","CurPlayTime","PlayBackOneFileEnd","DownloadPos"],k={},l=-1!==webCaps.deviceType.indexOf("TPC")?"240999BE-CBAD-44F7-A19D-DA415C8A5B58":"ED1EDBF5-CCC7-4171-A559-6578BD6D",n=-1!==webCaps.deviceType.indexOf("TPC")?"3.1.0.0":a.browser.Platform.win?"3.0.0.3":"3.0.0.2",o="WebActiveX.Plugin."+n,p="application/media-plugin-version-";if(t=a('<div id="video" style="background:rgb(0,0,0);position:absolute;top:-10000px;width:1px;height:1px"></div>').html('<div class="download-plugin" style="margin-top: -16px">                          <a href="'+y+'" target="_download">                            <span class="download-plugin-icon"></span>                            <span t="w_no_plugins"></span></a>                        </div>').translation().appendTo(document.body),-1!==location.href.indexOf("fromWebChromeNACL"))window.addEventListener("message",m,!1);else{var q=setInterval(function(){b()&&(clearInterval(q),d())},1e3);webCaps.is_show_QT_VidAnalyse_VidInAttr&&a.browser.Platform.mac&&(h()&&(s.type="vlc"),g()&&(s.type="qt"))}a.each(e,function(b,c){s[b]=function(){var d=arguments;return"nacl"===s.type?i(b,c,d):a.isFunction(B[b])?B[b].apply(null,d):a.Deferred(function(a){try{var c=null,e=d.length;0===e&&(c=u[b]()),1===e&&(c=u[b](d[0])),2===e&&(c=u[b](d[0],d[1])),3===e&&(c=u[b](d[0],d[1],d[2])),4===e&&(c=u[b](d[0],d[1],d[2],d[3])),5===e&&(c=u[b](d[0],d[1],d[2],d[3],d[4])),6===e&&(c=u[b](d[0],d[1],d[2],d[3],d[4],d[5])),7===e&&(c=u[b](d[0],d[1],d[2],d[3],d[4],d[5],d[6])),8===e&&(c=u[b](d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7])),a.resolve(c)}catch(f){}}).promise()}}),s.addEvent=function(a,b){k[a]=b},s.fireEvent=function(b,c){if(a.isFunction(k[b])){var d=f[b];if(!d||!c)return k[b].call(null);var e=[];a.each(c,function(a,b){var c=d.indexOf(a);-1!==c&&(e[c]=b)}),k[b].apply(null,e)}},s.addEvent("KeepAliveFailed",function(a,b){b&&s.open(a)}),s.addEvent("ResolutionChange",function(b,c){b>0&&c>0&&(Video.resolution.x=b,Video.resolution.y=c,Video.rate=b/c,a.isFunction(k.ResolutionChangePlayBack)&&k.ResolutionChangePlayBack.apply(null),a.isFunction(k.ResolutionChangePTZ)&&k.ResolutionChangePTZ.apply(null),a.isFunction(k.ResolutionChangePreview)&&k.ResolutionChangePreview.apply(null),a.isFunction(k.ResolutionChangeOSD)&&k.ResolutionChangeOSD.apply(null))}),s.addEvent("ErrorCode",function(b,c){return 18==b&&0==c?void a.alert(tl("w_reSearch")):(0==c&&(t.hide().css("z-index",-1),t.find("object").css("z-index",-1),a.alert(tl("w_No Write Right"),function(){t.show().css("z-index",10002),t.find("object").css("z-index",10002)})),void(17==b&&1==c&&(t.hide(),t.html(""),a.alert(tl("w_ErrorAuthorizeRelogin"),function(){s.Reload()}))))}),s.addEvent("RecordDiskFull",function(){t.hide(),jQuery.alert(tl("appEventStorageLowSpace"),function(){t.show()})}),s.addEvent("DeviceReconnected",function(){var b=r.getLoginInfo();r.login(b.username,b.password).done(function(){app.fireEvent("RECONNECTION"),a.isFunction(k.DeviceReconnectedPreview)&&k.DeviceReconnectedPreview.apply(null),a.isFunction(k.DeviceReconnectedPTZ)&&k.DeviceReconnectedPTZ.apply(null),s.state("partialEnlarged")&&s.PartialEnlarged(!0)})}),s.addEvent("StateChanged",function(b,c){1===c&&s.state("recordVideo")&&s.state("recordVideo",!1),-1!==b&&1===c&&(a.isFunction(k.StateChangedPreview)&&k.StateChangedPreview.apply(null),a.isFunction(k.StateChangedHeatMap)&&k.StateChangedHeatMap.apply(null),a.isFunction(k.StateChangedCutZone)&&k.StateChangedCutZone.apply(null),a.isFunction(k.StateChangedPlayBack)&&k.StateChangedPlayBack.apply(null))})}(),function(){var b=null;s.login=function(c,d,g){return a.Deferred(function(h){function i(){s.SetShowMode(0),s.SetDeviceMode(0,1),a.each(x,function(a){s.GetConfigPath(a).done(function(b){s.SetConfigPath(a,b)})}),a.isFunction(b)&&b(!0),"resolved"!==h.state()&&h.resolve(),n()}function j(b){var c={"-1":"DNS Error",3:"Login is overtime.",7:"System is busying.",8:"Sub Connect Fail",9:"Main Connect Fail",10:"the number of connection is maximal.request is refused!"};a.alert(tl(c[b]||"Login control failure!"))}"pending"===w.state()&&h.resolve(),w.done(function(){var b=r.getAuthority();s.SetConfig("AuthorityList",JSON.stringify(b)),s.SetTranslateString(Site.languages[Site.currentLanguage]),s.SetMonitorEnable(s.channel,-1!==a.inArray("Monitor_01",b)),s.SetProductType("IPC"),s.SetVideoWndNum(webApp.CHANNEL_NUMBER),s.socket=g,s.LoginDevice(s.ip,s.port,c,d).done(i).fail(j)}),"qt"===s.type?e().done(i).fail(j):"vlc"===s.type&&f().done(i).fail(j)}).promise()},s.logout=function(){return s.clearState(),s.LogoutDevice()},s.open=function(b,c,d){return s.stream=b||1,void 0!==c&&(s.channel=c),s.window=d||1,"nacl"===s.type?s.ConnectRealVideo(s.channel,s.stream,s.socket):"general"===s.type?-1!==webApp.DeviceType.indexOf("TPC")?s.window>1?s.ConnectAllChannel(s.window,s.stream):s.ConnectRealVideoEx(s.channel,s.channel,s.stream):s.ConnectRealVideo(s.channel,s.stream):"qt"===s.type&&b?e():"vlc"===s.type?f():a.Deferred()},s.setSocketType=function(a){return void 0!==a&&(s.socket=a),s.SetSocketType(a)},s.close=function(b){return-1!==webApp.DeviceType.indexOf("TPC")?!b&&s.state("recordVideo")?a.Deferred():s.DisConnectAllChannel().done(function(a){a&&b&&(s.stream=-1)}):!b&&s.state("recordVideo")?a.Deferred():s.DisConnectRealVideo(s.channel).done(function(a){a&&b&&(s.stream=-1)})},s.cover=function(c,d){var e=a(c);if(!e.is(":hidden")){a.isFunction(d)&&("resolved"===w.state()?d():b=d),a.browser.chrome&&(a(window).off(".plugin"),a(window).on("resize.plugin",function(){var a=t.css("top");t.css("top",-1e4),e.offset(),t.css("top",a)}));var f=e.offset(),g=e.width(),h=e.height();if(t.css({width:g,height:h,top:f.top,left:f.left,"z-index":10002}),"nacl"===s.type){var j=0;document.documentElement.clientWidth-1450>0&&(j=(document.documentElement.clientWidth-1450)/100),a(window).on("scroll.plugin",function(){"Original Size"===e.attr("DHVideoWHMode")&&"Original Size"===webApp.DisplayMode?i("changeOcxStyle",["top","left","width","height","originalWidth","originalHeight"],[f.top-document.body.scrollTop,f.left-document.body.scrollLeft,g,h,Video.resolution.x,Video.resolution.y]):i("changeOcxStyle",["top","left"],[f.top-document.body.scrollTop,f.left-document.body.scrollLeft+j])});var k=["width","height","top","left"],l=[g,h,f.top-document.body.scrollTop,f.left-document.body.scrollLeft+j];"Original Size"===e.attr("DHVideoWHMode")&&"Original Size"===webApp.DisplayMode&&(k.push("originalWidth"),k.push("originalHeight"),l.push(Video.resolution.x),l.push(Video.resolution.y)),i("changeOcxStyle",k,l)}}},s.hide=function(){a(window).off(".plugin"),b=null,t.css("top",-1e4),"nacl"===s.type&&i("changeOcxStyle",["top"],[-1e4])},s.state=function(b,c){return"boolean"===a.type(c)&&z[b]&&c!==z[b].hasClass("current")?void z[b].click():!(!z[b]||!z[b].hasClass("current"))},s.clearState=function(){a.each(z,function(a,b){b&&b.hasClass("current")&&b.click()}),z={}},s.subVideoWndCtrl=function(a,b){return s.SubVideoWndCtrl(a,b)},s.enableHeatMap=function(b){return a.Deferred(function(a){b&&s.DisConnectRealVideo(s.channel),s.EnableHeatMap(b),b?s.open():s.DisConnectRealVideo(s.channel),a.resolve()})},s.controlTalking=function(b){var c=!b.hasClass("current");return a.Deferred(function(a){o.ConfigManager.getConfig(["Encode","Web"]).done(function(b){var d;d=2===s.stream?b[0].params.table[0].ExtraFormat[0].Audio:3===s.stream?b[0].params.table[0].ExtraFormat[1].Audio:b[0].params.table[0].MainFormat[0].Audio,s.SetConfig("audio",JSON.stringify(d)),s.SetConfig("Web",JSON.stringify(b[1].params.table)),s.ControlTalking(d.Frequency,d.Depth,d.Compression,c).done(function(b){a.resolve(b)})}).fail(function(){!c&&a.resolve(!0)})}).promise().done(function(a){a&&(z.controlTalking=b.toggleClass("current"))})},s.dualAudioEnable=function(a){var b=!a.hasClass("current"),c=a.data("mode"),d=null;if("nacl"===s.type){var e=1===c||14===c?0:1;d=s.DualAudioEnable(e,b)}else d=s.SubVideoWndCtrl(c,b?1:0);return d.done(function(d){b?d&&(z["dualAudioEnable"+c]=a.toggleClass("current")):z["dualAudioEnable"+c]=a.toggleClass("current")})};var c=null;s.setAFEnable=function(b){var d=!b.hasClass("current");return s.SetAFEnable(d).done(function(e){e&&(z.setAFEnable=b.toggleClass("current"),d?(c=setTimeout(function(){s.state("setAFEnable")&&z.setAFEnable.click(),-1!==webApp.DeviceType.indexOf("TPC")&&o.ConfigManager.getConfig("VideoInFocus").done(function(b){b[s.windowId]||(b[s.windowId]=a.extend(!0,[],b[0])),b[s.windowId][0].Mode=0,b[s.windowId][1].Mode=0,b[s.windowId][2].Mode=0,o.ConfigManager.setConfig("VideoInFocus",b)})},3e5),o.ConfigManager.getConfig("VideoInFocus").done(function(b){b[s.windowId]||(b[s.windowId]=a.extend(!0,[],b[0])),b[s.windowId][0].Mode=1,b[s.windowId][1].Mode=1,b[s.windowId][2].Mode=1,o.ConfigManager.setConfig("VideoInFocus",b)})):(o.ConfigManager.getConfig("VideoInFocus").done(function(b){b[s.windowId]||(b[s.windowId]=a.extend(!0,[],b[0])),-1!==webApp.DeviceType.indexOf("TPC")?(b[s.windowId][0].Mode=0,b[s.windowId][1].Mode=0,b[s.windowId][2].Mode=0):(b[s.windowId][0].Mode=2,b[s.windowId][1].Mode=2,b[s.windowId][2].Mode=2),o.ConfigManager.setConfig("VideoInFocus",b)}),clearTimeout(c)))})},s.recordVideo=function(a){var b=!a.hasClass("current");return s.RecordVideo("LiveRecord",0,b).done(function(c){if(c&&(z.recordVideo=a.toggleClass("current"),b)){var d;1===s.stream?d="Main":2===s.stream?d="Extra1":3===s.stream&&(d="Extra2"),o.DevVideoEncode.setIFrame(d)}})},s.recordAllVideo=function(a){var b=!a.hasClass("current");return s.RecordAllVideo(b).done(function(b){b&&(z.recordAllVideo=a.toggleClass("current"))})},s.clearShape=function(a,b){return b&&s.DeleteOneIntelShape(b),a?s.DeleteAllIntelShape(a):!0},s.creatShape=function(a,b,c){return s.CreateOneIntelShapeContainer(s.windowId,"").done(function(d){s.containerId=d,s.CreateOneIntelShape(s.containerId,a,"VideoAnalyzeConfig",a,"","","").done(function(a){s.shapeId=a;var c=[];if(b){switch(b){case"red":c=[255,0,0];break;case"yellow":c=[255,255,0];break;case"blue":c=[0,0,255];break;case"green":c=[0,255,0];break;default:c=[0,255,0]}s.SetOneIntelShapeDisplayColor(s.shapeId,0,c[0],c[1],c[2])}}),s.SetOneIntelShapeThickness(s.shapeId,c)})},s.activeManualLocate=function(a){var b=!a.hasClass("current");return b&&d("activeManualLocate"),s.ActiveManualLocate(b).done(function(c){c&&(z.activeManualLocate=a.toggleClass("current"),b?-1!==!webApp.DeviceType.indexOf("TPC")&&s.addEvent("RegionChanged",function(a,b,c,d,e){o.DevIntelliTracker.trackObject({ObjectID:-1,BoundingBox:[b,c,d,e]})}):-1!==!webApp.DeviceType.indexOf("TPC")&&s.addEvent("RegionChanged",null))})},s.partialEnlarged=function(a){var b=!a.hasClass("current");return b&&d("partialEnlarged"),s.PartialEnlarged(b).done(function(c){c&&(z.partialEnlarged=a.toggleClass("current"),b?-1!==webApp.DeviceType.indexOf("TPC")?s.addEvent("ZoomInStatus",function(a){"disable"==a&&s.state("partialEnlarged",!1)}):s.addEvent("RButtonDown",function(a){0===a&&s.state("partialEnlarged",!1)}):-1!==webApp.DeviceType.indexOf("TPC")?s.addEvent("ZoomInStatus",null):s.addEvent("RButtonDown",null))})},s.activeLocalFocus=function(a){var b=!a.hasClass("current");return b&&d("activeLocalFocus"),s.ActiveLocalFocus(b).done(function(c){if(c){z.activeLocalFocus=a.toggleClass("current");var d="nacl"===s.type?"RegionChanged":"LocalFocus";-1!==!webApp.DeviceType.indexOf("TPC")?b&&s.addEvent(d,function(a,b,c,d,e){s.state("activeLocalFocus",!1),-1!==webApp.DeviceType.indexOf("SD")?o.PTZ.focusRegion("InROIRegion",getScreenOrder(b,c,d,e),s.windowId):o.DevVideoInput.focusRegion("InROIRegion",getScreenOrder(b,c,d,e),s.windowId)}):s.addEvent(d,null)}})},s.activeZoneExpose=function(a){var b,c=!a.hasClass("current"),e={},f={};return c&&d("activeZoneExpose"),o.ConfigManager.getConfig(["VideoInBacklight","VideoInMode"]).done(function(a){e=a[0].params.table,f=a[1].params.table,b=f[0].Config[0]}),s.ActiveZoneExpose(c).done(function(d){if(d){z.activeZoneExpose=a.toggleClass("current");var f="nacl"===s.type?"RegionChanged":"LocalFocus";c?s.addEvent(f,function(a,c,d,f,g){e[0][b].Mode="Backlight",e[0][b].BacklightMode="Region",e[0][b].BacklightRegion=[c,d,f,g],o.ConfigManager.setConfig("VideoInBacklight",e).done(function(){})}):s.addEvent(f,null)}})},s.enableMousePtz=function(a){var b=!a.hasClass("current");return b&&d("enableMousePtz"),s.EnableMousePtz(b?1:0).done(function(c){if(c)if(z.enableMousePtz=a.toggleClass("current"),b){var d=[[0,0,0],[0,0,0],[0,0,0]],e=0;s.addEvent("MousePtzEvent",function(a,b,c,f,g,h){switch(b){case 3:var i=(-1*g/20).limit(-1,1);o.PTZ.continueMoveDirectly(e,0,!1,[0,0,i]);break;case 0:d.push([c,f,h])&&d.shift();var j=(c/8192).limit(-1,1),k=(f/8192).limit(-1,1);(e=1)&&o.PTZ.continueMoveDirectly(e,0,!1,[j,k,0]);break;case 1:Math.abs(h-d[2][2])>20&&d.push([c,f,h])&&d.shift();var j=(c/8192).limit(-1,1),k=(f/8192).limit(-1,1),l=d[2][2]-d[1][2];++e<256&&o.PTZ.continueMoveDirectly(e,l,!0,[j,k,0]);break;case 2:d.push([c,f,h])&&d.shift();var j=(c/8192).limit(-1,1),k=(f/8192).limit(-1,1),l=d[2][2]-d[1][2];++e<256&&o.PTZ.continueMoveDirectly(e,l,!1,[j,k,0])}})}else s.addEvent("MousePtzEvent",null)})},s.activePTZLocate=function(a){var b=!a.hasClass("current");return b&&d("activePTZLocate"),s.ActivePTZLocate(b).done(function(c){c?(z.activePTZLocate=a.toggleClass("current"),b?s.addEvent("RegionChanged",function(a,b,c,d,e){var f=((b+d)/16384).limit(-1,1),g=((c+e)/16384).limit(-1,1),h=Math.abs(e-c)>Math.abs(d-b)?e-c:d-b,i=(h/8192).limit(-1,1),j=d>b?i*i:-1*i*i;o.PTZ.moveDirectly([f,g,j],null,s.windowId)}):s.addEvent("RegionChanged",null)):-1!==webApp.DeviceType.indexOf("TPC")&&(z.activePTZLocate=a.toggleClass("current"))})},s.cutResolute=function(a){var b=!a.hasClass("current");return b&&d("cutResolute"),s.CutResolute(b).done(function(){z.cutResolute=a.toggleClass("current")})},s.activeMeasureDistance=function(a){var b=!a.hasClass("current");return b&&d("activeMeasureDistance"),s.ActiveMeasureDistance(b).done(function(c){c&&(z.activeMeasureDistance=a.toggleClass("current"),b?s.addEvent("MousePtzEvent",function(a,b,c,d){o.PtzViewRange.measureDistance(0,c,d).fail(function(a){a&&a.error&&287440897===a.error.code&&alert(tl("Please set height, which shall be bigger than 0!"))})}):s.addEvent("MousePtzEvent",null))})},s.messageMarkColorClick=function(b){if(0!=s.stream)switch(a("#b_duckdrawn").toggleClass("main-top-duck-draw-current"),a("#duck_wrap").css(a("#b_duckdrawn").hasClass("main-top-duck-draw-current")?{display:""}:{display:"none"}),a("#b_duck").hasClass("duckbtn")||(a("#b_duck").hasClass("duckbtn")&&a("ocx")&&s.SetMouseDrawEnable(0)&&(a("#b_duck").removeClass("main-top-icon-icon-duck-red"),a("#b_duck").removeClass("main-top-icon-icon-duck-blue"),a("#b_duck").removeClass("main-top-icon-icon-duck-green"),a("#b_duck").removeClass("duckbtn")),s.SetMouseDrawEnable(1),a("#b_duck").addClass("duckbtn")),a("#duck_wrap a").removeClass("main-top-duckcheck"),a("#b_duck").removeClass("main-top-icon-icon-duck-red").removeClass("main-top-icon-icon-duck-blue").removeClass("main-top-icon-icon-duck-green"),b){case 1:a("#b_duck").addClass("main-top-icon-icon-duck-red"),a("#b_duck_red").addClass("main-top-duckcheck"),s.SetMouseDrawPen(233,16,42,.8,4).done();break;case 2:a("#b_duck").addClass("main-top-icon-icon-duck-blue"),a("#b_duck_blue").addClass("main-top-duckcheck"),s.SetMouseDrawPen(4,20,236,.8,4);break;case 3:a("#b_duck").addClass("main-top-icon-icon-duck-green"),a("#b_duck_green").addClass("main-top-duckcheck"),s.SetMouseDrawPen(6,245,45,.8,4)}},s.messageMarkDuckDrawnClick=function(){a("#b_duckdrawn").toggleClass("main-top-duck-draw-current"),a("#duck_wrap").css(a("#b_duckdrawn").hasClass("main-top-duck-draw-current")?{display:""}:{display:"none"})},s.messageMarkDuckClick=function(b){if(z.messageMarkDuckClick=a("#b_duck"),0!=s.stream&&!a("#b_duck").hasClass("current")){var c=!b.hasClass("current");return c&&d("messageMarkDuckClick"),s.SetMouseDrawEnable(1),a("#b_duck").addClass("current"),void(a("#b_duck_red").hasClass("main-top-duckcheck")?(a("#b_duck").addClass("main-top-icon-icon-duck-red"),s.SetMouseDrawPen(233,16,42,.8,5)):a("#b_duck_blue").hasClass("main-top-duckcheck")?(a("#b_duck").addClass("main-top-icon-icon-duck-blue"),s.SetMouseDrawPen(4,20,236,.8,5)):(a("#b_duck").addClass("main-top-icon-icon-duck-green"),s.SetMouseDrawPen(6,245,45,.8,5)))}s.SetMouseDrawEnable(0),a("#b_duck").removeClass("main-top-icon-icon-duck-red"),a("#b_duck").removeClass("main-top-icon-icon-duck-blue"),a("#b_duck").removeClass("main-top-icon-icon-duck-green"),a("#b_duck").removeClass("current")}}();var B={};!function(){function b(){var a=u.GetPlaybackMsg(0);s.fireEvent("DownloadPos",{percent:-1===a?100:(a/10).floor(),current:0,total:0}),-1===a&&(clearInterval(d),d=null)}var c=null,d=null;B.SetSocketType=function(a){var b=r.getLoginInfo();return B.LoginDevice(s.ip,s.port,b.username,b.password,a)},B.LoginDevice=function(b,c,d,e){return a.Deferred(function(a){var f=u&&u.LoginDeviceEx(b,c,d,e,s.socket);0===f?a.resolve():a.reject(f)}).promise()},B.SetFullScreen=function(){return a.Deferred(function(a){var b=u&&u.OnFullScreenClk();a.resolve(b)}).promise()},B.PartialEnlarged=function(b){return a.Deferred(function(a){if(-1!==webApp.DeviceType.indexOf("TPC")){var c=u&&u.ActiveLocalEnlarge(b);a.resolve(c)}else{var c=u&&u.SubVideoWndCtrl(5,b?1:0);a.resolve(c)}}).promise()},B.ActiveLocalFocus=function(b){return a.Deferred(function(a){if(-1!==webApp.DeviceType.indexOf("TPC"))if(b)var c=s.clearShape(s.containerId,s.shapeId).done(function(){s.creatShape("RectangleShape","red",2)});else var c=s.clearShape(s.containerId,s.shapeId).done(function(){s.creatShape("ReSpot","green")});else var c=u&&u.SubVideoWndCtrl(16,b?1:0);a.resolve(c)}).promise()},B.ActiveZoneExpose=function(b){return a.Deferred(function(a){var c=u&&u.SubVideoWndCtrl(16,b?1:0);a.resolve(c)}).promise()},B.ActivePTZLocate=function(b){return a.Deferred(function(a){var c=u&&u.SubVideoWndCtrl(11,b?1:0);a.resolve(c)}).promise()},B.ActiveManualLocate=function(b){return a.Deferred(function(a){if(-1!==webApp.DeviceType.indexOf("TPC"))if(b)var c=s.clearShape(s.containerId,s.shapeId).done(function(){s.creatShape("RectangleShape","green",2)});else var c=s.clearShape(s.containerId,s.shapeId).done(function(){s.creatShape("ReSpot","green")
});else var c=u&&u.SubVideoWndCtrl(10,b?1:0);a.resolve(c)}).promise()},B.ShowFileBrowse=function(){return a.Deferred(function(a){u&&u.ShowFileBrowse(),s.addEvent("FileDialogInfo",function(b,c){a.resolve(c)})}).promise()},B.SetConfigPath=function(b,c){var d=x[b],e="DhWebVideoPath"+d;return a.Deferred(function(a){q.set(e,c,{expires:30}),a.resolve(u&&u.SetConfigPath(d,c))}).promise()},B.GetConfigPath=function(b){var c=x[b],d="DhWebVideoPath"+c,e=q.get(d);return a.Deferred(function(a){var d=u&&u.GetConfigPath(c);d?a.resolve(d):e?a.resolve(e):B.GetDefaultConfigPath(b).done(function(b){a.resolve(b)})}).promise()},B.ActiveMeasureDistance=function(b){return a.Deferred(function(a){var c=u&&u.SubVideoWndCtrl(23,b?1:0);a.resolve(c)}).promise()},B.GetDefaultConfigPath=function(b){return a.Deferred(function(c){if(u){var d=u.GetUserDirectory()+(a.browser.Platform.win?"\\WebDownload\\":"/WebDownload/")+b;c.resolve(d)}}).promise()},B.CatchPicture=function(b){return a.Deferred(function(a){a.resolve(u&&u.SubVideoWndCtrl(2,b))}).promise()},B.CatchPictures=function(b){return a.Deferred(function(a){a.resolve(u&&u.SubVideoWndCtrl(9,b))}).promise()},B.RecordVideo=function(b,c,d){return a.Deferred(function(a){a.resolve(u&&u.SubVideoWndCtrl(3,d?1:0))}).promise()},B.RecordAllVideo=function(b){return a.Deferred(function(a){a.resolve(b?u&&u.StartAllLocalRecord(0):u&&u.StopAllLocalRecord())}).promise()},B.ControlTalking=function(b,c,d,e){return a.Deferred(function(a){a.resolve(u&&u.ControlTalking(e?1:0))}).promise()},B.ShowSaveOrOpenDlg=function(b,c,d){return a.Deferred(function(e){if(u){if(d&&d.length){var f=a.map(d,function(b){return b.description+"|"+a.map(b.extensions,function(a){return"*."+a}).join(";")}),g=f.join("|")+"||";u.SetFilter(g)}"saveFile"===b?(u.SetFilename(c),u.ShowSave()):"openFile"===b&&u.ShowOpen(),s.addEvent("FileDialogInfo",function(a,b,c){e.resolve([a,b,c])})}}).promise()},B.ReadFile=function(b){return a.Deferred(function(a){a.resolve(u.ReadFile(b))}).promise()},B.WriteFile=function(b,c,d){return a.Deferred(function(a){a.resolve(u.WriteFile(d,b,c))}).promise()},B.ResumePlayBack=function(){return a.Deferred(function(a){u&&a.resolve(u.ResumePlayBack())}).promise()},B.SlowPlayBack=function(){return a.Deferred(function(a){u&&a.resolve(u.SlowPlayBack())}).promise()},B.FastPlayBack=function(){return a.Deferred(function(a){u&&a.resolve(u.FastPlayBack())}).promise()},B.PausePlayBack=function(){return a.Deferred(function(a){u&&a.resolve(u.PausePlayBack())}).promise()},B.StopPlayBack=function(){return clearInterval(c),c=null,a.Deferred(function(a){u&&a.resolve(u.StopPlayBack())}).promise()},B.PlaySetVolume=function(b,c){return a.Deferred(function(a){u&&a.resolve(u.PlaySetVolume(c))}).promise()},B.PlayOpenSound=function(){return a.Deferred(function(a){u&&a.resolve(u.PlayOpenSound())}).promise()},B.PlayStopSound=function(){return a.Deferred(function(a){u&&a.resolve(u.PlayStopSound())}).promise()},B.PlayPreFrame=function(){return a.Deferred(function(a){u&&a.resolve(u.SingleFramePlayBack())}).promise()},B.PlaybackByFile=function(b,d,e,f,g){return a.Deferred(function(a){if(u){if("local"===g)var d=u.PlayBackByLocalFile(b);else if(-1!==webApp.DeviceType.indexOf("TPC"))var d=u.PlayBackByRecordFile(0,f,JSON.encode(b));else var d=u.PlayBackByRecordFileEx(JSON.stringify(b),f);if(a.resolve(d),d){var e=/^0000-00-00/,h=/stop$/,i=function(){if(-1!==webApp.DeviceType.indexOf("TPC")){var a=u.GetPlayedTime(0);if(""===a)return void s.fireEvent("PlayBackOneFileEnd")}else var a=u.GetPlayTime();if(e.test(a)||h.test(a))h.test(a)&&s.fireEvent("PlayBackOneFileEnd",{winID:0,CurrentPlayTime:a.slice(0,19)});else{var b=a.split(" ")[1].split(":").join("");s.fireEvent("CurPlayTime",{CurrentPlayTime:"00"+b})}};c||(c=setInterval(i,1e3))}}}).promise()},B.StopAllPlayBack=function(){return clearInterval(c),c=null,a.Deferred(function(a){u&&a.resolve(u.StopAllPlayBack())}).promise()},B.DownloadByFile=function(c,e,f){return a.Deferred(function(g){u&&s.GetConfigPath(e).done(function(e){var h=f.lastIndexOf("."),i=f.slice(h+1),j=e+(a.browser.Platform.win?"\\":"/")+f.slice(0,h),k=u.DownloadByRecordFile(JSON.stringify(c),j,i);g.resolve(k),k&&(d||(d=setInterval(b,500)))})}).promise()},B.StopDownload=function(){return a.Deferred(function(a){u&&(a.resolve(u.StopDownload(1)),clearInterval(d),d=null)}).promise()},B.DownloadByTime=function(c,e,f,g,h){return a.Deferred(function(i){u&&s.GetConfigPath(g).done(function(g){var j=h.lastIndexOf("."),k=h.slice(j+1),l=g+(a.browser.Platform.win?"\\":"/")+h.slice(0,j),m=u.DownloadByTimeEx(0,e,f,l,k,JSON.stringify(c));i.resolve(m),m&&(d||(d=setInterval(b,500)))})}).promise()},B.Reload=function(b){return a.Deferred(function(){b?location.href=location.protocol+"//"+b:location.reload(!0)}).promise()},B.CheckFuncSupport=function(b){return a.Deferred(function(a){0===b||1===b?a.resolve(!(isDDNS()||/:/.test(location.hostname))):2===b&&a.resolve(!0)}).promise()},B.SetCalWndSize=function(b,c){return a.Deferred(function(a){var d=u&&u.SetCalWndSize(b,c);a.resolve(d)}).promise()},B.CutResolute=function(b){return a.Deferred(function(a){var c=u&&u.SubVideoWndCtrl(24,b?1:0);a.resolve(c)}).promise()}}();var C=1,D={}})}(jQuery);