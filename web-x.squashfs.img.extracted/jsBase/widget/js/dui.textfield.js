!function(a,b){var c={url:/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,email:/^[a-z\d]+(\.[a-z\d]+)*@([\da-z](-[\da-z])?)+(\.{1,2}[a-z]+)+$/,number:/^[0-9]+$/,alpha:/^[a-z]+$/i,alphaNum:/^[a-z0-9]+$/i,noQuotationAnd:/^[^\'\"\&]*$/,ip:/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|0[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|0[0-9]{2}|[0-9]{1,2})$/i};a.widget("dui.textfield",{version:"1.0.1",widgetName:"textfield",widgetEventPrefix:"textfield",options:{charset:"utf-8",charByte:!1,asciiByte:!1,notAsciiByte:!1,length:2048,validReg:null,validRegRet:!0,type:!1,value:"",exceptValue:[""],showLengthError:!1,errorHandle:"none",error:function(b){a(b.target).nextAll(".u-input-error").eq(0).show()},success:function(b){a(b.target).nextAll(".u-input-error").eq(0).hide()}},_create:function(){var b=this.element.attr("maxlength");if(b=parseInt(b),!isNaN(b)&&b>0&&(this.options.length=b),this.element.toggleClass("u-input",!0),this.oldValue=this.options.value,this._isCorrect=!0,a.browser.ie8||a.browser.ie7){var c=this.element.width(),d=this.element.height(),e={};c&&(e.width=c),d&&(e.height=d),this.element.css(e)}this._setupEvents(),this._handValue()},_setupEvents:function(){var b=a.ui.ie&&a.browser.version<=8?"propertychange":"input",c={blur:this._handValue,paste:this._handValue};c[b]=this._handValue,this._on(c)},_clipValue:function(a){var b,c="",d=a.length,e=this.element.attr("maxlength");for(e=parseInt(e),!isNaN(e)&&e>0&&(this.options.length=e),b=0;d>=b&&(c=a.substr(0,b),!(this._getValueLen(c)>this.options.length));b++);return a.substr(0,b-1)},_getValueLen:function(a){if(a=String(a),this.options.charByte)return a.length*this.options.charByte;if(this.options.asciiByte&&this.options.notAsciiByte){for(var b=0,c=0,d=a.length;d>b;b++)charCode=a.charCodeAt(b),c+=charCode<=127?this.options.asciiByte||1:this.options.notAsciiByte||3;return c}return"utf-8"==this.options.charset?a.lengthB():a.length},_regValid:function(d){var e=this.options.validReg,f=!0;if(null!==e){if("regexp"!=a.type(e))throw new Error("widget "+this.widgetName+" error params : validReg, "+e+" not a right Regexp expression.");f=e.test(d)===this.options.validRegRet}else if(this.options.type){if(e=c[this.options.type],e===b)throw new Error("widget "+this.widgetName+" error params : type, "+this.options.type+" is not support.");f=e.test(d)}return f},_handValue:function(b){if(!b||"propertychange"!==b.type||"value"===b.originalEvent.propertyName){var c=this.element.val();if(("string"==a.type(b)||"number"==a.type(b))&&(c=b),this.element.prop("required")&&(this.element.toggleClass("u-required",""===c),""===c))return void this._setValue(this.oldValue);var d=!0;-1===a.inArray(c,this.options.exceptValue)&&(d=this._regValid(c)),d===!1?("prevent"==this.options.errorHandle&&(c=this.oldValue,this._setValue(c)),this._trigger("error",b,{ui:this,type:"invalid"})):(this._trigger("success",b,{ui:this}),this.oldValue=c);var e=this.element.attr("maxlength");return e=parseInt(e),!isNaN(e)&&e>0&&(this.options.length=e),this._getValueLen(c)>this.options.length&&(c=this._clipValue(c),this._setValue(c),this.options.showLengthError===!0&&(d=!1,this._trigger("error",b,{ui:this,type:"maxlength"}))),this._isCorrect=d,c}},_setOption:function(a,b){this._super(a,b),"disabled"===a?this.element.prop("disabled",!!b):"value"===a&&this.element.val(b),this._handValue()},value:function(a){return 0===arguments.length?this.element.val():(this.element.val(a),void this._handValue())},isCorrect:function(){return this._isCorrect},_setValue:function(a,b){var c=this._getCursortPosition(this.element[0]),d=this.element.val();this.element.val(a),d!=a&&b!==!1&&this._setCaretPosition(this.element[0],c-1)},_getCursortPosition:function(a){var b=0;if(document.selection){var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart);return b},_setCaretPosition:function(a,b){if(a.setSelectionRange)a.focus(),a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}}})}(jQuery);