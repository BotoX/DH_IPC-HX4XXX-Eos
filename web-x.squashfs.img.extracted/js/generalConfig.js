!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab"),b.exports.prototype.gen_trigger=ability.get("VideoInputCaps").then(function(a){return!(!a||!a.SubChannel)})}),define("gen_local",function(require,b,c){var d,e,f,g,h,i,j=require("jsCore/rpc"),k=require("jsCore/pageBase"),l=require("jsCore/ability"),m=require("common/common"),n=null,o=null,p=null,q=null,r=!1,s=null,t=!1,u=null,v=null,w=null,x=null,y=null,z=null,A="";c.exports=k.extend({init:function(){n=this,o=j.DevVideoOutput.getCollect(),u=j.DevVideoOutput.enumModes(),a.when(o,l.is("TVOutConflict")).done(function(a,b){!b&&a&&(n.$("#gen_TVShow").show(),l.get("CaptureSetResolution").done(function(a){x=a,x&&(n.$("#gen_simulate_resolution_wrap").removeClass("fn-hide"),n.$("#gen_TVShow").hide())})),t=b}),l.get("VideoOutControlMode").done(function(a){a&&a.Support&&n.$("#gen_tab_mode_wrap").removeClass("fn-hide")}),w=n.$("#gen_tab_mode"),v=n.$("#gen_tab_resolution_mode"),q=l.get("FaceBoardCaps").done(function(a){a&&a.StatusLightGlobal&&a.StatusLightGlobal.Support&&(n.$("#gen_LightShow").show(),r=!0)}).always(function(){n.render()}),p=a.when(l.get("Languages"),l.get("VideoStandards")).done(function(b,c){var d=n.$("#gen_language").empty(),e=n.$("#gen_standard").empty();a.each(b,function(a,b){d.append("<option value="+b+" t="+b+"></option>")}),d.translation(),a.each(c,function(a,b){e.append("<option value="+b+" t="+b+"></option>")}),e.translation()}),s=g_videoInConflict.TVOut.hasConflict(),i=a.validator([{element:n.$("#gen_devName"),check:[m.Check.alphaNumLine,m.Check.require],errorMsg:["w_wrongDeviceName","w_wrongDeviceName"],events:["keyup","keyup"],errorElem:".u-input-error"}],function(a){a.parent().translation()}),n.$("#gen_devNo").numberfield({max:998,min:0,allowDecimal:!1,allowNegative:!1}),n.$("#gen_LockTimes").numberfield({max:10,min:3,allowDecimal:!1,allowNegative:!1});var b=n.$("#gen_TVEnable").empty();u.done(function(c){a.each(c,function(a,c){var d="on";"Auto"!==c.Mode.Format&&(d=c.Mode.Format),b.append("<option value="+c.Mode.Format+" t="+d+"></option>")}),b.append('<option value="Off" t="off"></option>').translation()}).fail(function(){b.append('<option value="Auto" t="on"></option><option value="Off" t="off"></option>').translation()}).always(function(){b.get(0).selectedIndex=0}),v.empty(),u.done(function(b){y=b,x&&(v.append('<option value="Off" t="off"></option>').translation(),a.each(b,function(a,b){var c="["+b.Mode.Format+"]["+b.Mode.Height+b.Mode.ScanFormat.slice(0,1)+"-"+b.Mode.RefreshRate+"FPS]";v.append("<option value="+c+">"+c+"</option>")}))}).fail(function(){v.append('<option value="Auto" t="on"></option><option value="Off" t="off"></option>').translation()}),n._bind()},_bind:function(){n.$("#gen_LockEnable").on("click",function(a){n.$(a.target).prop("checked")&&isEnable("is_show_WatchNet")?n.$("#gen_LocktimesShow").show():n.$("#gen_LocktimesShow").hide()}),n.$("#gen_TVEnable").on("change",function(a){"Off"!==n.$(a.target).val()&&s.then(function(){n.tip("warning","w_TVOutConfilctIntell",4e3)})})},render:function(){n._getConfig()},_getConfig:function(b){a.when(o,q,p).always(function(){var a=["General","Language","VideoStandard","VideoOut"];r&&a.push("LightGlobal"),j.ConfigManager.getConfig(a).done(function(a){a[0].result&&(d=a[0].params.table),a[1].result&&(e=a[1].params.table),a[2].result&&(f=a[2].params.table),a[3].result&&(g=a[3].params.table),a[4]&&a[4].result&&(h=a[4].params.table),n._renderElements(),b&&n.tip("success","Operateingsuccess")}).fail(function(){b&&n.tip("error","Operateingfailure")})})},_renderElements:function(){n.$("#gen_devName").val(d.MachineName),n.$("#gen_devNo").numberfield("value",d.LocalNo),n.$("#gen_language").val(e),-1!==webApp.DeviceType.indexOf("3110")?n.$("#gen_standard").empty().append("<option value="+f+" t="+f+"></option>").translation():n.$("#gen_standard").val(f),void 0!=d.LockLoginEnable&&isEnable("is_show_WatchNet")&&(n.$("#gen_LockEnableShow").show(),n.$("#gen_LockEnable").prop("checked",d.LockLoginEnable)),d.LockLoginEnable&&isEnable("is_show_WatchNet")?(n.$("#gen_LocktimesShow").show(),n.$("#gen_LockTimes").numberfield("value",d.LockLoginTimes)):n.$("#gen_LocktimesShow").hide(),o.done(function(a){a&&g&&!t&&(n.$("#gen_TVEnable").val(g[0].Enable?g[0].Mode&&g[0].Mode.Format?g[0].Mode.Format:"Auto":"Off"),x&&g[0].CurrentControlMode&&(w.val(g[0].CurrentControlMode).change(),z=w.val(),n.disabled(v,!("software"===g[0].CurrentControlMode)),g[0].Enable?g[0].Mode&&g[0].Mode.Format&&v.val("["+g[0].Mode.Format+"]["+g[0].Mode.Height+g[0].Mode.ScanFormat.slice(0,1)+"-"+g[0].Mode.RefreshRate+"FPS]"):v.val("Off"),A=v.val()))}),h&&(h[0].Enable===!0?n.$("#gen_LightEnable").prop("checked",!0):n.$("#gen_LightdisEnable").prop("checked",!0)),i.validate()},onSelGenMode:function(){"software"===w.val()?(n.disabled(v,!1),n.disabled(n.$("#gen_standard"),!1)):"hardware"===w.val()&&(n.disabled(v,!0),n.disabled(n.$("#gen_standard"),!0)),g[0].CurrentControlMode=w.val()},onSelResMode:function(){var a=v.get(0).selectedIndex-1;a>-1&&x&&(g[0].Mode.Format=y[a].Mode.Format,g[0].Mode.Height=y[a].Mode.Height,g[0].Mode.Width=y[a].Mode.Width,g[0].Mode.RefreshRate=y[a].Mode.RefreshRate,g[0].Mode.ScanFormat=y[a].Mode.ScanFormat,g[0].Mode.BPP=y[a].Mode.BPP)},onRefresh:function(){n._getConfig(!0)},onDefault:function(){var a=["General","Language","VideoStandard","VideoOut"];r&&a.push("LightGlobal"),j.ConfigManager.getDefault(a).done(function(a){a[0].result&&(d=a[0].params.table),a[1].result&&(e=a[1].params.table),a[2].result&&(f=a[2].params.table),a[3].result&&!t&&(g=a[3].params.table,g[0].Enable&&s.then(function(){setTimeout(function(){n.tip("warning","w_TVOutConfilctIntell",4e3)},2e3)})),a[4]&&a[4].result&&(h=a[4].params.table),n._renderElements(),n.tip("success","Defaultsuccess")}).fail(function(){n.tip("error","Defaultfailure")})},onSave:function(){if(i.isInvalid())return n.tip("warning",i.errors()[0].errorMsg);d.MachineName=n.$("#gen_devName").val(),d.LocalNo=n.$("#gen_devNo").numberfield("value"),e=n.$("#gen_language").val(),f=n.$("#gen_standard").val(),void 0!=d.LockLoginEnable&&isEnable("is_show_WatchNet")&&(d.LockLoginEnable=n.$("#gen_LockEnable").prop("checked")),void 0!=d.LockLoginTimes&&isEnable("is_show_WatchNet")&&(d.LockLoginTimes=n.$("#gen_LockTimes").numberfield("value"));var b=["General","Language","VideoStandard"],c=[d,e,f];r&&(h[0].Enable=n.$("#gen_LightEnable").prop("checked"),b.push("LightGlobal"),c.push(h)),o.done(function(a){if(a&&g&&!t){if(x){var d=n.$("#gen_tab_resolution_mode").val();g[0].Enable="Off"!==d}else{var e=n.$("#gen_TVEnable").val();g[0].Enable="Off"!==e,g[0].Mode&&"Off"!==e&&(g[0].Mode.Format=e)}b.push("VideoOut"),c.push(g)}}).always(function(){j.ConfigManager.setConfig(b,c).done(function(a){m.chkMutilCallRet(a)?(n.tip("success","Succeed in saving configure"),webApp.isNeedReboot(a)&&webApp.reboot("The configration take effect! The device is restarting now,please reconnect later..."),getlang(e,retranslate)):n.tip("error","Saving failure")}).always(function(){!x||z===g[0].CurrentControlMode&&A==="["+g[0].Mode.Format+"]["+g[0].Mode.Height+g[0].Mode.ScanFormat.slice(0,1)+"-"+g[0].Mode.RefreshRate+"FPS]"||a.alert(tl("w_Reboot Device then take effect!"))})})}})}),define("gen_time",function(require,b,c){function d(a,b,c,d){for(var e=Math.floor((a-1)/4)-2*(a-1)+b+Math.floor(b/4)+Math.floor(13*(c+1)/5)+d-1;0>e;)e+=7;return e%7}var e,f,g,h,i,j,k,l=require("jsCore/rpc"),m=require("jsCore/pageBase"),n=require("common/common"),o=null;c.exports=m.extend({init:function(){o=this,k=a.validator([{element:o.$("#gen_NTPServer"),check:[n.Check.alphaNumLineDot,n.Check.alphaNumLineDot],errorMsg:["w_wrongNTPName","w_wrongNTPName"],events:["keyup","blur"],errorElem:".u-input-error"}],function(a){a.parent().translation()}),e=o.$("#gen_sysDate").datepicker({change:o._changeDate}),f=o.$("#gen_sysTime").timefield({onAddDay:function(){o._getCurTime()},onAddMinute:function(){o._getCurTime()}}),g=o.$("#gen_DSTStartT").timefield({disableS:!0}),h=o.$("#gen_DSTEndT").timefield({disableS:!0}),o.$("#gen_NTPPort").numberfield({max:65535,min:0,allowDecimal:!1,allowNegative:!1}),o.$("#gen_NTPUPeriod").numberfield({max:30,min:0,allowDecimal:!1,allowNegative:!1}),o.$("#gen_DSTWeek").on("click",function(){o._showDST(0)}),o.$("#gen_DSTDate").on("click",function(){o._showDST(1)}),o.render()},_changeDate:function(){o.$("#gen_DSTWeek").prop("checked")?o._putDSTWeek():o._putDSTDate()},render:function(){o._getConfig()},_showDST:function(a){1==a?(o.$("#gen_DSTshowSW").hide(),o.$("#gen_DSTshowEW").hide(),o.$("#gen_DSTshowSD").show(),o.$("#gen_DSTshowED").show(),o._putDSTDate()):(o.$("#gen_DSTshowSD").hide(),o.$("#gen_DSTshowED").hide(),o.$("#gen_DSTshowSW").show(),o.$("#gen_DSTshowEW").show(),o._putDSTWeek())},_getConfig:function(a){l.Global.getCurrentTime().done(function(b){l.ConfigManager.getConfig(["Locales","NTP"]).done(function(c){n.chkMutilCallRet(c)?(i=c[0].params.table,j=c[1].params.table,o._putCurTime(b),o._renderElements(),o.changeDateFormat(),o.changeTimeFormat(),a&&o.tip("success","Operateingsuccess")):a&&o.tip("error","Operateingfailure")})})},_renderElements:function(){var b=i.TimeFormat.split(" ");o.$("#gen_dateFormat").val(b[0]),o.$("#gen_timeFormat").val(b[1]),o.$("#gen_timeZone").val(j.TimeZone),o.$("#gen_DSTEnable").prop("checked",i.DSTEnable),0!==i.DSTStart.Week?(o.$("#gen_DSTWeek").prop("checked",!0),o._showDST(0),o._putDSTWeek()):(o.$("#gen_DSTDate").prop("checked",!0),o._showDST(1),o._putDSTDate()),g.timefield("format","24"),g.timefield("value",a.pad(i.DSTStart.Hour,2)+":"+a.pad(i.DSTStart.Minute,2)+":00"),h.timefield("format","24"),h.timefield("value",a.pad(i.DSTEnd.Hour,2)+":"+a.pad(i.DSTEnd.Minute,2)+":00"),o.$("#gen_NTPEnable").prop("checked",j.Enable?!0:!1),o.$("#gen_NTPServer").val(j.Address),o.$("#gen_NTPPort").numberfield("value",j.Port),o.$("#gen_NTPUPeriod").numberfield("value",j.UpdatePeriod),k.validate()},_putDSTWeek:function(){o.$("#gen_DSTStartWM").val(i.DSTStart.Month),o._changeWeek("#gen_DSTStartWM","#gen_DSTStartWS");var a=i.DSTStart.Week;o.$("#gen_DSTStartWS").val(0==a||o.$("#gen_DSTStartWS option").size()==a?1:a),o.$("#gen_DSTStartWW").val(i.DSTStart.Day>6?1:i.DSTStart.Day),o.$("#gen_DSTEndWM").val(i.DSTEnd.Month),o._changeWeek("#gen_DSTEndWM","#gen_DSTEndWS");var a=i.DSTEnd.Week;o.$("#gen_DSTEndWS").val(0==a||o.$("#gen_DSTEndWS option").size()==a?1:a),o.$("#gen_DSTEndWW").val(i.DSTEnd.Day>6?1:i.DSTEnd.Day)},changeWeekMonthBegin:function(){o._changeWeek("#gen_DSTStartWM","#gen_DSTStartWS"),o.$("#gen_DSTStartWS").val(1)},changeWeekMonthEnd:function(){o._changeWeek("#gen_DSTEndWM","#gen_DSTEndWS"),o.$("#gen_DSTEndWS").val(1)},_putDSTDate:function(){o.$("#gen_DSTStartDM").val(i.DSTStart.Month),o._onChangeDay(i.DSTStart.Month,"#gen_DSTStartDD"),o.$("#gen_DSTStartDD").val(i.DSTStart.Day>0?i.DSTStart.Day:1),o.$("#gen_DSTEndDM").val(i.DSTEnd.Month),o._onChangeDay(i.DSTEnd.Month,"#gen_DSTEndDD"),o.$("#gen_DSTEndDD").val(i.DSTEnd.Day>0?i.DSTEnd.Day:1)},changeDateMonthBegin:function(){o._onChangeDay(o.$("#gen_DSTStartDM").val(),"#gen_DSTStartDD")},changeDateMonthEnd:function(){o._onChangeDay(o.$("#gen_DSTEndDM").val(),"#gen_DSTEndDD")},_getCurTime:function(){l.Global.getCurrentTime().done(function(a){o._putCurTime(a),o.changeDateFormat(),o.changeTimeFormat()})},_putCurTime:function(a){var b=a.split(" "),c=b[0],d=b[1];e.datepicker("format","yyyy-mm-dd"),e.datepicker("value",new Date(c.replace(/-/g,"/"))),f.timefield("format","24"),f.timefield("value",d),f.timefield("stop"),f.timefield("run")},changeDateFormat:function(){switch(o.$("#gen_dateFormat").val()){case"MM-dd-yyyy":e.datepicker("format","mm-dd-yyyy");break;case"dd-MM-yyyy":e.datepicker("format","dd-mm-yyyy");break;default:e.datepicker("format","yyyy-mm-dd")}},changeTimeFormat:function(){"HH:mm:ss"==o.$("#gen_timeFormat").val()?(f.timefield("format","24"),g.timefield("format","24"),h.timefield("format","24")):(f.timefield("format","12"),g.timefield("format","12"),h.timefield("format","12"))},onSynPCTime:function(){var b=new Date,c=b.getFullYear(),d=a.pad(b.getMonth()+1,2),e=a.pad(b.getDate(),2),f=a.pad(b.getHours(),2),g=a.pad(b.getMinutes(),2),h=a.pad(b.getSeconds(),2),i=c+"-"+d+"-"+e,j=f+":"+g+":"+h,k=i+" "+j;l.Global.setCurrentTime(k,5).done(function(){o._getCurTime(),o.tip("success","Succeed in saving configure")}).fail(function(){o.tip("error","Saving failure")})},_changeWeek:function(b,c){var f=o.$(c).empty(),g=["1st","2nd","3rd","4th","LastWeek"],h=[1,2,3,4,-1];if(2==o.$(b).val()){var i=e.datepicker("getDate"),j=new Date(i.year,2,0).getDate(),k=d(21,i.year-0-2e3-1,14,1);28==j&&0==k&&(g=["1st","2nd","3rd","LastWeek"],h=[1,2,3,-1])}a.each(g,function(b,c){a('<option value="'+h[b]+'" t="'+c+'"></option>').appendTo(f)}),f.translation()},_onChangeDay:function(b,c){$content=o.$(c).empty();for(var d=e.datepicker("getDate"),f=new Date(d.year,b,0).getDate(),g=0;f>g;g++)a('<option value="'+(g+1)+'">'+(g+1)+"</option>").appendTo($content)},onRefresh:function(){o._getConfig(!0)},onDefault:function(){l.ConfigManager.getDefault(["Locales","NTP"]).done(function(a){n.chkMutilCallRet(a)?(i=a[0].params.table,j=a[1].params.table,o._renderElements(),o.changeDateFormat(),o.changeTimeFormat(),o.tip("success","Defaultsuccess")):o.tip("error","Defaultfailure")})},onSave:function(){function a(){return l.ConfigManager.setConfig(["Locales","NTP"],[i,j]).done(function(a){n.chkMutilCallRet(a)?o.tip("success","Succeed in saving configure"):o.tip("error","Saving failure")})}if(k.isInvalid())return o.tip("warning",k.errors()[0].errorMsg);j.Enable=o.$("#gen_NTPEnable").prop("checked"),j.Address=o.$("#gen_NTPServer").val(),j.Port=o.$("#gen_NTPPort").numberfield("value"),j.UpdatePeriod=o.$("#gen_NTPUPeriod").numberfield("value"),j.TimeZone=o.$("#gen_timeZone").val()-0,i.DSTEnable=o.$("#gen_DSTEnable").prop("checked"),i.TimeFormat=o.$("#gen_dateFormat").val()+" "+o.$("#gen_timeFormat").val();var b=e.datepicker("getDate"),c=g.timefield("value").split(":");i.DSTStart.Year=b.year,i.DSTEnd.Year=b.year,i.DSTStart.Hour=c[0]-0,i.DSTStart.Minute=c[1]-0;var d=h.timefield("value").split(":");i.DSTEnd.Hour=d[0]-0,i.DSTEnd.Minute=d[1]-0;var m=o.$("#gen_DSTStartDM").val()-0,p=o.$("#gen_DSTStartDD").val()-0,q=o.$("#gen_DSTEndDM").val()-0,r=o.$("#gen_DSTEndDD").val()-0;o.$("#gen_DSTDate").prop("checked")?(i.DSTStart.Month=m,i.DSTStart.Day=p,i.DSTStart.Week=0,i.DSTEnd.Month=q,i.DSTEnd.Day=r,i.DSTEnd.Week=0):(i.DSTStart.Month=o.$("#gen_DSTStartWM").val()-0,i.DSTStart.Day=o.$("#gen_DSTStartWW").val()-0,i.DSTStart.Week=o.$("#gen_DSTStartWS").val()-0,i.DSTEnd.Month=o.$("#gen_DSTEndWM").val()-0,i.DSTEnd.Day=o.$("#gen_DSTEndWW").val()-0,i.DSTEnd.Week=o.$("#gen_DSTEndWS").val()-0),l.Global.getCurrentTime().done(function(b){if(f.timefield("isRun")&&e.datepicker("value")===b.split(" ")[0])a();else{var b=e.datepicker("value")+" "+f.timefield("value");l.Global.setCurrentTime(b,5).done(function(){a().done(o._getCurTime)})}})}})}),define("gen_trigger",function(require,a,b){var c=require("jsCore/rpc"),d=require("jsCore/pageBase"),e=require("jsCore/ability"),f=require("common/common").Cookie,g=null,h=null,i=0,j=3,k=0,l=[],m=[],n=0,o=1,p=0;b.exports=d.extend({init:function(){g=this,f.set("SessionID",c.getSession(),{path:"/"}),e.get("VideoInputCaps").done(function(a){j=a.SubChannel,4==j&&(o=2),plugin.SetJoinVideoNum(o,j),g.render()})},render:function(){plugin.SetModuleMode(1),plugin.open(),plugin.addEvent("MultiVideoJoinInfo",function(a){if(l.length=0,m.length=0,a){n=0;for(var b=0;j>b;b++){var c=arguments[1].split(".");c[c.length-2]+=b;var d=c.join("."),e=d.split("\\"),f=e[e.length-1];l.push(f),m.push(d)}var e=arguments[2].split("\\"),f=e[e.length-1];l.push(f),m.push(arguments[2]),g.uploadFile()}else g.$("#gen_triggerTip").tip("error",tl("Operateingfailure"))})},leave:function(){plugin.addEvent("MultiVideoJoinInfo",null),plugin.close(),plugin.hide()},onStartMontage:function(){return""==plugin.type?void g.$("#gen_triggerTip").tip("warning",tl("w_NeedPlugin")):void c.ConfigManager.getConfig("MultiVideoSensor").done(function(a){g.$("#gen_triggerTip").tip("warning",tl("w_updating,please wait."),-1),h=a,k=0,g.changeSensor()})},changeSensor:function(){h[i].EnableSensorMask=Math.pow(2,k),c.ConfigManager.setConfig("MultiVideoSensor",h).done(function(){4!=j||p||c.ConfigManager.getConfig("Encode").done(function(a){var b=a[i].MainFormat[0].Video.Height;p=1080==b?2:3,plugin.SetJoinVideoNum(p,j)}),window.setTimeout(function(){plugin.CatchSingleJoinPic(k).done(function(){k++,j>k?g.changeSensor():(plugin.StartMultiVideoJoin(),3==j?h[i].EnableSensorMask=7:4==j&&(h[i].EnableSensorMask=15),c.ConfigManager.setConfig("MultiVideoSensor",h))})},3e3)})},uploadFile:function(){plugin.ReadFile(m[n]).done(function(a){g.$("#trigger_con").val(a);var b=l[n];g.$("#trigger_form").attr("action","/RPC2_UploadFileWithName/mnt/mtd/MultiSensor/"+b),g.$("#trigger_submit").trigger("click")})},destory:function(){p=0}}),window.audioUploadStatue=function(a){a?(n++,j>=n?setTimeout(function(){g.uploadFile()},2e3):(plugin.hide(),setTimeout(function(){webApp.reboot("w_Rebooting...")},5e3))):g.$("#gen_triggerTip").tip("error",tl("Operateingfailure"))}})}(jQuery);