!function(a){var b={};define(function(require,c,d){d.exports=require("jsCore/pageTab"),d.exports.prototype.enc_inter=a.when(rpc.DevVideoEncode.getCaps(),ability.is("ROIConflict")).then(function(a,c){return b=a,!(c||!isEnable("is_show_roi")||!a.MaxROICount)}),d.exports.prototype.enc_encrypt=rpc.DevVideoEncode.getCaps().then(function(a){return 2===a.EncryptMask})}),define("enc_encode",function(require,c,d){function e(a){var b=[],c=[],d=L.Flip,e=L.Rotate90,f=L.Mirror;if(1===e?(b[0]=a[1],b[1]=8191-a[0],b[2]=a[3],b[3]=8191-a[2]):2===e?(b[0]=8191-a[1],b[1]=a[0],b[2]=8191-a[3],b[3]=a[2]):d?(b[0]=a[0],b[1]=8191-a[1],b[2]=a[2],b[3]=8191-a[3]):(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]),b[0]>b[2]){var g=b[0];b[0]=b[2],b[2]=g}if(b[1]>b[3]){var h=b[1];b[1]=b[3],b[3]=h}return f?(c[0]=8191-b[2],c[1]=b[1],c[2]=8191-b[0],c[3]=b[3],c):b}function f(a){var b=[],c=[],d=L.Flip,e=L.Rotate90,f=L.Mirror;if(1===e?(b[0]=8191-a[1],b[1]=a[0],b[2]=8191-a[3],b[3]=a[2]):2===e?(b[0]=a[1],b[1]=8191-a[0],b[2]=a[3],b[3]=8191-a[2]):d?(b[0]=a[0],b[1]=8191-a[1],b[2]=a[2],b[3]=8191-a[3]):(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]),b[0]>b[2]){var g=b[0];b[0]=b[2],b[2]=g}if(b[1]>b[3]){var h=b[1];b[1]=b[3],b[3]=h}return f?(0===e?(c[0]=8191-b[2],c[1]=b[1],c[2]=8191-b[0],c[3]=b[3]):(c[0]=b[0],c[1]=8191-b[3],c[2]=b[2],c[3]=8191-b[1]),c):b}var g=require("jsCore/pageBase"),h=require("jsCore/rpc");require("widget/js/dui.iconlist"),require("widget/js/dui.iconSelect");var i,j,k,l,m,n,o,p,q,r,s=null,t=null,u=null,v=0,w=0,x=0,y=[0,32,48,64,80,96,128,160,192,224,256,320,384,448,512,640,768,896,1024,1280,1536,1792,2048,4096,6144,8192,10240,12288,14336,16384,18432,20480,22528],z={Main:"H.264",Baseline:"H.264B",High:"H.264H"},A=0,B=["H.264"],C=!0,D=[{Compression:"H.264",Policy:0},{Compression:"H.264",Policy:0},{Compression:"H.264",Policy:0}],E=null,F=null,G=["H.264"],H=null,x=0,I=!1,J=[],K=[],L={},M="Extra1",N=null,O=null,P=null;d.exports=g.extend({init:function(){if(s=this,webApp.GongAnDetect&&G.push("H.265"),webApp.GongAnDetect&&s.$("#video_smart264_enable").parent().parent().show(),webApp.CHANNEL_NUMBER>1&&(s.$("#enc_encode_channel").parent().removeClass("fn-hide"),s.$("#enc_encode_channel").parent().next("div").removeClass("fn-hide"),H=a("#enc_encode_channel").iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){x=b.ch,s._putvalueWater(j,x),s._putJsonEncode(i)}}),H.iconSelect("index",x)),s.bind(),A=b.MaxSVCTLevel||0,B=b.SvcEncodeTypes||["H.264"],C=isEnable("special_GOP_728WP"),ability.get("EncodePriority").done(function(a){if(a&&a.definition){var b=a.definition||[];b.length>0&&(s.$("#video_PriorityWrap0").removeClass("fn-hide"),s.$("#video_PriorityWrap1").removeClass("fn-hide"))}}),A>0){for(var c="",d=1;A>=d;d++)c+='<option value="'+d+'">'+d+(1==d?"(off)":"")+"</option>";s.$("#video_svc0").append(c),s.$("#video_svc1").append(c),s.$("#video_mainSvc").removeClass("fn-hide"),s.$("#video_extrSvc").removeClass("fn-hide")}if(webCaps.is_show_mainStreamType){var e=s.$("#video_streamType0");e.parent().removeClass("fn-hide");var f='<option value="1" t="w_Motion"></option>';(webApp.ALARM_IN_NUMBER>0||webApp.IsLocalStore)&&(f+='<option value="2" t="w_Alarm"></option>'),e.append(f).translation()}var g=s.$("#video_extraAudioList");-1!==webApp.DeviceType.indexOf("TPC")&&s.$("#video_streamType1").parent().removeClass("fn-hide"),ability.is("ExtraConflict").done(function(a){if(webApp.MaxExtraStream<1)s.$("#video_subStream_con").addClass("fn-hide");else if(webApp.MaxExtraStream<2)g.addClass("fn-hide");else{for(var b="",c=a?1:webApp.MaxExtraStream,d=0;c>d;d++)b+="<option value="+d+' t="w_SecondStream'+(d+1)+'"></option>';g.append(b).translation(),webApp.GongAnDetect&&(g.append('<option value="2" t="w_SecondStream3">Second Stream3</option>'),g.append('<option value="3" t="w_SecondStream4">Second Stream4</option>'))}s.render()}),ability.get("RotateResolutionLimit").done(function(a){a&&s.$("#video_resolution0").data("limitR",a)})},bind:function(){s.$("#video_custom0").numberfield({allowNegative:!1,allowDecimal:!1}),s.$("#video_custom1").numberfield({allowNegative:!1,allowDecimal:!1}),s.$("#video_gop0").numberfield({max:150,allowNegative:!1,allowDecimal:!1}).blur(function(){s._refreshEncodeCap(0)}),s.$("#video_gop1").numberfield({max:150,allowNegative:!1,allowDecimal:!1}).blur(function(){s._refreshEncodeCap(1)}),s.$("#video_waterString").textfield({charset:"utf-8",length:127}),s.$("#svcPsd0").textfield({validReg:/^[\x00-\x7f]+$/,errorHandle:"prevent"}).keyup(function(a){""===s.$(a.target).val()&&s.tip("warning","w_passwordMustnotNull")}),s.$("#radio_vid").change(function(){F&&F[M].Support&&(p[x][M].Enable=s.$("#radio_vid")[0].checked)}),s.$("[name=video_cut_enable]").click(function(a){var b=a.target;s.disabled(s.$("#video_resolution1"),"VideoCut"===b.value),s.disabled(s.$("#video_setAreaZone"),"Resolution"===b.value),"VideoCut"===b.value?(p[x][M].Enable=!0,s.$("#video_resolution1")[0].value=P):p[x][M].Enable=!1}),r=s.$("#v_c_dialog").dialog({confirm:function(a,b){J=K,P=r.find("#videoCut_resolution")[0].value,p[x][M].Config[s.$("#video_resolution0 option:selected").attr("realvalue")].Resolution=P,p[x][M].Config[s.$("#video_resolution0 option:selected").attr("realvalue")].Region=J,s.$("#radio_vid").click(),I=!1,plugin.SetGridNum(0,0),plugin.RegionClip(0,0,0,0,0,0),plugin.close(),plugin.hide(),b.ui.close(),plugin.addEvent("StateChangedCutZone",null)},close:function(){I=!1,plugin.SetGridNum(0,0),plugin.RegionClip(0,0,0,0,0,0),plugin.close(),plugin.hide(),s.$("#radio_vid").click(),s._refreshEncodeCap(1,!0),plugin.addEvent("StateChangedCutZone",null)}}),r.dialog("setPosition",[310,615]),r.find("#videoCut_resolution").on("change",function(a){s._initCutZone(a.target.value,!0)})},setAreaZone:function(){return plugin.addEvent("StateChangedCutZone",function(){s._initCutZone(r.find("#videoCut_resolution")[0].value,!1)}),s.$("#video_resolution0")[0].value!==O?(s.tip("warning","w_mainResolusionChanged"),!1):(r.dialog("show"),plugin.SetModuleMode(1),r.find("#videoCut_resolution")[0].value=P,plugin.cover("#v_c_cutzone",function(){plugin.open()}),void(I=!0))},onRefreshCutZone:function(a){s.$("#video_resolution1")[0].selectedIndex=a.target.selectedIndex},leave:function(){plugin.hide(),plugin.addEvent("RegionChanged",null),a(window).off("resize.encode")},_initCutZone:function(a,b){var c=0,d=0,e=[];switch(K=J,a){case"720P":c=getWidthH("720P").split("*")[0]-0,d=getWidthH("720P").split("*")[1]-0;break;case"D1":c=getWidthH("D1").split("*")[0]-0,d=getWidthH("D1").split("*")[1]-0;break;case"CIF":c=getWidthH("CIF").split("*")[0]-0,d=getWidthH("CIF").split("*")[1]-0}K=f(K),e=b?[0,0,0,0]:K,L.Rotate90?plugin.RegionClip(d,c,e[0],e[1],e[2],e[3]):plugin.RegionClip(c,d,e[0],e[1],e[2],e[3])},onSelectMode:function(b){var c=a(b.target),d=c.attr("id").slice(-1),e="#video_bitctrl"+d;"on"===c.val()?(s.$(e).val("VBR").change(),s.$("#video_showGop0").addClass("fn-hide")):(s.$(e).val("CBR").change(),s.$("#video_showGop0").removeClass("fn-hide")),t[0].Enable="on"===c.val(),A&&s.renderSvc(i[x].MainFormat[v].Video.Compression,0)},render:function(){v=0,w=0,webCaps.is_show_mainStreamType&&s.$("#video_streamType0").val(v),plugin.addEvent("RegionChanged",function(a,b,c,d,f){K=e([b,c,d,f])}),s.$("#video_extraAudioList").val(w),h.ConfigManager.getConfig(["Encode","VideoWaterMark","MediaGlobal","EncodeEncrypt","EncodeAuth","VideoImageControl","EncodeCrop"]).done(function(b){if(i=b[0].params.table,l=a.extend(!0,{},i),j=b[1].params.table,k=b[2].params.table,n=b[3].result&&b[3].params.table,o=b[4].result&&b[4].params.table,O=getFrame(i[x].MainFormat[0].Video.Width,i[x].MainFormat[0].Video.Height),N=O,b[5].result){var c=b[5].params.table[x].Rotate90;L=b[5].params.table[x],s.$("#video_resolution0").data("rotate",c)}b[6].result&&(p=b[6].params.table),s._getCapsConfig(),h.Encode.getConfigCaps(0,i).done(function(a){m=a,h.Encode.getCropCaps(x).done(function(a){F=a}),h.Encode.getSmartCaps(D,x).done(function(a){E=a,h.ConfigManager.getConfig("SmartEncode").done(function(a){t=a,u=t,s._initPage(),s._putvalue()})}).fail(function(){s._initPage(),s._putvalue()})})}),h.ConfigManager.getConfig("smartH164Config").done(function(b){b&&b.result&&a("video_smart264_enable").prop("checked",b.Enable)}),a(window).on("resize.encode",function(){plugin.cover("#v_c_cutzone")})},_getCapsConfig:function(){var b=[i[x].MainFormat[0].Video,i[x].ExtraFormat[0].Video,i[x].ExtraFormat[1].Video];a.each(b,function(a,b){D[a].Compression=b.Compression})},_initPage:function(a,b){var c=m[x].MainFormat[v];if(E&&1===E[0]&&!a&&(q=t[0].Enable?"on":"off"),s._putEncodeCap(c,0,w),webApp.MaxExtraStream>0){var d=m[x].ExtraFormat[w];b?s._putEncodeCap(d,1,w,b):s._putEncodeCap(d,1,w)}},_putvalue:function(a,b){s._putvalueMain(i,x,v,a,b),s._putvalueExtr(i,x,w,a,b),s._putvalueWater(j,x)},_putEncodeCap:function(b,c,d,e){var f=i[x].MainFormat[v].Video.Compression;E&&1===E[0]?"MJPG"===f?(s.$("#video_sencode0").parent().hide(),t[0].Enable=!1,s.$("#video_sencode0").val("off")):s.$("#video_sencode0").parent().show():s.$("#video_sencode0").parent().hide();var g=s.$("#video_compression"+c);g.empty();var h="";a.each(b.Video.CompressionTypes,function(c,d){isEnable("is_k6_DeviceType")&&"MJPG"==d||("H.264"==d?b.Video.H264Profile?a.each(b.Video.H264Profile,function(a,b){h+="<option value="+z[b]+" t=w_"+b+"></option>"}):(h+="<option value="+d+" t=w_"+d+"></option>",h+='<option value="H.264B" t="H.264B"></option>',h+='<option value="H.264H" t="H.264H"></option>'):"H.265"==d?(h+="<option value="+d+" t="+d+"></option>",webApp.GongAnDetect&&(h+='<option value="H.265B" t="H.265B"></option>',h+='<option value="H.265H" t="H.265H"></option>')):h+="<option value="+d+" t="+d+"></option>")}),g.append(h).translation(),s._insertResolution(b.Video.ResolutionTypes,s.$("#video_resolution"+c)),1!==c||I||s._insertResolution(b.Video.ResolutionTypes,r.find("#videoCut_resolution"));var j=s.$("#video_fps"+c);j.empty(),0===b.Video.FPSMax&&j.append('<option value="0">0</option>');for(var k=0;k<b.Video.FPSMax;k++)j.append("<option value="+(k+1)+">"+(k+1)+"</option>");var l=b.Video.BitRateOptions;if(s.renderBitRate(s.$("#video_bitrate"+c),s.getBitRateList(l)),a("#video_bitrefer"+c).text(l[0]+"-"+l[1]+"Kb/S"),a("#video_custom"+c).numberfield("min",l[0]),a("#video_custom"+c).numberfield("max",l[1]),1===c&&F&&F.Extra2&&F.Extra2.Support)if("1.3M"===N?(J=p[x].Extra2.Config["1_3M"].Region,P=p[x].Extra2.Config["1_3M"].Resolution):(J=p[x].Extra2.Config[N].Region,P=p[x].Extra2.Config[N].Resolution),1===d)if(s.$("#video_videoCutWrap").removeClass("fn-hide"),s.$("#radio_res").removeClass("fn-hide"),p[x].Extra2.Enable){if(e)return!1;s.$("#radio_vid").click()}else s.$("#radio_res").click();else s.$("#video_videoCutWrap").addClass("fn-hide"),s.$("#radio_res").addClass("fn-hide"),s.disabled(s.$("#video_resolution1"),!1);else 1===c&&(s.$("#video_videoCutWrap").addClass("fn-hide"),s.$("#radio_res").addClass("fn-hide"),s.disabled(s.$("#video_resolution1"),!1))},_insertResolution:function(b,c){c.empty(),a.each(b,function(a,b){var d=b;"720"==b&&(d="720P"),"1080"==b&&(d="1080P"),"1_3M"==b&&(d="1.3M"),"2_5M"==b&&(d="2.5M"),c.append("5_1M"==d?"<option value="+d+" realvalue="+b+">5M ("+getWidthH(d)+")</option>":"<option value="+d+" realvalue="+b+">"+d+" ("+getWidthH(d)+")</option>")})},_putvalueMain:function(b,c,d,e,f){var g=b[c].MainFormat[d],h=g.Video,i=getFrame(h.Width,h.Height);s.$("#video_resolution0")[0].value=i,s.disabled(s.$("#video_resolution0"),!!d),s.disabled(s.$("#video_compression0"),!!d),s.$("#video_quality0").val(h.Quality),s.$("#video_gop0").val(h.GOP),A>0&&s.$("#video_svc0").val(h.SVCTLayer);var j=s.$("#video_compression0");a.inArray(h.Compression,G)>-1?("Baseline"==h.Profile&&j.val(h.Compression+"B"),"High"==h.Profile&&j.val(h.Compression+"H"),"Main"==h.Profile&&j.val(h.Compression)):j.val(h.Compression),A&&s.renderSvc(h.Compression,0),n&&o&&s.renderSVAC(h.Compression,0,h.SVCTLayer),j[0].selectedIndex<=0&&(j[0].selectedIndex=0),s.$("#video_resolution0")[0].selectedIndex<=0&&(s.$("#video_resolution0")[0].selectedIndex=0);var k=s.$("#video_bitctrl0");if("MJPG"==j.val()||"MPEG4"==j.val())k.val("CBR").change(),s.disabled(k,!0),s.$("#video_showQuality0").addClass("fn-hide"),"MJPG"==j.val()&&s.$("#video_showGop0").addClass("fn-hide"),"MPEG4"==j.val()&&s.$("#video_showGop0").removeClass("fn-hide");else if(s.disabled(k,!1),k.val(h.BitRateControl).change(),s.$("#video_showQuality0").toggleClass("fn-hide","CBR"==h.BitRateControl),E&&1===E[0]){var l=t[0].Enable?"on":"off";if(s.$("#video_sencode0").val(l),j.children().is('option[value="MJPG"]')){var p=j.find('option[value="MJPG"]');"on"===q&&p.remove()}s.$("#video_showGop0").toggleClass("fn-hide","on"===l)}else s.$("#video_showGop0").removeClass("fn-hide");s.$("#video_fps0")[0].value=h.FPS;var r=s.$("#video_fps0 option").length;if(h.FPS>r&&(s.$("#video_fps0 option:last").prop("selected",!0),s.$("#video_gop0").val(C?2*r:12)),C){var u=s.$("#video_fps0").val()-0;s.$("#video_gop0_range").text("("+u+"~150)"),s.$("#video_gop0").numberfield("min",u)}else s.$("#video_gop0_range").text("(12~150)"),s.$("#video_gop0").numberfield("min",12);s.$("#video_gop0").attr("maxVal",150);var v=0===e,w=h.BitRate,x=m[c].MainFormat[d].Video.BitRateSuggested;f&&0===e&&x&&0!==x&&(w=x);var y=s.getSuggestBitRate(m[c].MainFormat[d].Video.BitRateOptions,w,v);s.putBitRateValue(0,y),s.$("#video_Priority0").val(b[c].MainFormat[d].Video.Priority||0)},_putvalueExtr:function(b,c,d,e,f){if(!(webApp.MaxExtraStream<1)){var g=b[c].ExtraFormat[d],h=g.Video;s.$("#video_subStream_enable").prop("checked",g.VideoEnable);var i=getFrame(h.Width,h.Height);1===w&&s.$("#radio_vid")[0].checked&&F&&F[M]&&F[M].Support||(s.$("#video_resolution1")[0].value=i),s.$("#video_quality1").val(h.Quality),s.$("#video_gop1").val(h.GOP),A>0&&s.$("#video_svc1").val(h.SVCTLayer);var j=s.$("#video_compression1");a.inArray(h.Compression,G)>-1?("Baseline"==h.Profile&&j.val(h.Compression+"B"),"High"==h.Profile&&j.val(h.Compression+"H"),"Main"==h.Profile&&j.val(h.Compression)):j.val(h.Compression),A&&s.renderSvc(h.Compression,1),j[0].selectedIndex<0&&(j[0].selectedIndex=0),s.$("#video_resolution1")[0].selectedIndex<0&&(s.$("#video_resolution1")[0].selectedIndex=0,s.$("#video_resolution1").trigger("change"));var k=s.$("#video_bitctrl1");"MJPG"==j.val()||"MPEG4"==j.val()?(k.val("CBR").change(),s.disabled(k,!0),s.$("#video_showQuality1").addClass("fn-hide"),"MJPG"==j.val()&&s.$("#video_showGop1").css("display","none"),"MPEG4"==j.val()&&s.$("#video_showGop1").css("display","block")):(s.$("#video_showGop1").css("display","block"),s.disabled(k,!1),k.val(h.BitRateControl).change(),s.$("#video_showQuality1").toggleClass("fn-hide","CBR"==h.BitRateControl)),s.$("#video_fps1")[0].value=h.FPS;var l=s.$("#video_fps1 option:first").val(),n=s.$("#video_fps1 option:last").val();if(h.FPS<l){s.$("#video_fps1").val(l);var o=C?2*(l-0):12;s.$("#video_gop1").val(o)}else if(h.FPS>n){s.$("#video_fps1").val(n);var o=C?2*(n-0):12;s.$("#video_gop1").val(o)}if(C){var p=s.$("#video_fps1").val()-0;s.$("#video_gop1_range").text("("+p+"~150)"),s.$("#video_gop1").numberfield("min",p)}else s.$("#video_gop1_range").text("(12~150)"),s.$("#video_gop1").numberfield("min",12);s.$("#video_fps1").attr("maxVal",150);var q=1===e,r=h.BitRate,t=m[c].ExtraFormat[d].Video.BitRateSuggested;f&&1===e&&t&&0!==t&&(r=t);var u=s.getSuggestBitRate(m[c].ExtraFormat[d].Video.BitRateOptions,r,q);s.putBitRateValue(1,u),s.$("#video_Priority1").val(b[c].ExtraFormat[d].Video.Priority||0)}},_putvalueWater:function(a,b){var c=a[b],d=s.$("#video_water_enable");d.prop("checked",c.Enable),s.$("#video_water_show").toggleClass("fn-hide",!c.Enable),s.$("#video_waterString").val(c.String)},renderSvc:function(b,c){0===c?t&&t[0].Enable?s.$("#video_mainSvc").addClass("fn-hide"):a.inArray(b,B)<0?s.$("#video_mainSvc").addClass("fn-hide"):s.$("#video_mainSvc").removeClass("fn-hide"):s.$("#video_extrSvc").toggleClass("fn-hide",a.inArray(b,B)<0);var d=["H.264"];switch(c){case 0:webApp.GongAnDetect&&a.inArray(b,d)>-1?s.$("#video_PriorityWrap0").show():s.$("#video_PriorityWrap0").hide();break;case 1:webApp.GongAnDetect&&a.inArray(b,d)>-1?s.$("#video_PriorityWrap1").show():s.$("#video_PriorityWrap1").hide()}},renderSVAC:function(a,b,c){if("SVAC"===a){s.$("#video_mainSvac"+b).show();var d=n[x][b],e=o[x];s.$("#video_svac_svc"+b).val(2===c?c:1),s.$("#video_svcPwd_enable"+b).prop("checked",d.EncryptEnable),s.$("#svcPsd"+b).val(d.Key),s.$("#video_encodeAuth_enable"+b).prop("checked",e.Enable),s.disabled(s.$("#svcPsd"+b),!d.EncryptEnable)}else s.$("#video_mainSvac"+b).hide()},renderBitRate:function(b,c){var d="";a.each(c,function(a,b){d+='<option value="'+b+'">'+b+"</option>"}),d+='<option value="customize" t="w_Customize">Customized</option>',b="element"==$type(b)?b:a(b),b.html(d).translation(),b.data("BitRateList",c.join(","))},getSuggestBitRate:function(a,b,c){var d=s.getBitRateList(a),e=((a[0]+a[1])/2).toInt();if(b>=a[0]&&b<=a[1])return b;for(var f=0;f<d.length;f++)if(d[f]>=e)return d[f];return c?e:d[f-1]},putBitRateValue:function(b,c){var d=s.$("#video_bitrate"+b),e=s.$("#video_customwrap"+b),f=s.$("#video_custom"+b);d.val(c);var g=d.data("BitRateList").split(",");a.inArray(c.toString(),g)>-1?e.addClass("fn-hide"):(d.val("customize"),e.removeClass("fn-hide"),f.val(c))},getBitRateList:function(b){var c=a.grep(y,function(a){return a>=b[0]&&a<=b[1]});return c.sort(function(a,b){return a-b})},_saveEncode:function(b){var c=i[b].MainFormat[v];if(c.Video.Priority=s.$("#video_Priority0").val()-0,s._saveEncodeByType(c,0),webApp.MaxExtraStream>0){var d=i[b].ExtraFormat,e=d[w];e.Video.Priority=s.$("#video_Priority1").val()-0,s._saveEncodeByType(e,1),s.$("#video_subStream_enable").prop("checked")?e.VideoEnable=!0:(e.VideoEnable=!1,e.AudioEnable=!1)}var f=c.Video.Width,g=c.Video.Height;"ExtraFormat"==k.SnapFormatAs?(f=d[0].Video.Width,g=d[0].Video.Height):"Extra2Format"==k.SnapFormatAs?(f=d[1].Video.Width,g=d[1].Video.Height):"Extra3Format"==k.SnapFormatAs&&(f=d[2].Video.Width,g=d[2].Video.Height);var h=i[b].SnapFormat;a.each(h,function(a,b){b.Video.Width=f,b.Video.Height=g})},_saveEncodeByType:function(a,b){var c=s.$("#video_compression"+b).val(),d=null;"H.264"==c?d="Main":"H.264B"==c?(d="Baseline",c="H.264"):"H.264H"==c&&(d="High",c="H.264"),"H.265"==c?d="Main":"H.265B"==c?(d="Baseline",c="H.265"):"H.265H"==c&&(d="High",c="H.265"),a.Video.Compression=c,null!==d&&(a.Video.Profile=d);var e=getWidthH(s.$("#video_resolution"+b).val()).split("*");a.Video.Width=e[0]-0,a.Video.Height=e[1]-0,A>0&&(a.Video.SVCTLayer=s.$("#video_svc"+b).val()-0),a.Video.FPS=s.$("#video_fps"+b).val()-0,a.Video.BitRateControl=s.$("#video_bitctrl"+b).val(),a.Video.Quality=s.$("#video_quality"+b).val()-0,a.Video.BitRate="customize"==s.$("#video_bitrate"+b).val()?s.$("#video_custom"+b).val()-0:s.$("#video_bitrate"+b).val()-0,a.Video.GOP=s.$("#video_gop"+b).val()-0},saveSVAC:function(){n[x][0].EncryptEnable=s.$("#video_svcPwd_enable0").prop("checked"),n[x][0].Key=s.$("#svcPsd0").val(),o[x].Enable=s.$("#video_encodeAuth_enable0").prop("checked"),i[x].MainFormat[0].Video.SVCTLayer=s.$("#video_svac_svc0").val()-0},onSave:function(){var b=function(b){var c=s.$("#video_resolution0").data("rotate");if(c){var d=s.$("#video_resolution0 option:selected").attr("realvalue");if(a.inArray(d,s.$("#video_resolution0").data("limitR"))<0){var e="";return"SimpChinese"!=Site.currentLanguage&&(e=1==c?"w_clockwise90Ex":"w_clockwise90Ex2"),s.tip("error",tl("noResolution")+tl(e)),!1}}var f=s.$("#video_water_enable").prop("checked");j[x].Enable=f,f&&(j[x].String=s.$("#video_waterString").val()),s._saveEncode(x),s._checkBitRate();var g=["Encode","VideoWaterMark"],k=[i,j];return E&&1===E[0]&&(g.push("SmartEncode"),k.push(t)),"SVAC"===s.$("#video_compression0").val()&&(s.saveSVAC(),g.push("EncodeEncrypt","EncodeAuth"),k.push(n,o),""===s.$("#svcPsd0").val())?void s.tip("warning","w_passwordMustnotNull"):(0!==v||webCaps.is_show_mainStreamType||(i[x].MainFormat[1].Video=i[x].MainFormat[2].Video=i[x].MainFormat[0].Video),F&&F.Extra2.Support&&p[x].Extra2.Enable&&(k[0][x].ExtraFormat[1].Video.Width=getWidthH(P).split("*")[0]-0,k[0][x].ExtraFormat[1].Video.Height=getWidthH(P).split("*")[1]-0),void h.ConfigManager.setConfig(g,k).done(function(c){var d=0;if(a.each(c,function(b,c){c&&!c.result&&(d=2,a.each(c.params.options,function(a,b){return"CapsNotSupport"==b?(d=1,!1):void 0}))}),d)1===d?s.tip("error","Rorateresolutiong Saving failure"):2===d&&s.tip("error","Saving failure");else if(F&&F.Extra2.Support)O=N,p[x].Extra2.Config[s.$("#video_resolution0 option:selected").attr("realvalue")].Region=J,p[x].Extra2.Config[s.$("#video_resolution0 option:selected").attr("realvalue")].Resolution=P,h.ConfigManager.setConfig("EncodeCrop",p).done(function(){var d=i[x].MainFormat[0].Video;"SVAC"==d.Compression&&(n.EncryptEnable&&plugin.SetDecodeKey(n.Key),!(d.SVCTLayer-1)&&plugin.ChooseFrame(0)),webApp.isNeedReboot(c)&&webApp.reboot("w_Rebooting..."),h.ConfigManager.getConfig("Encode").done(function(c){i=c,l=a.extend(!0,{},i),s._putJsonEncode(i),b&&h.MagicBox.reboot()}),O=s.$("#video_resolution0")[0].value,N=O,s.tip("success","Succeed in saving configure")}).fail(function(){s.tip("error","Saving failure")});else{var e=i[x].MainFormat[0].Video;"SVAC"==e.Compression&&(n.EncryptEnable&&plugin.SetDecodeKey(n.Key),!(e.SVCTLayer-1)&&plugin.ChooseFrame(0)),webApp.isNeedReboot(c)&&webApp.reboot("w_Rebooting..."),h.ConfigManager.getConfig("Encode").done(function(c){i=c,l=a.extend(!0,{},i),s._putJsonEncode(i),b&&h.MagicBox.reboot()}),O=s.$("#video_resolution0")[0].value,N=O,s.tip("success","Succeed in saving configure")}}).fail(function(){s.tip("error","Saving failure")}))};E&&1===E[0]&&void 0!==q&&s.$("#video_sencode0").val()!==q?a.confirm(tl("SmartEncode"),tl("w_rebootconfirm"),function(){b(!0)}):b(!1);var c=s.$("#video_smart264_enable").prop("checked"),d={Enable:c};h.ConfigManager.setConfig("smartH164Config",d).done(function(){})},onRefresh:function(){h.ConfigManager.getConfig(["Encode","VideoWaterMark","EncodeEncrypt","EncodeAuth","EncodeCrop"]).done(function(a){i=a[0].params.table,j=a[1].params.table,n=a[2].result&&a[2].params.table,o=a[3].result&&a[3].params.table,p=a[4].result&&a[4].params.table,s._putvalueWater(j,x),s._putJsonEncode(i),O=getFrame(i[x].MainFormat[0].Video.Width,i[x].MainFormat[0].Video.Height),N=O,p&&(P=p[x][M].Config[N].Resolution,J=p[x][M].Config[N].Region),s.tip("success","Operateingsuccess")}).fail(function(){s.tip("error","Operateingfailure")}),h.ConfigManager.getConfig("smartH164Config").done(function(a){s.$("#video_smart264_enable").prop("checked",a.Enable)})},onDefault:function(){h.ConfigManager.getDefault(["Encode","VideoWaterMark","EncodeEncrypt","EncodeAuth","EncodeCrop"]).done(function(b){var c=b[0].params.table;j=b[1].params.table,n=b[2].result&&b[2].params.table,o=b[3].result&&b[3].params.table,p=b[4].result&&b[4].params.table,b[4].result&&s.$("#radio_res").click();var d=i[x].MainFormat,e=i[x].ExtraFormat;a.each(c[x].MainFormat,function(b,c){d[b]&&(d[b].Video=a.extend(!0,{},c.Video))}),a.each(c[x].ExtraFormat,function(b,c){e[b]&&(e[b].Video=a.extend(!0,{},c.Video),e[b].VideoEnable=c.VideoEnable)}),s._putvalueWater(j,x),s._getCapsConfig(),h.Encode.getConfigCaps(0,i).done(function(a){m=a,h.Encode.getSmartCaps(D,x).done(function(a){E=a,h.ConfigManager.getDefault("SmartEncode").done(function(a){t=a,s._initPage(!0),s._putvalue()})}).fail(function(){s._initPage(),s._putvalue()})}),O=getFrame(i[x].MainFormat[0].Video.Width,i[x].MainFormat[0].Video.Height),N=O,p&&(P=p[x][M].Config[N].Resolution,J=p[x][M].Config[N].Region),s.tip("success","Defaultsuccess")}).fail(function(){s.tip("error","Defaultfailure")}),h.ConfigManager.getDefault("smartH164Config").done(function(a){s.$("#video_smart264_enable").prop("checked",a.Enable)})},_checkBitRate:function(){var b=i[x].ExtraFormat;a.each(m[x].ExtraFormat,function(a,c){b[a].Video.BitRate=s.getSuggestBitRate(c.Video.BitRateOptions,b[a].Video.BitRate)})},_putJsonEncode:function(a){s._getCapsConfig(),h.Encode.getConfigCaps(0,a).done(function(a){m=a,h.Encode.getSmartCaps(D,x).done(function(a){E=a,h.ConfigManager.getConfig("SmartEncode").done(function(a){t=a,s._initPage(),s._putvalue()})}).fail(function(){s._initPage(),s._putvalue()})})},onRefreshEncodeCap:function(b){var c=b.target.id,d=c.substr(0,c.length-1),e=c.substr(c.length-1,1)-0;switch(N=s.$("#video_resolution0")[0].value,0===e&&F&&F.Extra2.Support?(P=p[x].Extra2.Config[s.$("#video_resolution0 option:selected").attr("realvalue")].Resolution,refreshEncode=!1):refreshEncode=!0,d){case"video_compression":s._refreshEncodeCap(e,!0);break;case"video_resolution":refreshEncode?s._refreshEncodeCap(e,!0,!0):s._refreshEncodeCap(e);break;case"video_fps":var f=C?2*(a("#"+c).val()-0):12;a("#video_gop"+e).val(f),s._refreshEncodeCap(e)}},onSelectBitRate:function(b){var c=b.target.id,d=c.substr(c.length-1,1)-0,e=s.$("#video_customwrap"+d),f=s.$("#video_custom"+d);if("customize"==s.$("#"+c).val()){e.removeClass("fn-hide");var g=a("#video_bitrefer"+d).text().split("-"),h=f.val()-0;(h<g[0]||h>g[1])&&f.val((g[0]+g[1])/2)}else e.addClass("fn-hide")},onSelectBitctrl:function(a){var b=a.target.id,c=b.substr(b.length-1,1)-0,d=a.target.value,e="VBR"===d?"streamLimit":"w_Code Stream";s.$("#video_showQuality"+c).toggleClass("fn-hide","CBR"==d),0===c&&s.$("#video_bitrate0").parent().prev("label").attr("t",e).parent().translation(),1===c&&s.$("#video_bitrate1").parent().prev("label").attr("t",e).parent().translation()},_refreshEncodeCap:function(b,c,d){s._saveEncode(x,!0);var e=a.map(i,function(b){return a.extend(!0,{},b)});webCaps.is_show_mainStreamType||(e[x].MainFormat[1].Video=e[x].MainFormat[2].Video=e[x].MainFormat[0].Video);var f=s.$("#video_compression"+b).val(),g=0;"H.264"===f.slice(0,5)?f="H.264":"H.265"===f.slice(0,5)&&(f="H.265"),0===b?g=0:0!==b&&"0"===s.$("#video_extraAudioList").val()||0!==b?g=1:0!==b&&"1"===s.$("#video_extraAudioList").val()&&(g=2),webApp.GongAnDetect&&("2"===s.$("#video_extraAudioList").val()&&(g=1),"3"===s.$("#video_extraAudioList").val()&&(g=2)),D[g].Compression=f,h.Encode.getConfigCaps(0,e).done(function(e){null!=a("ENCODECFG")&&(m=e,h.Encode.getSmartCaps(D,x).done(function(a){E=a}).always(function(){d?s._initPage(!0,d):s._initPage(!0),s._putvalue(b,c)}))})},onSelectExtr:function(a){"0"===a.target.value?M="Extra1":"1"===a.target.value&&(M="Extra2"),s._saveEncode(x),w=a.target.value-0,2===w&&webApp.GongAnDetect&&(w=0),3===w&&webApp.GongAnDetect&&(w=1);var b=m[x].ExtraFormat[w];s._putEncodeCap(b,1,w),s._putvalueExtr(i,x,w),s.$("#radio_vid")[0].checked&&F&&F[M]&&F[M].Support&&s.$("#radio_vid").click()},onClickWater:function(b){var c=a(b.target).prop("checked");s.$("#video_water_show").toggleClass("fn-hide",!c)},onSelectMain:function(a){s._saveEncode(x),v=a.target.value-0;var b=m[x].MainFormat[v];s._putEncodeCap(b,0,w),s._putvalueMain(i,x,v)},onClickPassword:function(a){var b=s.$(a.target).prop("checked");s.disabled(s.$("#svcPsd0"),!b)}})}),define("enc_snap",function(require,b,c){var d,e,f=require("jsCore/pageBase"),g=require("jsCore/rpc"),h=require("jsCore/ability"),i=require("common/common"),j=null,k=0,l=!1,m=null,n=0,o=null;c.exports=f.extend({init:function(){j=this,j.$("#snapSpeed_customized").numberfield({max:5e4,min:1,allowNegative:!1,allowDecimal:!1}),webApp.CHANNEL_NUMBER>1?(j.$("#enc_snap_channel").parent().removeClass("fn-hide"),j.$("#enc_snap_channel").parent().next("div").removeClass("fn-hide"),o=a("#enc_snap_channel").iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){n=b.ch,0!==n?j.$("#snap_heatBox").removeClass("fn-hide"):j.$("#snap_heatBox").addClass("fn-hide"),j._putvalueSnap(d,n,k)}}),o.iconSelect("index",n)):-1!==webApp.DeviceType.indexOf("TPC")&&g.ThermographyManager.getCaps(n,"All").done(function(a){var b=a.CamType;2!==b&&j.$("#snap_heatBox").removeClass("fn-hide")}),h.get("SnapshotInterval").done(function(a){a&&(j.$("#snapSpeed_customized").numberfield("max",a),j.$("#snapinterval").text("(1-"+a+")"))}),j.$('input[name= "snap_selSnapFormatsAs"]').click(j._selSnapFormatsAs),j.render()},render:function(){var a=["Encode","MediaGlobal"];k=0,-1!==webApp.DeviceType.indexOf("TPC")&&a.push("RadioDataInJpeg"),g.ConfigManager.getConfig(a).done(function(a){d=a[0].params.table,e=a[1].params.table,e.SnapFormatAs&&isEnable("is_has_SnapFormatAs")?(l=!0,j.$("#snap_showSnapFormatAs").removeClass("fn-hide")):j.$("#snap_showSnapFormatAs").addClass("fn-hide"),-1!==webApp.DeviceType.indexOf("TPC")&&(m=a[2].params.table),j._putvalueSnap(d,n,k)})},_putvalueSnap:function(a,b,c,d){j.$("#snap_snaptype").val(c);var f=j.$("#snap_resolution"),g=a[b].SnapFormat[c];if(!d){var h=getFrame(g.Video.Width,g.Video.Height),i=h;"5_1M"===h&&(i="5M"),f.val(i+" ("+getWidthH(h)+")")}j.disabled(f),l&&j.$("input[value="+e.SnapFormatAs+"]").prop("checked",!0);var k=a[0].ExtraFormat[0].VideoEnable;j.disabled(j.$("#snapSub_enable"),!k),j.$("#snap_imgQuality").val(g.Video.Quality);var n=(1/g.Video.FPS).round();n>7?(j.$("#snap_snapSpeed").val("Customized"),j.$("#snapSpeed_customized_wrap").removeClass("fn-hide")):(j.$("#snap_snapSpeed").val("-"+n),j.$("#snapSpeed_customized_wrap").addClass("fn-hide")),j.$("#snapSpeed_customized").val(n),j.$("#snap_heatBox").hasClass("fn-hide")||j.$("#snap_heatMap").prop("checked",m[b].Enable)},_saveSnap:function(){var b=d[n],c=b.MainFormat[0].Video,f=b.SnapFormat;l&&(j.$("#snapSub_enable").prop("checked")?(c=b.ExtraFormat[0].Video,e.SnapFormatAs="ExtraFormat"):j.$("#snapMain_enable").prop("checked")&&(e.SnapFormatAs="MainFormat"));var g=c.Width,h=c.Height;a.each(f,function(a,b){b.Video.Width=g,b.Video.Height=h}),f[k].Video.Quality=j.$("#snap_imgQuality").val()-0,f[k].Video.FPS=j._getSnapSpeed()},_getSnapSpeed:function(){var a=j.$("#snap_snapSpeed"),b=1;if("Customized"==a.val()){var c=j.$("#snapSpeed_customized");b=1/(c.val()-0)}else{var d=a.val()-0;b=0>d?-1/d:d}return b},onDefault:function(){var b=["Encode","MediaGlobal"];-1===webApp.DeviceType.indexOf("TPC")||j.$("#snap_heatBox").hasClass("fn-hide")||b.push("RadioDataInJpeg"),g.ConfigManager.getDefault(b).done(function(b){var c=b[0].params.table,f=b[1].params.table;d[n].SnapFormat=a.map(c[n].SnapFormat,function(b){return a.extend(!0,{},b)}),e.SnapFormatAs=f.SnapFormatAs,-1===webApp.DeviceType.indexOf("TPC")||j.$("#snap_heatBox").hasClass("fn-hide")||(m[n]=b[2].params.table[n]),j._putvalueSnap(d,n,k,!0),j.tip("success","Defaultsuccess")}).fail(function(){j.tip("error","Defaultfailure")})},onRefresh:function(){var a=["Encode","MediaGlobal"];-1!==webApp.DeviceType.indexOf("TPC")&&a.push("RadioDataInJpeg"),g.ConfigManager.getConfig(a).done(function(a){d=a[0].params.table,e=a[1].params.table,-1!==webApp.DeviceType.indexOf("TPC")&&(m=a[2].params.table),j._putvalueSnap(d,n,k),j.tip("success","Operateingsuccess")}).fail(function(){j.tip("error","Operateingfailure")})},onSave:function(){var a=["Encode","MediaGlobal"],b=[d,e];-1!==webApp.DeviceType.indexOf("TPC")&&(m[n].Enable=j.$("#snap_heatMap").prop("checked"),a.push("RadioDataInJpeg"),b.push(m)),j._saveSnap(),g.ConfigManager.setConfig(a,b).done(function(a){i.chkMutilCallRet(a)?j.tip("success","Succeed in saving configure"):j.tip("error","Saving failure")})},onChangeSnap:function(a){j._saveSnap(),k=a.target.value-0,j._putvalueSnap(d,n,k)},onChangeSpeed:function(a){var b=a.target.value;"Customized"==b?j.$("#snapSpeed_customized_wrap").removeClass("fn-hide"):j.$("#snapSpeed_customized_wrap").addClass("fn-hide")},_selSnapFormatsAs:function(b){var c=a(b.target).val(),e=d[n].MainFormat[0].Video;"ExtraFormat"==c&&(e=d[n].ExtraFormat[0].Video);var f=getFrame(e.Width,e.Height),g=f;"5_1M"===f&&(g="5M"),j.$("#snap_resolution").val(g+" ("+getWidthH(f)+")")}})}),define("enc_osd",function(require,b,c){function d(a,b,c,d){a=a||[0,0,0,0],c=(D*c).toInt(),d=(E*d).toInt();var e=a[0]+c>8191?8191-c:a[0],f=a[1]+d>8191?8191-d:a[1];plugin.SetRegionNum(0),plugin.SetRegionNum(1),plugin.SetRegionAttributeByIndex(0,b,1,0,0,0),setTimeout(function(){plugin.SetSelRegionByIndex(0,e,f,e+c,f+d)
},0)}function e(b){j[H].CustomTitle[1].FrontColor=b,j[H].TimeTitle.FrontColor=b,j[H].ChannelTitle.FrontColor=b,j[H].PTZPreset&&(j[H].PTZPreset.FrontColor=b),j[H].Temperature&&(j[H].Temperature.FrontColor=b),j[H].PTZCoordinates&&(j[H].PTZCoordinates.FrontColor=b),j[H].PTZZoom&&(j[H].PTZZoom.FrontColor=b),j[H].PTZOSDMenu&&(j[H].PTZOSDMenu.FrontColor=b),j[H].PTZOSDMenuViaApp&&(j[H].PTZOSDMenuViaApp.FrontColor=b),j[H].PTZDirection&&(j[H].PTZDirection.FrontColor=b),j[H].GPSTitle&&(j[H].GPSTitle.FrontColor=b),j[H].VoltageStatus&&(j[H].VoltageStatus.FrontColor=b),j[H].PtzPattern&&(j[H].PtzPattern.FrontColor=b),j[H].PtzRS485Detect&&(j[H].PtzRS485Detect.FrontColor=b),A&&(o.FrontColor=b),j[H].GPSTitle&&(j[H].GPSTitle.FrontColor=b),B&&(webApp.IsSDIntel?a.each(m[H],function(a,c){c.FrontColor=b}):m[H].FrontColor=b)}require("jsCore/modules/minPtzControl");var f=require("jsCore/pageBase"),g=require("jsCore/rpc"),h=require("jsCore/ability"),i=require("common/common"),j={},k={},l={},m={},n={},o={},p={},q=!1,r={},s={},t={},u=!1,v=!1,w=!1,x={},y=!1,z=[],A=!1,B=!1,C={},D=16.382,E=8191/374,F="/current_config/",G=null,H=0,I=!0,J=!1;c.exports=f.extend({init:function(){G=this,h.get("PtzFunctionMenu").done(function(a){a&&a.Support&&(u=!0,G.$("#osd_preset").removeClass("fn-hide"))}),g.FaceBoard.getCaps().done(function(b){if(b){var c=b.Temperatures||[],d=b.OSDTemperatureUnit||[];if(v=c.length?!0:!1,w=d.length?!0:!1,v&&(G.$("#osd_temperature").removeClass("fn-hide"),3===c.length&&(y=!0,z=b.Temperatures,G.$("#osd_temperature_cavity").removeClass("fn-hide"),g.ConfigManager.getConfig("MultiTemperatureOSD").done(function(a){x=a}))),w){G.$("#osd_TempUnit_wrap").removeClass("fn-hide");var e={Centigrade:"ºC",Fahrenheit:"ºF",Kelvin:"K"},f="";a.each(d,function(a,b){f+='<option value= "'+b+'">'+e[b]+"</option>"}),G.$("#osd_TempUnit").html(f)}}}),isEnable("is_show_image")&&G.$('[data-for="osd_image"]').removeClass("fn-hide"),isEnable("is_show_fontSize")&&(G.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),G.$("#osd_fontsGrade").removeClass("fn-hide"),C.grade=!0),h.get("FontColour").done(function(a){(a&&a.Support||-1!==webApp.DeviceType.indexOf("TPC")&&1===webApp.CHANNEL_NUMBER)&&(C.color=!0,G.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),G.$("#osd_fontColor").removeClass("fn-hide"),G.$('[data-for = "osd_fontSetting"] span').attr("t","font;title::font").parent().translation())}),h.get("FontBorder").done(function(a){a&&a.Support&&(C.border=!0,G.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),G.$("#osd_fontBorder_wrap").removeClass("fn-hide"),G.$('[data-for = "osd_fontSetting"] span').attr("t","font;title::font").parent().translation())}),h.get("FontSize").done(function(a){a&&a.Support&&(G.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),a.Type.contains("Grade")&&(C.grade=!0,G.$("#osd_fontsGrade").removeClass("fn-hide")),a.Type.contains("Pixel")&&(C.pixel=!0,G.$("#osd_fontsPixel").removeClass("fn-hide"),C.grade=!1,G.$("#osd_fontsGrade").addClass("fn-hide"),G.$('[data-for = "osd_fontSetting"] span').attr("t","font;title::font").parent().translation()))}),g.OSDManager.getCaps().done(function(a){A=a.OSDSysAbnormal&&a.OSDSysAbnormal.Support,C.rowHeight=a.OSDLineSpacing&&a.OSDLineSpacing.Support,A&&G.$('[data-for="osd_abnormal"]').removeClass("fn-hide"),C.rowHeight&&(G.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),G.$("#osd_fontsHeight").removeClass("fn-hide"))}),a.when(h.get("IVSCaps"),h.is("DSPConflict")).then(function(b,c){B=(webApp.IsIPCIntel||webApp.IsSDIntel)&&b&&(-1!==a.inArray("NumberStat",b.SupportedScene)||-1!==a.inArray("NumberStatPlan",b.SupportedScene)),!c&&B&&G.$('[data-for="osd_flowrate"]').removeClass("fn-hide")}),webApp.DeviceType.indexOf("SD")>-1?(G.$('[data-for="osd_covers"]').remove(),G.$('[data-page="osd_covers"]').remove(),G.$("#osd_ipc_left_con").addClass("fn-hide"),isEnable("is_show_LocationInfo")||G.$("#osd_location").addClass("fn-hide")):(G.$('[data-for = "osd_osdcombination"] span').attr("t","w_location;title::w_location"),G.$('[data-for = "osd_osdcombination"]').attr("isLocaltion","true").translation(),(!isEnable("is_show_location")||isEnable("is_8M_Flash"))&&G.$('[data-for = "osd_osdcombination"]').addClass("fn-hide")),isEnable("is_8M_Flash")&&(G.$('[data-for = "osd_fontSetting"]').addClass("fn-hide"),G.$('[data-for = "osd_image"]').addClass("fn-hide")),h.get("IsGpsInfoOsd").done(function(a){a&&(G.$('[data-for = "osd_GPS"]').removeClass("fn-hide"),webApp.GongAnDetect&&G.$("#osd_GPS_mode_wrap").removeClass("fn-hide"))}),h.get("PTZCaps",!0).done(function(b){if(b&&(p.PrivacyMasking=b.PrivacyMasking&&b.PrivacyMasking.Support,p.PtzPatternOSD=!!b.SupportPtzPatternOSD,p.PtzRS485DetectOSD=!!b.SupportPtzRS485DetectOSD,p.Zoom=!(b.Zoom===!1),p.Focus=!(b.Focus===!1),p.Iris=!(b.Iris===!1),G.$("#osd_PTZPattern").toggleClass("fn-hide",!p.PtzPatternOSD),G.$("#osd_PTZRS485").toggleClass("fn-hide",!p.PtzRS485DetectOSD),G.$('[data-for = "osd_privateMask"]').toggleClass("fn-hide",!p.PrivacyMasking||!login.chkAuthority("MPTZ")),b.SDMeasureDistance&&b.SDMeasureDistance.Support&&(G.$('[data-for = "osd_SDMeasureDistance"]').removeClass("fn-hide"),t=b.SDMeasureDistance),webApp.DeviceType.indexOf("SD")>-1)){var c=b.VoltageStatus;c&&c.Support&&(q=!0,a('li[data-for="osd_voltage"]').css("display","block"))}}).always(function(){if(G.$('[data-for = "osd_privateMask"]').hasClass("fn-hide")&&(G.$('[data-for = "osd_privateMask"]').remove(),G.$('[data-page="osd_privateMask"]').remove()),require.async("jsCore/pageTab",function(a){G.$("#osd_content").data("osdTab",new a({element:G.$("#osd_content")}))}),-1!==webApp.DeviceType.indexOf("TPC")&&(G.$('[data-for = "osd_fontSetting"] span').attr("t","font;title::font").parent().translation(),webApp.CHANNEL_NUMBER>1)){G.$("#enc_osd_channel").parent().removeClass("fn-hide"),G.$("#enc_osd_channel").parent().next("div").removeClass("fn-hide");var b=a("#enc_osd_channel").iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){H=b.ch,G.render()}});b.iconSelect("index",H)}G.render()}),G._initPtz(),webApp.GongAnDetect&&a("#font_size_largest").show(),h.get("MagSensor").done(function(a){a&&(J=a.Support)})},render:function(){I=!0,plugin.cover("#video_OSD_node",function(a){plugin.SetRegionNum(0),plugin.SetModuleMode(1),-1!==webApp.DeviceType.indexOf("TPC")?(plugin.SetVisibleVideoWnd(1,H),login.chkAuthority("Monitor_0"+(H+1))&&plugin.ConnectRealVideoEx(H,H,0),!login.chkAuthority("Monitor_0"+(H+1))&&plugin.SetVideoWndTip(H,tl("noVideoAuthoity")),webApp.CHANNEL_NUMBER>1&&(H?G.$("#osd_fontColor").removeClass("fn-hide"):G.$("#osd_fontColor").addClass("fn-hide"),C.color=!!H)):plugin.open(),a&&G.onRefresh(!1)});var b=h.get("PTZCaps",!0).done(function(a){a&&(p.PrivacyMasking=a.PrivacyMasking&&a.PrivacyMasking.Support,p.PTZZoom=!!a.SupportPTZZoom,p.Coordinates=!!a.SupportPTZCoordinates,p.DirectionDisplay=!!a.DirectionDisplay,p.PtzPatternOSD=!!a.SupportPtzPatternOSD,p.PtzRS485DetectOSD=!!a.SupportPtzRS485DetectOSD,p.Zoom=!(a.Zoom===!1),p.Focus=!(a.Focus===!1),p.Iris=!(a.Iris===!1))}),c=webApp.IsSDIntel?"VideoWidgetNumberPlan":"VideoWidgetNumberStat",d=g.ConfigManager.getConfig(["VideoWidget","ChannelTitle",c,"OSDSysAbnormal","VideoWidget2","SDMeasureDistance","GPS","VideoWidgetObjectStat"]).done(function(a){j=a[0].params.table,l=a[1].params.table,a[2].result&&(m=a[2].params.table),a[3].result&&(o=a[3].params.table),a[4].result&&(k=a[4].params.table),a[5].result&&(s=a[5].params.table),a[6].result&&(r=a[6].params.table),a[7].result&&(n=a[6].params.table)});a.when(b,d,h.get("OSDCustom")).done(function(){I&&(G._displayByPTZCaps(),G.$("#osd_content").data("osdTab").render())})},leave:function(){I=!1,plugin.SetRegionNum(0),plugin.hide(),plugin.close()},_initPtz:function(){G.$("#osd_PTZ").minPtzControl("init"),G.$("#osd_PTZ").minPtzControl("togglePTZ",!1)},_displayByPTZCaps:function(){G.$("#osd_coordinates").toggleClass("fn-hide",!p.Coordinates),G.$("#osd_PTZZoom").toggleClass("fn-hide",!(p.PTZZoom&&-1===webApp.DeviceType.indexOf("TPC")||p.PTZZoom&&webApp.CHANNEL_NUMBER>1&&0===H)),G.$("#osd_direction").toggleClass("fn-hide",!p.DirectionDisplay)},onSave:function(){G.$("#osd_content").data("osdTab").current.save();var a=["ChannelTitle","VideoWidget"],b=[l,j];if(B){var c=webApp.IsSDIntel?"VideoWidgetNumberPlan":"VideoWidgetNumberStat";a.push(c),b.push(m)}C.rowHeight&&(a.push("VideoWidget2"),b.push(k)),A&&(a.push("OSDSysAbnormal"),b.push(o)),t&&t.Support&&(a.push("SDMeasureDistance"),b.push(s)),webApp.GongAnDetect&&(a.push("GPS"),b.push(r)),y&&(a.push("MultiTemperatureOSD"),b.push(x)),g.ConfigManager.setConfig(a,b).done(function(a){i.chkMutilCallRet(a)?G.$(".u-tip:first").tip("success",tl("Succeed in saving configure")):G.$(".u-tip:first").tip("error",tl("Saving failure"))})},onRefresh:function(a){var b=webApp.IsSDIntel?"VideoWidgetNumberPlan":"VideoWidgetNumberStat";g.ConfigManager.getConfig(["VideoWidget","ChannelTitle",b,"OSDSysAbnormal","VideoWidget2","SDMeasureDistance","GPS","VideoWidgetObjectStat","MultiTemperatureOSD"]).done(function(b){j=b[0].params.table,l=b[1].params.table,b[2].result&&(m=b[2].params.table),b[3].result&&(o=b[3].params.table),b[4].result&&(k=b[4].params.table),b[5].result&&(s=b[5].params.table),b[6].result&&(r=b[6].params.table),b[7].result&&(n=b[7].params.table),b[8].result&&(x=b[8].params.table),G.$("#osd_content").data("osdTab").render(),a&&G.$(".u-tip:first").tip("success",tl("Operateingsuccess"))}).fail(function(){G.$(".u-tip:first").tip("error",tl("Operateingfailure"))})},onDefault:function(){var a=webApp.IsSDIntel?"VideoWidgetNumberPlan":"VideoWidgetNumberStat";g.ConfigManager.getDefault(["VideoWidget","ChannelTitle",a,"OSDSysAbnormal","VideoWidget2","SDMeasureDistance","GPS","VideoWidgetObjectStat","MultiTemperatureOSD"]).done(function(a){j=a[0].params.table,l=a[1].params.table,a[2].result&&(m=a[2].params.table),a[3].result&&(o=a[3].params.table),a[4].result&&(k=a[4].params.table),a[5].result&&(s=a[5].params.table),a[5].result&&(s=a[5].params.table),a[6].result&&(r=a[6].params.table),a[7].result&&(n=a[6].params.table),a[8].result&&(x=a[8].params.table),G.$("#osd_content").data("osdTab").render(),G.$(".u-tip:first").tip("success",tl("Defaultsuccess"))}).fail(function(){G.$(".u-tip:first").tip("error",tl("Defaultfailure"))})}}),define("osd_covers",function(require,b,c){var d=null;c.exports=f.extend({init:function(){d=this,a("#page_encodeConfig #OSD_delete_all_covers").click(function(){d._clearCover()}),a("#page_encodeConfig #OSD_delete_selected_cover").click(function(){d._delCover()}),d.render()},render:function(){var b=j[H]&&j[H].Covers||[];a("#page_encodeConfig #osd_ipc_left_con").removeClass("fn-hide"),plugin.addEvent("RegionChanged",function(a,c,d,e,f){var g=getDefaultRect(c,d,e,f);g[0]==g[2]||g[1]==g[3]?b[a].Rect=[0,0,0,0]:(b[a]||(b[a]={BackColor:[0,0,0,128],EncodeBlend:!1,FrontColor:[255,255,255,0],PreviewBlend:!1,Rect:[0,0,0,0]}),b[a].Rect=g)}),b[0]&&b[0].EncodeBlend?d.$("#osd_covers_enable_on").prop("checked",!0):d.$("#osd_covers_enable_off").prop("checked",!0),plugin.SetRegionNum(0),plugin.SetRegionNum(-4),webApp.GongAnDetect&&plugin.SetRegionNum(-8),a.each(b,function(a,b){var c=b.Rect[0],d=b.Rect[1],e=b.Rect[2],f=b.Rect[3];c!=e&&d!=f&&plugin.SetSelRegionByIndex(a,c,d,e,f)})},leave:function(){a("#page_encodeConfig #osd_ipc_left_con").addClass("fn-hide"),plugin.addEvent("RegionChanged",null),d.save()},save:function(){var b=d.$("#osd_covers_enable_on").prop("checked");a.each(j[H].Covers,function(a,c){c.EncodeBlend=-1!==webApp.DeviceType.indexOf("TPC")&&0==c.Rect[0]&&0==c.Rect[1]&&0==c.Rect[2]&&0==c.Rect[3]?!1:b})},_clearCover:function(){plugin.DelSelReg(-2),a.each(j[H].Covers,function(a,b){b.Rect=[0,0,0,0]})},_delCover:function(){plugin.DelSelReg(-1)}})}),define("osd_privateMask",function(require,b,c){var d=null,e=null,i=0,j=null;c.exports=f.extend({init:function(){d=this,h.get("PTZCaps").done(function(a){var b=a&&a.PrivacyMasking;b&&(b.SetColorSupport&&d.initColor(b.SetColorSupport,b.SetColorIndependent),b.SupportType&&d.initShape(b.SupportType),b.SetMosaicSupport&&d.initMosaic(b.SetMosaicSupport,b.SupportMosaicType)),d.render()}),d.$("#osd_pr_color span").on("click",function(){d.$(".border-white").removeClass("border-white"),a(this).addClass("border-white")})},render:function(){plugin.SetRegionNum(0),"New"==d.ocxEntry?plugin.addEvent("VideoAnalyzeConfig",function(a){config=JSON.decode(a);var b=config.EventParam.ShapeState;b&&3==b&&d._ocxEventDone(config.EventParam.ShapeID)}):plugin.addEvent("RegionChanged",function(a,b,c,e,f){d.onOcxDrawRegion(b,c,e,f)}),a("#osd_sd_save_el").addClass("fn-hide"),a("#osd_PTZ").minPtzControl("togglePTZ",!0),a("#osd_PTZ").minPtzControl("changeChannel",plugin.windowId),d.getPrivacyMaskingList(),d.switchOcxPrivacyMasking(!1)},leave:function(){d._ocxEnale(!1),plugin.addEvent("VideoAnalyzeConfig",null),plugin.addEvent("RegionChanged",null),a("#osd_sd_save_el").removeClass("fn-hide"),a("#osd_PTZ").minPtzControl("togglePTZ",!1)},renderMaskList:function(){var b=a("#video_privmask_number"),c="";a.each(e[H],function(a,b){c+="<option value="+a+' class="'+(b.Enable?"":"fn-gray")+'">'+(a+1)+"</option>"}),b.html(c),b.val(i)},onChangeMask:function(){d.switchOcxPrivacyMasking(!1),a("#video_privmask_draw").removeClass("ui-button-special-hover"),i=a("#video_privmask_number").val(),d.MosaicSupport&&(a("#osd_pr_Mosaic").val(e[H][i].Mosaic||0),d.onMosaicChange())},onShapeChange:function(){d._ocxClear()},_getOcxData:function(a){if(a.Polygon)e[H][i].ShapType="Polygon",e[H][i].Polygon=a.Polygon;else{e[H][i].ShapType="Rect";var b=a.Rect;e[H][i].Rect=[b[0][0],b[0][1],b[1][0],b[1][1]]}d._saveData()},_saveData:function(){j.done(function(a){e[H][i].Postion=a.Postion}),d.setMaskColor(),d.MosaicSupport&&(e[H][i].Mosaic=a("#osd_pr_Mosaic").val()-0),setTimeout(d._ocxClear,500),d.savePrivMaskConfig(!0),d.renderMaskList()},initColor:function(b,c){1==b&&(d.colorSupport=!0,a("#osd_pr_colorWrap").removeClass("fn-hide"),1==c?d.colorIndependent=!0:a("#osd_pr_colorWrap").insertBefore("#osd_pr_number_wrap"))},setMaskColor:function(){if(1==d.colorSupport){var b=d.$(".border-white").attr("data-color"),c=d.getColorRGB(b);d.colorIndependent?e[H][i].Color=c:a.each(e[H],function(a,b){b.Enable&&(b.Color=c)})}},getColorRGB:function(a){var b={red:[255,0,0,255],orange:[255,150,0,255],yellow:[255,255,0,255],green:[93,214,33,255],blueGreen:[25,233,233,255],blue:[0,60,255,255],purple:[200,0,255,255],black:[0,0,0,255]};return b[a]},initShape:function(b){if(-1!==a.inArray("Polygon",b)){d.ocxEntry="New";for(var c="",e=0;e<b.length;e++)switch(b[e]){case"Rect":c+='<option t="rectangle" value="Rect">'+tl("rectangle")+"</option>";break;case"Polygon":c+='<option t="polygon" value="Polygon">'+tl("polygon")+"</option>";break;default:c+='<option t="Unknown" value="'+b[e]+'">'+tl("Unknown")+"</option>"}a("#osd_pr_ShapType").html(c),a("#osd_pr_shapeWrap").removeClass("fn-hide")}},initMosaic:function(b,c){if(1==b){d.MosaicSupport=!0,d.MosaicSupportType=c||[24];for(var e='<option value="0" t="colorLunp">'+tl("colorLunp")+"</option>",f=0;f<d.MosaicSupportType.length;f++){var g=d.MosaicSupportType[f],h="mosaic+("+g+"x"+g+")";e+='<option value="'+g+'" t="'+h+'"></option>'}a("#osd_pr_Mosaic").html(e).translation(),a("#osd_pr_mosWrap").removeClass("fn-hide")}},onMosaicChange:function(){a("#osd_pr_Mosaic").val()-0!==0?a("#osd_pr_colorWrap").addClass("fn-hide"):d.colorSupport&&a("#osd_pr_colorWrap").removeClass("fn-hide")},onDrawClick:function(){a("#video_privmask_draw").hasClass("ui-button-special-hover")?d.switchOcxPrivacyMasking(!1):(e[H][i].Enable=!0,d.switchOcxPrivacyMasking(!0),j=g.PTZ.getStatus().fail(function(){d.tip("error","Operateingfailure")}),-1!==webApp.DeviceType.indexOf("TPC")&&(d.$("#video_privmask_draw").addClass("fn-hide"),d.$("#video_privmask_save").removeClass("fn-hide")))},onDelClick:function(){d.switchOcxPrivacyMasking(!1),e[H][i].Enable=!1,e[H][i].Rect=[0,0,0,0],e[H][i].Polygon=[],d.savePrivMaskConfig(!0),d.renderMaskList()},onCleanClick:function(){plugin.hide(),a.confirm(tl("Ok"),tl("w_clearPrivacyMaskConfirm"),function(){d.switchOcxPrivacyMasking(!1);for(var a=0;a<e[H].length;a++)e[H][a].Enable=!1,e[H][a].Rect=[0,0,0,0],e[H][a].Polygon=[];d.savePrivMaskConfig(!0),d.renderMaskList(),plugin.cover("#video_OSD_node")},function(){plugin.cover("#video_OSD_node")})},onGotoClick:function(){if(e[H][i].Enable){var a=e[H][i].Postion;g.PTZ.moveAbsolutely(a,null)}},onSaveClick:function(){d._saveData(),d.$("#video_privmask_draw").removeClass("fn-hide"),d.$("#video_privmask_save").addClass("fn-hide"),d.$("#video_privmask_draw").removeClass("ui-button-special-hover")},onOcxDrawRegion:function(a,b,c,f){(0!=a||0!=b||0!=f||0!=c)&&(e[H][i].Rect=[a,b,c,f],-1===webApp.DeviceType.indexOf("TPC")&&d._saveData())},savePrivMaskConfig:function(a){g.ConfigManager.setConfig("PrivacyMasking",e).done(function(){a&&d.tip("success","Operateingsuccess")}).fail(function(){d.tip("error","Operateingfailure")})},getPrivacyMaskingList:function(){g.ConfigManager.getConfig("PrivacyMasking").done(function(a){e=a,d.renderMaskList()}).fail(function(){d.tip("error","Operateingfailure")})},_ocxEnale:function(a){"New"==d.ocxEntry?plugin.EnableVideoAnalyseModule(a):plugin.SetRegionNum(0==a?0:1)},_ocxCreateMainVideoAnalyseShape:function(b){if("New"==d.ocxEntry){var c=a("#osd_pr_ShapType").val();d.shapeID=plugin.CreateMainVideoAnalyseShape(0,"PrivacyMask",c,c,"","Convex")}else plugin.SetRegionNum(1==b?1:0)},_ocxClear:function(){"New"==d.ocxEntry?(plugin.DeleteAllVideoAnalyseShape(),d._ocxCreateMainVideoAnalyseShape()):(plugin.SetRegionNum(0),plugin.SetRegionNum(1))},_ocxGetDate:function(a){return plugin.GetVideoAnalyseShapeConfigData(a)},_ocxEventDone:function(a){d.shapeID=a,d._ocxGetDate(a).done(function(a){var b=JSON.decode(a);d._getOcxData(b)})},switchOcxPrivacyMasking:function(b){d._ocxEnale(b),d._ocxCreateMainVideoAnalyseShape(b),b?a("#video_privmask_draw").addClass("ui-button-special-hover"):a("#video_privmask_draw").removeClass("ui-button-special-hover")}})}),define("osd_channel",function(require,a,b){var c=null;b.exports=f.extend({init:function(){c=this,c.$("#osd_channel_title").textfield({length:63,asciiByte:2,notAsciiByte:3,validReg:/^[^'"\|\&]+$/,errorHandle:"prevent"}),c.render()},render:function(){if(j[H]){var a=j[H].ChannelTitle||{};plugin.addEvent("RegionChanged",function(b,c,d,e,f){var g=getDefaultRect(c,d,e,f);a.Rect=g}),a.EncodeBlend?c.$("#osd_channel_enable_on").prop("checked",!0):c.$("#osd_channel_enable_off").prop("checked",!0),c.$("#osd_channel_title").textfield("value",l[H].Name||""),d(a.Rect,tl("w_ChannelTitle"),100,20)}},leave:function(){plugin.addEvent("RegionChanged",null),c.save()},save:function(){j[H].ChannelTitle.EncodeBlend=c.$("#osd_channel_enable_on").prop("checked"),l[H].Name=c.$("#osd_channel_title").textfield("value")}})}),define("osd_time",function(require,a,b){var c=null;b.exports=f.extend({init:function(){c=this,c.render()},render:function(){var a=j[H].TimeTitle||{};plugin.addEvent("RegionChanged",function(b,c,d,e,f){var g=getDefaultRect(c,d,e,f);a.Rect=g}),a.EncodeBlend?c.$("#osd_time_enable_on").prop("checked",!0):c.$("#osd_time_enable_off").prop("checked",!0),c.$("#osd_time_show_week").prop("checked",a.ShowWeek),d(a.Rect,tl("w_TimeTitle"),160,20)},leave:function(){plugin.addEvent("RegionChanged",null),c.save()},save:function(){j[H].TimeTitle.EncodeBlend=c.$("#osd_time_enable_on").prop("checked"),j[H].TimeTitle.ShowWeek=c.$("#osd_time_show_week").prop("checked")}})}),define("osd_osdcombination",function(require,b,c){var e=this,i=!1;c.exports=f.extend({init:function(){i=!!a('[data-for = "osd_osdcombination"]').attr("isLocaltion"),e=this,e.bind(),h.get("OSDCustom").done(function(b){var c=5;b&&b.Geography&&b.Geography.Support&&(c=b.Geography.TitleLine),webApp.GongAnDetect&&(c=8),e.$("#osd_location_info").empty();for(var d=0;c>d;d++)a('<input type="text" class="ui-input fn-marb1" id="osd_location_info_'+d+'"/>').textfield({length:45,asciiByte:2,notAsciiByte:3,validReg:/^[^'"\|\&]+$/,errorHandle:"prevent"}).appendTo(e.$("#osd_location_info"));e.render()}),i&&e.$('[t="w_location;title::w_location"]').addClass("fn-hide")},bind:function(){e.$('[type ="radio"]').click(function(){if("on"==a(this).val()&&j[H].PictureTitle.EncodeBlend){var b=a(this).attr("id"),c=b.replace("_on","_off");plugin.hide();var d=tl("w_osd_picture_overlay_will_be_disabled");i&&(d=tl("w_picture_overlay_will_be_disabled")),a.confirm(tl("Ok"),d,function(){a("#page_encodeConfig #osd_image_enable_off").prop("checked",!0),j[H].PictureTitle.EncodeBlend=!1,e.$("#"+b).prop("checked",!0),plugin.cover("#video_OSD_node")},function(){e.$("#"+c).prop("checked",!0),plugin.cover("#video_OSD_node")})}}),e.$('[name="osd_temperature_enable"]').click(function(){"on"==a(this).val()?(e.$("#osd_TempUnit_wrap").removeClass("fn-hide"),y&&e.$("#osd_temperature_cavity").removeClass("fn-hide")):(e.$("#osd_TempUnit_wrap").addClass("fn-hide"),e.$("#osd_temperature_cavity").addClass("fn-hide"))}),e.$('[name = "osd_direction_enable"]').unbind().click(function(){"on"==a(this).val()?j[H].PictureTitle.EncodeBlend?(plugin.hide(),a.confirm(tl("Ok"),tl("w_osd_picture_overlay_will_be_disabled"),function(){J||e.$("#dirSetting").removeClass("fn-hide"),a("#osd_PTZ").minPtzControl("togglePTZ",1),a("#osd_PTZ").minPtzControl("changeChannel",plugin.windowId),a("#page_encodeConfig #osd_image_enable_off").prop("checked",!0),j[H].PictureTitle.EncodeBlend=!1,e.$("#osd_direction_enable_on").prop("checked",!0),plugin.cover("#video_OSD_node")},function(){plugin.cover("#video_OSD_node"),e.$("#osd_direction_enable_off").prop("checked",!0)})):(J||e.$("#dirSetting").removeClass("fn-hide"),a("#osd_PTZ").minPtzControl("togglePTZ",1),a("#osd_PTZ").minPtzControl("changeChannel",plugin.windowId)):(J||e.$("#dirSetting").addClass("fn-hide"),a("#osd_PTZ").minPtzControl("togglePTZ",0))}),e.$("#osd_dirSetting_btn").click(e._setNorth)},render:function(){plugin.addEvent("RegionChanged",function(b,c,d,e,f){var g=getDefaultRect(c,d,e,f);if(i)j[H].CustomTitle[1].Rect=g;else{var h=a.extend([],g),k=a.extend([],g),l=a.extend([],g);u&&(j[H].PTZPreset.Rect=h),v&&(j[H].Temperature.Rect=k),p.Coordinates&&(j[H].PTZCoordinates.Rect=k),p.PTZZoom&&(j[H].PTZZoom.Rect=k),p.DirectionDisplay&&(j[H].PTZDirection.Rect=k),j[H].CustomTitle[1].Rect=l}});var b=j[H].CustomTitle[1]||{};b.EncodeBlend?e.$("#osd_location_enable_on").prop("checked",!0):e.$("#osd_location_enable_off").prop("checked",!0),e._setLocationInfo(b.Text||""),e.$("#osd_location_textalign").val("TextAlign"in b?b.TextAlign:2);var c=j[H].PTZPreset||{};c.EncodeBlend?e.$("#osd_preset_enable_on").prop("checked",!0):e.$("#osd_preset_enable_off").prop("checked",!0);var f=j[H].Temperature||{};f.EncodeBlend?(e.$("#osd_temperature_enable_on").prop("checked",!0),e.$("#osd_TempUnit_wrap").removeClass("fn-hide")):(e.$("#osd_temperature_enable_off").prop("checked",!0),e.$("#osd_TempUnit_wrap").addClass("fn-hide")),w&&e.$("#osd_TempUnit").val(f.TemperatureUnit),y&&(e.$("#osd_temperature_up").prop("checked",x[0].Content[z[0].Name].Enable),e.$("#osd_temperature_middle").prop("checked",x[0].Content[z[1].Name].Enable),e.$("#osd_temperature_down").prop("checked",x[0].Content[z[2].Name].Enable));var g=j[H].PTZCoordinates||{};g.EncodeBlend?e.$("#osd_coordinates_enable_on").prop("checked",!0):e.$("#osd_coordinates_enable_off").prop("checked",!0);var h=j[H].PTZZoom||{};h.EncodeBlend?e.$("#osd_PTZZoom_enable_on").prop("checked",!0):e.$("#osd_PTZZoom_enable_off").prop("checked",!0);var k=j[H].PTZDirection||{};k.EncodeBlend?(e.$("#osd_direction_enable_on").prop("checked",!0),J||e.$("#dirSetting").removeClass("fn-hide"),a("#osd_PTZ").minPtzControl("togglePTZ",1),a("#osd_PTZ").minPtzControl("changeChannel",plugin.windowId)):(e.$("#osd_direction_enable_off").prop("checked",!0),J||e.$("#dirSetting").addClass("fn-hide"));var l=j[H].PtzPattern||{};l.EncodeBlend?e.$("#osd_PTZPattern_enable_on").prop("checked",!0):e.$("#osd_PTZPattern_enable_off").prop("checked",!0);var m=j[H].PtzRS485Detect||{};m.EncodeBlend?e.$("#osd_PTZRS485_enable_on").prop("checked",!0):e.$("#osd_PTZRS485_enable_off").prop("checked",!0);var n,o=20,q="w_osdcombination";n=(j[H].CustomTitle[1]||{}).Rect,i&&(q="w_location"),d(n,tl(q),160,o)},leave:function(){e.save(),a("#osd_PTZ").minPtzControl("togglePTZ",0),plugin.addEvent("RegionChanged",null)},save:function(){j[H].CustomTitle[1].Text=e._getLocationInfo(),j[H].CustomTitle[1].EncodeBlend=e.$("#osd_location_enable_on").prop("checked"),j[H].CustomTitle[1].PreviewBlend=e.$("#osd_location_enable_on").prop("checked"),j[H].CustomTitle[1].BackColor=[0,0,0,128],j[H].CustomTitle[1].TextAlign=e.$("#osd_location_textalign").val()-0,u&&(j[H].PTZPreset.EncodeBlend=e.$("#osd_preset_enable_on").prop("checked")),v&&(j[H].Temperature.EncodeBlend=e.$("#osd_temperature_enable_on").prop("checked"),w&&(j[H].Temperature.TemperatureUnit=e.$("#osd_TempUnit").val())),y&&(x[0].Content[z[0].Name].Enable=e.$("#osd_temperature_up").prop("checked"),x[0].Content[z[1].Name].Enable=e.$("#osd_temperature_middle").prop("checked"),x[0].Content[z[2].Name].Enable=e.$("#osd_temperature_down").prop("checked")),p.Coordinates&&(j[H].PTZCoordinates.EncodeBlend=e.$("#osd_coordinates_enable_on").prop("checked")),p.PTZZoom&&(j[H].PTZZoom.EncodeBlend=e.$("#osd_PTZZoom_enable_on").prop("checked")),p.DirectionDisplay&&(j[H].PTZDirection.EncodeBlend=e.$("#osd_direction_enable_on").prop("checked")),p.PtzPatternOSD&&(j[H].PtzPattern.EncodeBlend=e.$("#osd_PTZPattern_enable_on").prop("checked")),p.PtzRS485DetectOSD&&(j[H].PtzRS485Detect.EncodeBlend=e.$("#osd_PTZRS485_enable_on").prop("checked"))},_getLocationInfo:function(){var b=[],c=null;return e.$('[id ^="osd_location_info_"]').each(function(c,d){b.push(a(d).val())}),c=b.join("|"),"||||"===c?"":c},_setLocationInfo:function(b){if(""==b)e.$('[id ^="osd_location_info_"]').each(function(b,c){a(c).val("")});else{var c=b.split("|");a.each(c,function(a,b){e.$("#osd_location_info_"+a).val(b)})}},_setNorth:function(){g.PTZ.setDirection("North").done(function(){a('#page_encodeConfig [data-page="enc_osd"]').children(".u-tip").tip("success","Succeed in saving configure")})}})}),define("osd_fontSetting",function(require,b,c){var d=null,g=null,i="ffffff",l=null;c.exports=f.extend({init:function(){l=this,require.async("jsCore/modules/jscolor",function(){jscolor.init(),d=l.$('[data-pick="jsColor"]')[0],l.bind(),g=new jscolor.color(d,{positionID:"fontAll",positionNew:{left:"0px",top:"42px"},pickerBorderColor:"ThreeDHighlight ThreeDShadow #C0C0C0 ThreeDHighlight",pickerFaceColor:"#C0C0C0",pickerBorderColor:"ThreeDHighlight ThreeDShadow #C0C0C0 ThreeDHighlight"}),l.render()})},bind:function(){l.$("#fontAll").delegate("[data-show]","click",function(){var b=a(this).attr("data-show"),c=l.$("[data-name ="+b+"]");if(!c.hasClass("fn-hide"))return l._changeArrow("up"),void c.addClass("fn-hide");switch(l._changeArrow("down"),c.removeClass("fn-hide"),b){case"pick1":l._hidePick2();break;case"pick2":l._hidePick1(!1),l._setPickColorStr(i),d.value=i,d.focus()}}),l.$("#fontAll").delegate("[data-hide]","click",function(){l._hidePick1();var b=a(this).attr("data-value");l._renderDom(b)}),l.$("#fontAll").delegate("[data-btn]","click",function(){var b=a(this).attr("data-btn");if("ok"==b){var c=d.value;l._renderDom(c)}l._hidePick2(),l._hidePick1()}),a("#page_encodeConfig").click(function(b){var c=a('div[data-name="pick1"]').hasClass("fn-hide");c||b.target.hasClass("showPick1")||l._hidePick1()})},render:function(){if(plugin.SetRegionNum(0),void 0!==j[H].FontSizeScale)switch(j[H].FontSizeScale){case.7:l.$("#fontSizeSmall").prop("checked",!0);break;case 1.1:case 1.2:l.$("#fontSizeLarge").prop("checked",!0);break;case 1.3:l.$("#fontSizeLargest").prop("checked",!0);break;default:l.$("#fontSizeMiddle").prop("checked",!0)}l.$("#osd_fontSize").val(j[H].FontSize),l.$("#osd_FontBorder").prop("checked",j[H].FontBorder),C.rowHeight&&l.$("#osd_fontHeight").val(k[H].OSDLineSpacing);var a=j[H].ChannelTitle.FrontColor,b=l._getColorStr(a);l._renderDom(b),l._hidePick1(),l._hidePick2()},leave:function(){l.save()},save:function(){if(C.color){var b=l._getColor();e(b)}C.grade&&h.get("FontSize").done(function(b){var c=[.7,1,1.1],d=l.$('[name="font-size"]:checked').val()-0;b&&b.GradeRange?a.each(c,function(a){c[a]===d&&(j[H].FontSizeScale=b.GradeRange[a])}):j[H].FontSizeScale=d}),C.pixel&&(j[H].FontSize=l.$("#osd_fontSize").val()-0),C.border&&(j[H].FontBorder=l.$("#osd_FontBorder").prop("checked")),C.rowHeight&&(k[H].OSDLineSpacing=l.$("#osd_fontHeight").val()-0)},_getColorStr:function(a){var b="",c=parseInt(a[0]).toString(16).toUpperCase(),d=parseInt(a[1]).toString(16).toUpperCase(),e=parseInt(a[2]).toString(16).toUpperCase();return 1==c.length&&(c="0"+c),1==d.length&&(d="0"+d),1==e.length&&(e="0"+e),b=c+d+e},_changeArrow:function(a){var b=l.$('span[data-arrow="fontColor"]');switch(a){case"up":b.removeClass("triangleUp"),b.addClass("triangleDown");break;case"down":b.removeClass("triangleDown"),b.addClass("triangleUp")}},_hidePick1:function(a){$$('div[data-name="pick1"]').addClass("fn-hide"),a!==!1&&l._changeArrow("up")},_hidePick2:function(){g.hidePicker(),a('div[data-name="pick2"]').addClass("fn-hide")},_setPickColorStr:function(a){g.fromString(a,!0)},_renderDom:function(b){i=b,a('span[data-name="text"]').css({"border-bottom":"2px solid #"+b,color:"#"+b}),fontColor=l._getColor()},_getColor:function(){return l._getColorRGB(i)},_getColorRGB:function(a){var b=[],c="0x"+a;return b[0]=c>>16&255,b[1]=c>>8&255,b[2]=255&c,b[3]=-1!==webApp.DeviceType.indexOf("TPC")?255:0,b}})}),define("osd_image",function(require,b,c){var e=null,h=null,i={"File Transmit Error":"w_File Transmit Error","File too large":"w_PicFileTooLarge","File length error":"w_File length error","File write error":"w_File write error",PicTypeNotSupport:"w_PicTypeNotSupport",BPPTypeNotSupport:"w_BPPTypeNotSupport",ResolutionNotSupport:"w_ResolutionNotSupport",PicNotExist:"w_PicNotExist",FileOperateError:"w_FileOperateError",PicFileTooLarge:"w_PicFileTooLarge"};c.exports=f.extend({init:function(){e=this,h=a("#enc_osd_tip"),e.render(),e.$('[name = "osd_image_enable"]').click(function(){if("on"==a(this).val())if(webApp.DeviceType.indexOf("SD")>-1){var b=e._getOSDInfo();b&&(plugin.hide(),a.confirm(tl("Ok"),tl("w_osd_location_function_will_be_disabled"),function(){a('#osd_osdcombination [type="radio"][value="on"]').prop("checked",!1),e.$("#osd_image_enable_on").prop("checked",!0),plugin.cover("#video_OSD_node"),j[H].CustomTitle[1].EncodeBlend=!1,j[H].CustomTitle[1].PreviewBlend=!1,u&&(j[H].PTZPreset.EncodeBlend=!1),v&&(j[H].Temperature.EncodeBlend=!1),p.Coordinates&&(j[H].PTZCoordinates.EncodeBlend=!1),p.PTZZoom&&(j[H].PTZZoom.EncodeBlend=!1),p.DirectionDisplay&&(j[H].PTZDirection.EncodeBlend=!1),p.PtzPatternOSD&&(j[H].PtzPattern.EncodeBlend=!1),p.PtzRS485DetectOSD&&(j[H].PtzRS485Detect.EncodeBlend=!1)},function(){plugin.cover("#video_OSD_node"),e.$("#osd_image_enable_off").prop("checked",!0)}))}else j[H].CustomTitle[1].EncodeBlend&&(plugin.hide(),a.confirm(tl("Ok"),tl("w_location_function_will_be_disabled"),function(){a("#osd_location_enable_off").prop("checked",!0),e.$("#osd_image_enable_on").prop("checked",!0),plugin.cover("#video_OSD_node"),j[H].CustomTitle[1].EncodeBlend=!1,j[H].CustomTitle[1].PreviewBlend=!1},function(){plugin.cover("#video_OSD_node"),e.$("#osd_image_enable_off").prop("checked",!0)}))})},render:function(){e.openVideo(),plugin.addEvent("RegionChanged",function(a,b,c,d,e){var f=getDefaultRect(b,c,d,e);j[H].PictureTitle.Rect=f}),e._renderElement(),plugin.addEvent("ResolutionChangeOSD",function(){e._getImgRect()})},openVideo:function(){plugin.cover("#video_OSD_node",function(){plugin.SetRegionNum(0),plugin.SetModuleMode(1),-1!==webApp.DeviceType.indexOf("TPC")?plugin.SetVisibleVideoWnd(1,H):plugin.open()})},_renderElement:function(){var b=j[H].PictureTitle||{};if(b.EncodeBlend?e.$("#osd_image_enable_on").prop("checked",!0):e.$("#osd_image_enable_off").prop("checked",!0),b.Name){var c="url("+F+b.Name+"?"+Date.now()+")";
a(".osd-image-preview").css("background-image",c)}e._getImgRect()},_getImgRect:function(){var a=j[H].PictureTitle,b=a.Width||80,c=a.Height||80,e={x:-1!==webApp.DeviceType.indexOf("TPC")?1280:Video.resolution.x,y:-1!==webApp.DeviceType.indexOf("TPC")?960:Video.resolution.y},b=(e.x/1920*b).ceil(),c=(e.y/1080*c).ceil();b=(8*b+7)/8,b=b%32?32-b%32+b:b,c=c%4?4-c%4+c:c,b=(500/e.x*b).ceil()+2,c=(374/e.y*c).ceil()+2,b=Math.max(b,16),c=Math.max(c,16),d(a.Rect||[0,0,0,0],"",b,c)},leave:function(){e.save(),plugin.addEvent("RegionChanged",null),plugin.addEvent("ResolutionChangeOSD",null)},save:function(){j[H].PictureTitle.EncodeBlend=e.$("#osd_image_enable_on").prop("checked")},imageFileUploadFinish:function(a){a.result?e.updateOverlayPicture():h.tip("warning",tl(i[a.errorCode]))},updateOverlayPicture:function(){g.Encode.updateOverlayPicture([{Name:"osd.bmp"}]).done(function(a){var b=a[0];if(""==b.Error){var c=b.Path.lastIndexOf("/"),d=b.Path.substring(c+1);j[H].PictureTitle.Name=d,j[H].PictureTitle.Width=b.Width,j[H].PictureTitle.Height=b.Height,g.ConfigManager.setConfig("VideoWidget",j).done(function(){var a=j[H].PictureTitle||{};if(a.Name){var b="url("+F+a.Name+"?"+Date.now()+")";e.$(".osd-image-preview").css("background-image",b)}e._getImgRect()}).fail(function(){h.tip("error","Saving failure")})}else h.tip("warning",tl(i[b.Error]))})},onFileChange:function(a){var b=0;if(a.value.test(/.bmp$/i)){try{b=a.files[0].size}catch(c){}b>16384?h.tip("warning",tl("w_PicFileTooLarge")):e.$("#osd_image_submit").trigger("click")}else h.tip("warning",tl("w_PicTypeNotSupport"));a.outerHTML=a.outerHTML},_getOSDInfo:function(){var a={PTZPreset:u,Temperature:v,PTZCoordinates:p.Coordinates,PTZZoom:p.PTZZoom,PTZDirection:p.DirectionDisplay,PtzPattern:p.PtzPatternOSD,PtzRS485Detect:p.PtzRS485DetectOSD};if(j[H].CustomTitle[1].EncodeBlend)return!0;for(var b in a)if(a[b]&&j[H][b].EncodeBlend)return!0;return!1}}),window.OSDImageUploadFinish=function(a){e.imageFileUploadFinish(a)},window.onOSDFileChange=function(a){e.onFileChange(a)}}),define("osd_cpbCount",function(require,b,c){var e=null,g=[],h=[],i=["ffffff","ffffff"];c.exports=f.extend({init:function(){e=this,require.async("jsCore/modules/jscolor",function(){jscolor.init();for(var a=0;2>a;a++){g.push(e.$('[data-pick="jsColor"]').get(a));var b=new jscolor.color(g[a],{positionID:0==a?"osd_trafficFlow_front":"osd_trafficFlow_back",positionNew:{left:"0px",top:"42px"},pickerBorderColor:"ThreeDHighlight ThreeDShadow #C0C0C0 ThreeDHighlight",pickerFaceColor:"#C0C0C0",pickerBorderColor:"ThreeDHighlight ThreeDShadow #C0C0C0 ThreeDHighlight"});h.push(b)}}),e.bind(),e.render()},bind:function(){a.each(["osd_trafficFlow_front","osd_trafficFlow_back"],function(b,c){var d=e.$("#"+c);d.delegate("[data-show]","click",function(){var c=a(this).attr("data-show"),f=d.find("[data-name ="+c+"]");if(!f.hasClass("fn-hide"))return e._changeArrow("up",b),void f.addClass("fn-hide");switch(e._changeArrow("down",b),f.removeClass("fn-hide"),c){case"pick1":e._hidePick2(b);break;case"pick2":e._hidePick1(!1,b),e._setPickColorStr(i[b],b),g[b].value=i[b],g[b].focus()}}).delegate("[data-hide]","click",function(){e._hidePick1(!0,b);var c=a(this).attr("data-value");e._renderDom(c,b)}).delegate("[data-btn]","click",function(){var c=a(this).attr("data-btn");if("ok"==c){var d=g[b].value;e._renderDom(d,b)}e._hidePick2(b),e._hidePick1(!0,b)})})},render:function(){var b=n[H]||{},c=[b.FrontColor,b.BackColor];a.each(h,function(a){var b=e._getColorStr(c[a]);e._renderDom(b,a),e._hidePick1(!0,a),e._hidePick2(a)}),e.$("#osd_trafficFlow_encode").prop("checked",b.EncodeBlend),e.$("#osd_trafficFlow_textalign").val(b.TextAlign),e.$("#osd_trafficFlow_showPeople").prop("checked",b.ShowPeopleNum),e.$("#osd_trafficFlow_showCar").prop("checked",b.ShowCarNum),d(b.Rect,tl("trafficFlow_osd"),120,40),plugin.addEvent("RegionChanged",function(a,b,c,d,e){var f=getDefaultRect(b,c,d,e);n[H].Rect=f})},leave:function(){e.save(),plugin.addEvent("RegionChanged",null)},_changeArrow:function(a,b){var c=e.$('span[data-arrow="fontColor"]').eq(b);switch(a){case"up":c.removeClass("triangleUp").addClass("triangleDown");break;case"down":c.removeClass("triangleDown").addClass("triangleUp")}},_hidePick1:function(a,b){e.$('div[data-name="pick1"]').eq(b).addClass("fn-hide"),a!==!1&&e._changeArrow("up",b)},_hidePick2:function(a){h[a].hidePicker(),e.$('div[data-name="pick2"]').eq(a).addClass("fn-hide")},_setPickColorStr:function(a,b){h[b].fromString(a,!0)},_renderDom:function(b,c){var d=["FrontColor","BackColor"];i[c]=b,a('span[data-name="text"]').eq(c).css({"border-bottom":"2px solid #"+b,color:"#"+b}),n[H][d[c]]=e._getColorRGB(i[c])},_getColorRGB:function(a){var b=[],c="0x"+a;return b[0]=c>>16&255,b[1]=c>>8&255,b[2]=255&c,b[3]=0,b},_getColorStr:function(b){var c=[b[0],b[1],b[2]];return a.each(c,function(a,b){c[a]=parseInt(b).toString(16).toUpperCase(),1==c[a].length&&(c[a]="0"+b)}),c=c.join("")},save:function(){n[curChannel].EncodeBlend=e.$("#osd_trafficFlow_encode").prop("checked"),n[curChannel].FrontColor=e._getColorRGB(i[0]),n[curChannel].BackColor=e._getColorRGB(i[1]),n[curChannel].TextAlign=e.$("#osd_trafficFlow_textalign").val()-0,n[curChannel].ShowPeopleNum=e.$("#osd_trafficFlow_showPeople").prop("checked"),n[curChannel].ShowCarNum=e.$("#osd_trafficFlow_showCar").prop("checked")}})}),define("osd_flowrate",function(require,b,c){var e,g=null;c.exports=f.extend({init:function(){g=this,e=g.$('select[sel-for="onChangePID"]'),h.get("IVSCaps").done(function(a){a&&a.SupportedScenes&&a.SupportedScenes.NumberStatPlan&&g.initRules(a.SupportedScenes.NumberStatPlan.MaxRules),g.render()})},render:function(){var b,c=e.val()-0;webApp.IsSDIntel?a.each(m[H],function(a,d){d.PlanID===c&&(b=d)}):b=m[H]||{},plugin.addEvent("RegionChanged",function(a,c,d,e,f){var g=getDefaultRect(c,d,e,f);b.Rect=g}),b.EncodeBlend?g.$("#osd_flowrate_enable_on").prop("checked",!0):g.$("#osd_flowrate_enable_off").prop("checked",!0),g.$("#osd_show_enter").prop("checked",b.ShowEnterNum),g.$("#osd_show_exit").prop("checked",b.ShowExitNum),g.$("#osd_flowrate_textalign").val("TextAlign"in b?b.TextAlign:2),d(b.Rect,tl("w_flowrate"),120,20)},initRules:function(a){if(e=g.$('select[sel-for="onChangePID"]'),a){var b,c="";for(b=1;a+1>b;b++)c+="<option value="+b+">"+b+"</option>";e.html(c).parent().removeClass("fn-hide")}},onChangePID:function(){g.render()},leave:function(){g.save(),plugin.addEvent("RegionChanged",null)},save:function(){var b,c=e.val()-0;webApp.IsSDIntel?a.each(m[H],function(a,d){d.PlanID===c&&(b=d)}):b=m[H],b.EncodeBlend=g.$("#osd_flowrate_enable_on").prop("checked"),b.ShowEnterNum=g.$("#osd_show_enter").prop("checked"),b.ShowExitNum=g.$("#osd_show_exit").prop("checked"),b.TextAlign=g.$("#osd_flowrate_textalign").val()-0}})}),define("osd_abnormal",function(require,a,b){var c=null;b.exports=f.extend({init:function(){c=this,c.render()},render:function(){plugin.addEvent("RegionChanged",function(a,b,c,d,e){var f=getDefaultRect(b,c,d,e);o.Rect=f}),o.EncodeBlend?c.$("#osd_abnormal_enable_on").prop("checked",!0):c.$("#osd_abnormal_enable_off").prop("checked",!0),d(o.Rect,tl("OSDSysAbnormal"),100,20)},leave:function(){c.save(),plugin.addEvent("RegionChanged",null)},save:function(){o.EncodeBlend=c.$("#osd_abnormal_enable_on").prop("checked")}})}),define("osd_GPS",function(require,b,c){var d,e=null;c.exports=f.extend({init:function(){e=this,d=e.$("#video_GPSmode"),e.render()},render:function(){plugin.SetRegionNum(0);var a=j[H].GPSTitle||{};a.EncodeBlend?e.$("#osd_GPS_enable_on").prop("checked",!0):e.$("#osd_GPS_enable_off").prop("checked",!0);var b=r[0].CurMode||"GPS";d.val(b)},onSelectGPSMode:function(b){r[0].CurMode=a(b.target).val()},leave:function(){e.save()},save:function(){j[H].GPSTitle.EncodeBlend=e.$("#osd_GPS_enable_on").prop("checked"),r[0].CurMode=e.$("#video_GPSmode").val()}})}),define("osd_voltage",function(require,b,c){var d=null;c.exports=f.extend({init:function(){d=this,d.render()},render:function(){plugin.SetRegionNum(0);var b=j[H].VoltageStatus||{};b.EncodeBlend?a("#osd_voltage_enable_on").prop("checked",!0):a("#osd_voltage_enable_off").prop("checked",!0),a("#osd_voltage_continue").val(b.DisplayTime),b.DisplayTime?(a("#osd_voltage_select").val("Manual"),a("#osd_voltage_continue").css("display","block")):(a("#osd_voltage_select").val("Auto"),a("#osd_voltage_continue").css("display","none"))},leave:function(){d.save()},save:function(){j[H].VoltageStatus.EncodeBlend=d.$("#osd_voltage_enable_on").prop("checked"),q&&(j[H].VoltageStatus.EncodeBlend=a("#osd_voltage_enable_on").prop("checked"),j[H].VoltageStatus.PreviewBlend=a("#osd_voltage_enable_on").prop("checked"),"Auto"==a("#osd_voltage_select").value?(j[H].VoltageStatus.DisplayTime=0,a("#osd_voltage_continue").val(0)):j[H].VoltageStatus.DisplayTime=a("#osd_voltage_continue").val()-0)}})}),define("osd_SDMeasureDistance",function(require,a,b){var c,d,e=null;b.exports=f.extend({init:function(){e=this,c=e.$("#osd_sd_height").numberfield({min:0,max:4294967296,allowNegative:!1,allowDecimal:!0,decimalPrecision:1}),d=e.$("#osd_sd_displayDuration").numberfield(),t&&(d=e.$("#osd_sd_displayDuration").numberfield({min:t.DisplayDurationRange[0],max:t.DisplayDurationRange[1],allowNegative:!1,allowDecimal:!1}),e.$("#osd_sd_displayDuration_minTip").text(t.DisplayDurationRange[0]),e.$("#osd_sd_displayDuration_maxTip").text(t.DisplayDurationRange[1])),e.render()},render:function(){var a=(s[H].SDHeight/100).toFixed(1)-0||0,b=s[H].DisplayDuration||2;c.numberfield("value",a),d.numberfield("value",b)},leave:function(){e.save()},save:function(){s[H].SDHeight=parseInt(100*c.numberfield("value")),s[H].DisplayDuration=d.numberfield("value")}})})}),define("enc_inter",function(require,c,d){var e=require("jsCore/pageBase"),f=require("jsCore/rpc"),g=null,h=null,i=0,j=0,k=null;d.exports=e.extend({init:function(){g=this,webApp.CHANNEL_NUMBER>1&&(g.$("#enc_inter_channel").parent().removeClass("fn-hide"),g.$("#enc_inter_channel").parent().next("div").removeClass("fn-hide"),k=a("#enc_inter_channel").iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){j=b.ch,g.openVideo(),g._renderElement()}}),k.iconSelect("index",j)),i=b.MaxROICount,webApp.GongAnDetect&&(i=8),g.$("#inter_clear").on("click",function(){plugin.DelSelReg(-2),h[0].Regions=[]}),g.$("#inter_del").on("click",function(){plugin.DelSelReg(-1)}),g.render()},render:function(){g.openVideo(),plugin.addEvent("RegionChanged",function(a,b,c,d,e){g._postInterWindow(a,b,c,d,e)}),f.ConfigManager.getConfig("VideoEncodeROI").done(function(a){h=a,g._renderElement()})},leave:function(){plugin.addEvent("RegionChanged",null),plugin.SetRegionNum(0),plugin.hide(),plugin.close()},openVideo:function(){plugin.cover("#inter_node",function(a){plugin.SetRegionNum(0),plugin.SetModuleMode(1),-1!==webApp.DeviceType.indexOf("TPC")?(plugin.SetVisibleVideoWnd(1,j),login.chkAuthority("Monitor_0"+(j+1))&&plugin.open(plugin.stream,j,1),!login.chkAuthority("Monitor_0"+(j+1))&&plugin.SetVideoWndTip(j,tl("noVideoAuthoity"))):plugin.open(),a&&g._renderElement()})},_renderElement:function(){var a=h[j];a.Main?g.$("#inter_enable_on").prop("checked",!0):g.$("#inter_enable_off").prop("checked",!0),g.$("#inter_ImgQuality").val(a.Quality),g._areaCoverInter()},_areaCoverInter:function(){var a=[];plugin.SetRegionNum(i),h[j].Regions?a=h[j].Regions:h[j].Regions=[];for(var b=a.length,c=0;b>c;c++){var d=a[c][0],e=a[c][1],f=a[c][2],g=a[c][3];d!=f&&e!=g&&plugin.SetSelRegionByIndex(c,d,e,f,g)}},_postInterWindow:function(a,b,c,d,e){var f=getDefaultRect(b,c,d,e),b=f[0],c=f[1],d=f[2],e=f[3],g=h[j].Regions;g[a]=[b,c,d,e],(d==b||c==e)&&(g[a]=[0,0,0,0])},onDefault:function(){f.ConfigManager.getDefault("VideoEncodeROI").done(function(a){var b=h[j].DynamicTrack;h=a,h[j].DynamicTrack=b,g._renderElement(),g.tip("success","Defaultsuccess")}).fail(function(){g.tip("error","Defaultfailure")})},onRefresh:function(){f.ConfigManager.getConfig("VideoEncodeROI").done(function(a){h=a,g._renderElement(),g.tip("success","Operateingsuccess")}).fail(function(){g.tip("error","Operateingfailure")})},onSave:function(){var a=h[j];a.Main=g.$("#inter_enable_on").prop("checked"),a.Quality=g.$("#inter_ImgQuality").val()-0;for(var b=a.Regions.length;b--;)"0,0,0,0"==a.Regions[b]&&a.Regions.splice(b,1);f.ConfigManager.setConfig("VideoEncodeROI",h).done(function(){g.tip("success","Succeed in saving configure")}).fail(function(){g.tip("error","Saving failure")})}})}),define("enc_path",function(require,b,c){function d(){for(var a=f.$(".video-path-input"),b=null,c=0,d=a.length;d>c;c++){if(b=a[c],"nacl"===plugin.type&&""===b.value)return!0;if(""===b.value)return f.tip("error","w_pathErrors"),!1;if(b.value=b.value.replace(/\s+[\\\\]/g,"\\").replace(/[\\\\]\s+/g,"\\"),StringUtil.byteLength(b.value,"aaa")>200)return void f.tip("error","w_pathLong")}return!0}var e=require("jsCore/pageBase"),f=(require("jsCore/rpc"),null),g=["LiveSnapshot","LiveRecord","PlaybackSnapshot","PlaybackRecord","VideoClips"];c.exports=e.extend({init:function(){f=this,webApp.IsLocalStore||f.$(".need-sd-card").addClass("fn-hide"),-1!==webApp.DeviceType.indexOf("TPC")&&webApp.DeviceType.contains("-T")?(f.$("#path_needTpc").removeClass("fn-hide"),g.push("HeatMap")):f.$("#path_needTpc").remove(),f.render()},render:function(){a.each(g,function(a,b){plugin.GetConfigPath(b).done(function(a){f.$("#path_"+b).val(a)})})},onChoosePath:function(b){var c=a(b.target).attr("data-target");plugin.ShowFileBrowse().done(function(a){c&&f.$("#path_"+c).val(a)})},onDefault:function(){a.each(g,function(a,b){plugin.GetDefaultConfigPath(b).done(function(a){f.$("#path_"+b).val(a)})}),f.tip("success","Defaultsuccess")},onSave:function(){d()&&(a.each(g,function(a,b){plugin.SetConfigPath(b,f.$("#path_"+b).val())}),f.tip("success","Succeed in saving configure"))}})}),define("enc_encrypt",function(require,b,c){var d=require("jsCore/pageBase"),e=require("jsCore/rpc"),f=require("common/common"),g=f.Check,h=null,i=null,j=0,k=null;c.exports=d.extend({init:function(){h=this,$port1=h.$("#encrypt_port").numberfield({min:1,max:65535,allowDecimal:!1,allowNegative:!1}),$port2=h.$("#encrypt_port2").numberfield({min:1,max:65535,allowDecimal:!1,allowNegative:!1}),k=a.validator([{element:"#encrypt_deviceid",check:[g.alphaNumLineDot,g.alphaNumLineDot],errorMsg:["w_wrongServerName","w_wrongServerName"],events:["keyup","blur"]}],function(a){a.parent().translation()}),h.$("#encrypt_serverip").ipfield({type:""}),h.$("#encrypt_serverip2").ipfield({type:""}),h.render()},render:function(a){e.ConfigManager.getConfig("NetSerEncrypt").done(function(b){i=b,h._renderElement(),a&&h.tip("success","Operateingsuccess")}).fail(function(){h.tip("error","Operateingfailure")})},_renderElement:function(){var a=i[j][0];h.$("#encrypt_deviceid").val(a.NetID),h.$("#encrypt_serverip").ipfield("value",a.Address),h.$("#encrypt_port").val(a.Port),h.$("#encrypt_serverip2").ipfield("value",a.BakAddress),h.$("#encrypt_port2").val(a.BakPort),k.validate()},onDefault:function(){e.ConfigManager.getDefault("NetSerEncrypt").done(function(a){i=a,h._renderElement(),h.tip("success","Defaultsuccess")}).fail(function(){h.tip("error","Defaultfailure")})},onRefresh:function(){h.render(!0)},onSave:function(){var a=i[j][0];return a.NetID=h.$("#encrypt_deviceid").val(),a.Address=h.$("#encrypt_serverip").ipfield("value"),a.Port=$port1.numberfield("value"),a.BakAddress=h.$("#encrypt_serverip2").ipfield("value"),a.BakPort=$port2.numberfield("value"),k.isInvalid()?h.tip("warning",k.errors()[0].errorMsg):void e.ConfigManager.setConfig("NetSerEncrypt",i).done(function(){var b=a.Address||a.BakAddress,c=(a.Port||a.BakPort)-0;plugin.SetDecodeKeyEx(0,b,c,a.NetID,""),h.tip("success","Succeed in saving configure")}).fail(function(){h.tip("error","Saving failure")})}})})}(jQuery);