!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("ipc_shoot",function(require,b,c){var d=require("jsCore/rpc"),e=require("jsCore/pageBase"),f=require("jsCore/modules/timeSection");require("jsCore/modules/eventHandler");var g=null,h=0,i=null,j=null,k=null;c.exports=e.extend({init:function(){g=this,g.$("#shoot_mutex").eventHandler(),g.$("#shoot_ruleInputName").on("blur",function(){var b=a(this).val();plugin.SetCurShape(j.Name),plugin.SetCurName(b),plugin.SetCurShape("save"),j.Name=b}),g.render()},render:function(){plugin.cover("#shootVideo",function(a){plugin.SetRegionNum(0),plugin.SetModuleMode(2),login.chkAuthority("Monitor_01")&&plugin.open(),a&&g._renderOcx()}),g._getConfig(),plugin.addEvent("OutPutStringInfo",function(a,b){if("OutPutShapeRect"==a){var c=JSON.parse(b);j.Config.DetectRegion=c.Config.DetectRegion}})},_getConfig:function(a){d.ConfigManager.getConfig("VideoAnalyseRule").done(function(b){i=b,g._renderElement(),a&&g.$("#shoot_tip").tip("success",tl("Operateingsuccess"))}).fail(function(){g.$("#shoot_tip").tip("error",tl("Operateingfailure"))})},_renderElement:function(){a.each(i[h],function(a,b){return"SCR"===b.Class?(j=b,!1):void 0}),g.$("#shoot_Enable").prop("checked",j.Enable),g.$("#shoot_ruleInputName").val(j.Name||""),g.$("#shoot_mutex").eventHandler("set",j.EventHandler),setTimeout(function(){g._renderOcx()},500)},_renderOcx:function(){g._buildRuleJson(),plugin.SetIVSConfig(k,2),plugin.SetCurShape(j.Name),g._ruleInitEmpty(),plugin.SetCurShape("save")},leave:function(){plugin.addEvent("OutPutStringInfo",null),plugin.hide(),plugin.close()},onDefault:function(){d.ConfigManager.getDefault("VideoAnalyseRule").done(function(a){i=a,g._renderElement(),g.$("#shoot_tip").tip("success",tl("Defaultsuccess"))}).fail(function(){g.$("#shoot_tip").tip("error",tl("Defaultfailure"))})},onRefresh:function(){g._getConfig(!0)},onConfirm:function(){plugin.SetCurShape("save"),j.Enable=a("#shoot_Enable").prop("checked"),j.Name=a("#shoot_ruleInputName").val(),j.EventHandler=g.$("#shoot_mutex").eventHandler("get"),d.ConfigManager.setConfig("VideoAnalyseRule",i).done(function(){g.$("#shoot_tip").tip("success",tl("Succeed in saving configure"))}).fail(function(){g.$("#shoot_tip").tip("error",tl("Saving failure"))})},onSetUp:function(){j.EventHandler&&j.EventHandler.TimeSection&&(plugin.hide(),f.open(j.EventHandler.TimeSection).done(function(a){j.EventHandler.TimeSection=a}).always(function(){plugin.cover("#shootVideo")}))},onClear:function(){j.Config.Round+=1},onEnableRule:function(b){j.Enable=a(b.target).prop("checked"),g._renderOcx()},_buildRuleJson:function(){var b=a.extend(!0,{},j),c={result:!0,params:{table:[[b]]}};k=JSON.encode(c)},_ruleInitEmpty:function(a){var b=j.Config.DetectRegion;noShapeFlag=!0;for(var c=b.length;c--;)if(b[c][0]||b[c][1]){noShapeFlag=!1;break}return noShapeFlag&&!a&&plugin.DeleteShape(j.Name),noShapeFlag},onDrawRule:function(){if(g.$("#shoot_Enable").prop("checked")){var a=g.$("#shoot_ruleInputName").val(),b=-1,c=0,d=g._ruleInitEmpty(!0);if(!d)return void plugin.SelectRule(a,-1);var e="ShootingScoreRecognition";plugin.AddShape(2,e,a,b,c)}},onClearRule:function(){j.Config.DetectRegion=[[0,0],[0,0],[0,0],[0,0]],j.Config.Direction=[[0,0],[0,0]],g._buildRuleJson(),plugin.DeleteShape(j.Name),g.onDrawRule()}})})}(jQuery);