!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("ddns",function(require,b,c){var d=require("jsCore/rpc"),e=require("jsCore/pageBase"),f=require("common/common"),g=f.Check,h=null,i=0,j={},k={},l="",m="",n=60,o=null,p=null,q=null,r=null,s=null,t=null;c.exports=e.extend({init:function(){h=this,o=h.$("[sel-for=onProSel]"),$ddns_hostname=h.$("[cfg=HostName]"),r=h.$("[btn-for=onTest]"),s=h.$("[chk-for=onEnable]"),$dialogData=h.$("#ddns_connectDDNS").dialog({}).detach().appendTo(document.body),t=h.$("#ddns_test_tip"),validator=a.validator([{element:h.$("[cfg=Password]"),check:[g.noQuotation,g.noQuotation],errorMsg:["w_noInputMarks","w_noInputMarks"],events:["keyup","blur"]},{element:h.$("[cfg=UserName]"),check:[g.noQuotation,g.noQuotation],errorMsg:["w_noInputMarks","w_noInputMarks"],events:["keyup","blur"]},{element:h.$("[cfg=Address]"),check:[g.alphaNumLineDot,g.alphaNumLineDot,g.require],errorMsg:["w_wrongServerName","w_wrongServerName","w_wrongServerName"],events:["keyup","blur","blur"]}],function(a){a.parent().translation()}),p=h.$("[cfg=Port]").numberfield({min:1,max:65535,allowDecimal:!1,allowNegative:!1}),q=h.$("[cfg=KeepAlive]").numberfield({min:1,max:500,allowDecimal:!1,allowNegative:!1}),h.$("input[id^=ddns_mode_]").click(h.onRadio),h.render()},destory:function(){$dialogData.remove()},render:function(){d.ConfigManager.getConfig("DDNS").done(function(b){j=b,k=a.extend(!0,{},b),h._setProtocolOptions(),h._renderElements()})},_setProtocolOptions:function(){o.empty();var b=!1;a.each(j,function(a,c){c.Enable&&!b&&(b=!0,i=a),("Private DDNS"!=c.Name||"Dahua"==webCaps.vendor&&"SimpChinese"==Site.currentLanguage)&&(o.append('<option value="'+c.Protocol+'" t="'+(c.Name||c.Protocol)+'"></option>'),("CP Plus DDNS"==c.Protocol||"Private DDNS"==c.Protocol||"QUICK DDNS"==c.Protocol)&&((c.Enable||!b)&&(b=c.Enable,i=a),"CP Plus DDNS"!=c.Protocol&&"Dahua"==webCaps.vendor&&o.find("option[value='"+c.Protocol+"']").attr("t","Dahua DDNS")))}),o.get(0).selectedIndex=i,o.translation()},_renderElements:function(){var b=j[i];$ddns_hostname.unbind("keyup").keyup("CP Plus DDNS"===o.val()?h._showPostBtn:h._onHostnameKeyup),h.$("#ddns_hostname_postfix, #ddns_test_tip, #ddns_test_tipred").text(""),h.$("#ddns_macAddress_wrap, #ddns_internetStatus_wrap, #ddns_password_wrap, #ddns_keepalive_wrap, #ddns_cpPlusNotes_wrap, [t=w_UsernameTip], [btn-for=onTest], #ddns_test_image, #ddns_port_wrap, #ddns_mode_wrap").hide(),h.$("#ddns_serviceIp_wrap, #ddns_username_wrap").show(),h.Available(!0),s.prop("checked",b.Enable||!1),o.eq(i).attr("selected",!0),a.each(h.$("[cfg]"),function(a,c){var d=h.$(c).attr("cfg");h.$(c).val(b[d])}),$ddns_hostname.prop("maxLength","Private DDNS"===b.Protocol||"QUICK DDNS"===b.Protocol?60:64),"Private DDNS"!=b.Protocol&&"QUICK DDNS"!=b.Protocol&&"CP Plus DDNS"!=b.Protocol?(h.$("#ddns_password_wrap, #ddns_keepalive_wrap").show(),h.disabled("[cfg=HostName]",!1)):"CP Plus DDNS"===b.Protocol?(h.$("#ddns_macAddress_wrap, #ddns_internetStatus_wrap, #ddns_cpPlusNotes_wrap").show(),h.$("#ddns_serviceIp_wrap, #ddns_username_wrap").hide(),h.disabled("[cfg=HostName]",s.is(":checked")),$ddns_hostname.val(b.HostName.replace(/(.cpplusddns.com)+/,"")),h.$("#ddns_hostname_postfix").text(".cpplusddns.com"),h.$("#ddns_title9").text("http://"+$ddns_hostname.val()+".cpplusddns.com"),""===m?d.ConfigManager.getConfig("Network").done(function(a){m=a[a.DefaultInterface].PhysicalAddress,h.$("#ddns_macAddressSpan").text(m)}):h.$("#ddns_macAddressSpan").text(m),n=60,h._getConnectState("one")):("Private DDNS"===b.Protocol||"QUICK DDNS"===b.Protocol)&&(l=b.Address.indexOf(".")>-1?b.Address.replace("www",""):"",h.$("#ddns_hostname_postfix").text(l),h.$("[t=w_UsernameTip], #ddns_mode_wrap").show(),b.DefaultHostName&&b.DefaultHostName.Enable?(h.$("#ddns_mode_auto").prop("checked",!0),$ddns_hostname.val(b.DefaultHostName.HostName.replace(l,"")),h.disabled("[cfg=HostName]")):(h.$("#ddns_mode_manual").prop("checked",!0),r.show(),h.disabled("[cfg=HostName]",!1),$ddns_hostname.val(b.HostName.replace(l,"")))),h.disabled("[cfg=Address]","Private DDNS"!=b.Name),"Private DDNS"===b.Name?h.$("#ddns_port_wrap").show():h.$("#ddns_port_wrap").hide(),validator.validate(),h.$("#ddns_test_tipred").text(g.alphaNumLineDot($ddns_hostname.val())?"":tl("w_wrongDomainName2"))},onProSel:function(){return"CP Plus DDNS"==j[i].Protocol&&$ddns_hostname.val().length<3?(h.tip("warning","w_Operation failed:The hostname of CP Plus DDNS cannot be less than three alphas"),void o.eq(i).attr("selected",!0)):(h._saveData(),i=o.get(0).selectedIndex,void h._renderElements())},onRadio:function(){var a=h.$("#ddns_mode_auto").is(":checked");h.disabled($ddns_hostname,a),h.$("#ddns_test_image").hide(),a?(r.hide(),t.text(""),h.disabled("[btn-for=onConfirm]",!1),$ddns_hostname.val(j[i].DefaultHostName?j[i].DefaultHostName.HostName.replace(l,""):j[i].HostName.replace(l,""))):r.show()},onTest:function(){var a=j[i].Protocol,b=h.$("[cfg=Address]").val(),c=p.numberfield("value"),e=$ddns_hostname.val()+l,f=h.$("[cfg=UserName]").val(),g=h.$("[cfg=Password]").val();h.$("#ddns_test_tipred").text(""),t.text(tl("testing...")).prop("className","ui-tip-red"),h.$("#ddns_test_image").show(),h.Available(!1,!0),d.DdnsClient.testHostName(a,b,c,e,f,g).done(function(){t.text(tl("Succeed!")).prop("className","ui-tip-green"),j[i].HostName=$ddns_hostname.val()+l,h.Available(!0,!0)}).fail(function(a){var b="";a.params&&a.params.Detail&&(b=a.params.Detail),h.Available(!0,!0),t.prop("className","ui-tip-red"),$ddns_hostname.val(j[i].HostName.replace(l,"")),t.text("nohost\r\n"===b?tl("Domain Exist!"):"!yours\r\n"===b?tl("Domain Used!"):"!active\r\n"===b||"abuse\r\n"===b||"dnserr\r\n"===b||"911\r\n"===b?tl("Server Fail!"):tl("Fail!"))}).always(function(){h.$("#ddns_test_image").hide(),setTimeout(function(){t.text("")},3e3)})},onDefault:function(){d.ConfigManager.getDefault("DDNS").done(function(a){j=a,i=0,h._setProtocolOptions(),h._renderElements(),h.tip("success","Defaultsuccess")}).fail(function(){h.tip("error","Defaultfailure")})},onRefresh:function(){d.ConfigManager.getConfig("DDNS").done(function(a){j=a,i=0,h._setProtocolOptions(),h._renderElements(),h.tip("success","Operateingsuccess")}).fail(function(){h.tip("error","Operateingfailure")})},onConfirm:function(){var b=!0;return validator.isInvalid()?h.tip("warning",validator.errors()[0].errorMsg):g.alphaNumLineDot($ddns_hostname.val())?(h._saveData(),"CP Plus DDNS"!=o.val()||/^[a-zA-Z0-9-_.]+$/.test(j[i].HostName.replace(".cpplusddns.com",""))?(a.each(j,function(a,c){return"Private DDNS"!==c.Protocol&&"QUICK DDNS"!==c.Protocol||!c.UserName||expressionCheck(7,c.UserName)||""===c.UserName?("Private val"!=c.Name||expressionCheck(1,c.Address))&&g.alphaNumLineDot(c.Address)?g.alphaNumLineDot(c.HostName)?g.noQuotation(c.UserName)&&g.noQuotation(c.Password)?void 0:(h.tip("warning","w_noInputMarks"),b=!1,!1):(h.tip("warning","w_wrongDomainName2"),b=!1,!1):(h.tip("warning","w_wrongServerName"),b=!1,!1):(h.tip("warning","Private DDNS"===c.Protocol?"w_emailLimite":"w_quickemailLimite"),b=!1,!1)}),void(b&&d.ConfigManager.setConfig("DDNS",j).done(function(){h.disabled("[sel-for=onProSel], #ddns_mode_auto, #ddns_mode_manual, #ddns_confirm",!1),h.tip("success","Succeed in saving configure"),"CP Plus DDNS"==o.val()&&($dialogData.dialog("show"),$dialogData.find("#ddns_connectDDNSTitle").text(tl("w_DDNSconnectting")),n=60,setTimeout(h._getConnectState,6e3))}).fail(function(){"CP Plus DDNS"==o.val()&&h.disabled("#ddns_confirm, #ddns_refresh, #ddns_default",!1),h.tip("error","Saving failure")}))):h.tip("error",tl("w_wrongDomainName"))):h.tip("warning","w_wrongDomainName2")},Available:function(a,b){h.disabled("[sel-for=onProSel], #ddns_mode_auto, #ddns_mode_manual, #ddns_confirm",!a),b&&h.disabled("[cfg=HostName], [cfg=UserName], [chk-for=onEnable], [btn-for=onDefault], [btn-for=onRefresh], [btn-for=onConfirm], [btn-for=onTest]",!a),b&&(a?h.$("[btn-for=onDefault], [btn-for=onRefresh], [btn-for=onConfirm], [btn-for=onTest]").removeClass("ui-button-disabled"):h.$("[btn-for=onDefault], [btn-for=onRefresh], [btn-for=onConfirm], [btn-for=onTest]").addClass("ui-button-disabled"))},_saveData:function(){var a=j[i];a.Enable=s.is(":checked"),"Private DDNS"===a.Protocol||"QUICK DDNS"===a.Protocol?(h.$("#ddns_mode_manual").is(":checked")&&(a.HostName=$ddns_hostname.val()+l),null!=a.DefaultHostName&&(a.DefaultHostName.Enable=!h.$("#ddns_mode_manual").is(":checked"))):a.HostName=$ddns_hostname.val()||"",a.Address=h.$("[cfg=Address]").val(),a.Port=p.numberfield("value"),a.UserName=h.$("[cfg=UserName]").val(),a.Password=h.$("[cfg=Password]").val(),a.KeepAlive=q.numberfield("value")},_getConnectState:function(a){n--;var b="",c="",e="";d.DdnsClient.getStatus().done(function(d){var f=d[i].Value;switch(d[i].Status){case 0:b="Disconnected",n>0&&void 0==a&&setTimeout(h._getConnectState,1e3);break;case 1:b="m_connected",908==f&&(c="w_cpDDNS908"),909==f&&(c="w_cpDDNS909"),910==f&&(c="w_cpDDNS910"),801==f&&(c="w_cpDDNS801"),702==f&&(c="w_cpDDNS702"),$dialogData.find("#ddns_connectDDNSTitle").text(tl("m_connected")+": "+tl(c)),setTimeout(function(){$dialogData.dialog("close")},5e3),h.disabled("#ddns_confirm, #ddns_refresh, #ddns_default",!1),e=d[i].ConIp;break;case 2:601==f?(c="w_cpDDNS601",$dialogData.find("#ddns_connectDDNSTitle").text(tl("Disconnected")+": "+tl(c)),setTimeout(function(){$dialogData.dialog("close")},5e3)):$dialogData&&$dialogData.dialog("close"),b="Disconnected",h.disabled("#ddns_confirm, #ddns_refresh, #ddns_default",!1)}0==f&&(c="w_cpDDNS0"),901==f&&(c="w_cpDDNS901"),902==f&&(c="w_cpDDNS902"),903==f&&(c="w_cpDDNS903"),904==f&&(c="w_cpDDNS904"),905==f&&(c="w_cpDDNS905"),906==f&&(c="w_cpDDNS906"),907==f&&(c="w_cpDDNS907"),911==f&&(c="w_cpDDNS911"),912==f&&(c="w_cpDDNS912"),!s.is(":checked")&&(c="w_Note:The CP PLUS DDNS function has not been enabled");var g=h.$("#ddns_noteStatus");return g.text("").prop("className","ui-text"),0==n?(h.$("#ddns_internetStatus").text(tl("Disconnected")),g.text(tl("w_cpDDNS0")).prop("className","ui-tip-red"),h.disabled("#ddns_confirm, #ddns_refresh, #ddns_default",!1),void($dialogData&&$dialogData.dialog("close"))):(f=d[i].Status,1==f&&g.text(e),2==f&&g.text(tl(c)).prop("className","ui-tip-red"),0==f&&void 0!=a&&g.text(tl(c)).prop("className","ui-tip-red"),void h.$("#ddns_internetStatus").text(tl(b)))})},onEnable:function(){"CP Plus DDNS"==o.val()&&h.disabled("[cfg=HostName]",!s.is(":checked"))},_showPostBtn:function(){h.$("#ddns_title9").text("http://"+$ddns_hostname.val()+".cpplusddns.com"),""==$ddns_hostname.val()||0==$ddns_hostname.val().length?(t.text(tl("w_wrongHostName")),h.disabled("#ddns_confirm")):(t.text(""),h.disabled("#ddns_confirm",!1))},_onHostnameKeyup:function(){h.$("#ddns_test_tipred").text(g.alphaNumLineDot($ddns_hostname.val())?"":tl("w_wrongDomainName2")),("Private DDNS"===o.val()||"QUICK DDNS"===o.val())&&h.$("#ddns_mode_manual").is(":checked")&&h.Available($ddns_hostname.val()===k[i].HostName.replace(l,""))}})})}(jQuery);