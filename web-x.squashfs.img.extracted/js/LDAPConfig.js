!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("ldap",function(require,b,c){function d(a){return/[\"]+/.test(a)||/[\']+/.test(a)||/[\u4E00-\u9FA5]+/.test(a)||/\s/.test(a)?!1:!0}var e=require("jsCore/rpc"),f=require("jsCore/pageBase"),g=null,h=null,i={},j={},k=require("common/common"),l=k.Check;c.exports=f.extend({init:function(){g=this,h=a.validator([{element:g.$("[cfg=AD+Server]"),check:[l.alphaNumLineDot,l.alphaNumLineDot],errorMsg:["w_wrongServerName","w_wrongServerName"],events:["keyup","blur"]},{element:g.$("[cfg=LDAP+Server]"),check:[l.alphaNumLineDot,l.alphaNumLineDot],errorMsg:["w_wrongServerName","w_wrongServerName"],events:["keyup","blur"]},{element:g.$("[cfg=AD+BaseDN]"),check:[l.alphaNumUnderline,l.alphaNumUnderline],errorMsg:["w_Badstring","w_Badstring"],events:["keyup","blur"]},{element:g.$("[cfg=LDAP+BaseDN]"),check:[l.alphaNumUnderline,l.alphaNumUnderline],errorMsg:["w_Badstring","w_Badstring"],events:["keyup","blur"]},{element:g.$("[cfg=LDAP+BindPassword]"),check:[l.numAndLetter,l.numAndLetter],errorMsg:["w_Badpwd","w_Badpwd"],events:["keyup","blur"]},{element:g.$("[cfg=AD+Filter]"),check:[d,d],errorMsg:["w_noInputChMarksSpace","w_noInputChMarksSpace"],events:["keyup","blur"]},{element:g.$("[cfg=LDAP+Filter]"),check:[d,d],errorMsg:["w_noInputChMarksSpace","w_noInputChMarksSpace"],events:["keyup","blur"]},{element:g.$("[cfg=LDAP+BindDN]"),check:[l.alphaNumUnderline,l.alphaNumUnderline],errorMsg:["w_Badstring","w_Badstring"],events:["keyup","blur"]}],function(a){a.parent().translation()}),g.$("[cfg=LDAP+Port]","[cfg=AD+Port]").numberfield({min:1,max:65535,allowDecimal:!1,allowNegative:!1}),g.render()},render:function(){e.ConfigManager.getConfig("LDAP").done(function(a){i=a,e.ConfigManager.getConfig("ActiveDirectory").done(function(a){j=a,g.$("[sel-for=onLoginModeChange]").eq(0).attr("selected",!0),g._renderElements()})})},_renderElements:function(){1==g.$("[sel-for=onLoginModeChange]").val()?(g.$("#ldap_AD").show(),g.$("#ldap_LDAP").hide(),g.$("#ldap_enable").prop("checked",j[0].Enable)):(g.$("#ldap_AD").hide(),g.$("#ldap_LDAP").show(),g.$("#ldap_enable").prop("checked",i[0].Enable),g.onAnonymous()),a.each(g.$("[cfg]"),function(){var a=g.$(item).attr("cfg");g.$(item).val(a.indexOf("AD")>-1?j[0][a.replace("AD+","")]:i[0][a.replace("LDAP+","")])}),h.validate()},onDefault:function(){e.ConfigManager.getDefault(["LDAP","ActiveDirectory"]).done(function(a,b){i=b.params[0].params.table,g_jsonAD=b.params[1].params.table,g._renderElements(),g.tip("success","Defaultsuccess")}).fail(function(){g.tip("error","Defaultfailure")})},onRefresh:function(){e.ConfigManager.getConfig("LDAP").done(function(a){i=a,e.ConfigManager.getConfig("ActiveDirectory").done(function(a){j=a,g._renderElements(),g.tip("success","Operateingsuccess")}).fail(function(){g.tip("error","Operateingfailure")})}).fail(function(){g.tip("error","Operateingfailure")})},onConfirm:function(){return h.isInvalid()?g.tip("warning",h.errors()[0].errorMsg):(a.each(g.$("[cfg]"),function(){var a=g.$(item).attr("cfg");a.indexOf("AD")>-1?j[0][a.replace("AD+","")]="Port"===a.replace("AD+","")?g.$("[cfg=AD+Port]").numberfield("value"):g.$(item).val():i[0][a.replace("LDAP+","")]="Port"===a.replace("LDAP+","")?g.$("[cfg=LDAP+Port]").numberfield("value"):g.$(item).val()}),1==g.$("[sel-for=onLoginModeChange]").val()?j[0].Enable=g.$("#ldap_enable").is(":checked"):i[0].Enable=g.$("#ldap_enable").is(":checked"),void e.ConfigManager.setConfig("LDAP",i).done(function(){e.ConfigManager.setConfig("ActiveDirectory",j).done(function(){g.tip("success","Succeed in saving configure")}).fail(function(){g.tip("error","Saving failure")})}).fail(function(){g.tip("error","Saving failure")}))},onAnonymous:function(){g.disabled("[cfg=LDAP+BindDN], [cfg=LDAP+BindPassword]",g.$("[key-for=onAnonymous]").is(":checked"))},onLgnModeChange:function(){1==g.$("[sel-for=onLoginModeChange]").val()?i[0].Enable=g.$("#ldap_enable").is(":checked"):j[0].Enable=g.$("#ldap_enable").is(":checked"),g._renderElements()}})})}(jQuery);