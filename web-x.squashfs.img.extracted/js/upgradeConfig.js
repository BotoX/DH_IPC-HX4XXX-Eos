!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("upg_upgrade",function(require,b,c){var d=require("jsCore/pageBase"),e=require("jsCore/rpc"),f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null;c.exports=d.extend({init:function(){f=this,g=f.$("#upg_upgrade"),h=f.$("#upg_path"),i=f.$("#upg_import"),j=f.$("#upg_probar"),k=f.$("#upg_process"),l=f.$("#upg_updating"),m=f.$("#upg_update"),g.on("change blur",f._onUpgradeChange),g.hover(function(){i.addClass("ui-button-hover")},function(){i.removeClass("ui-button-hover")}),f.render()},render:function(){h.val("")},onSelectFile:function(){g.trigger("click")},_onUpgradeChange:function(){var b=a(this).val().split("\\");h.val(b[b.length-1])},onUpdate:function(){var a=g.val();""!==h.val()&&(a.test(".bin","i")?(f.disabled(m,!0),f.$("#upg_submit").trigger("click"),j.css("visibility","visible"),k.css("width","25px")):f.$(".u-tip").tip("warning",tl("Bad file format!")))},_getStatus:function(){e.Upgrader.getState().done(function(a){f._getStatusSuccess(a)}).fail(function(a){f._getStatusFails(a)})},_getStatusSuccess:function(a){switch(a.State){case"Invalid":f._upgradeFails("w_badFiletoReboot");break;case"Failed":case"NotEnoughMemory":case"Cancelled":f._upgradeFails("w_Upgradefailed");break;case"FileUnmatch":f._upgradeFails("w_FileUnmatch");break;default:f._upgrading(a.Progress)}},_getStatusFails:function(a){a.result===!1?(f.$(".u-tip").tip("warning",tl("Operateingfailure")),f.disabled(m,!1),j.css("visibility","hidden")):(k.css("width","251px"),l.text(tl("w_Rebooting...")),window.setTimeout(f._locationToIndex,2e4))},_upgradeFails:function(a){f.disabled(m,!1),j.css("visibility","hidden"),webApp.reboot(a,!0)},_upgrading:function(a){10>a&&(a=10),k.css("width",251*a/100+"px"),100==a?(l.text(tl("w_Rebooting...")),window.setTimeout(f._locationToIndex,2e4)):window.setTimeout(f._getStatus,1e3)},_locationToIndex:function(){a(window).unbind("unload"),a(window).unbind("beforeunload"),plugin.Reload()}}),window.downSucceed=function(){f._getStatus()}})}(jQuery);