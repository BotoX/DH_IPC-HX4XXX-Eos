!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("broad",function(require,b,c){var d=require("jsCore/rpc"),e=require("jsCore/pageBase"),f=require("common/common"),g=require("jsCore/plugin"),h=null,i=null,j=null,k=null,l=null,m={},n={},o=!1;c.exports=e.extend({init:function(){h=this,i=h.$("[sel-for=onChangeES]"),j=h.$("#broad_MainPort"),ability.is("ExtraConflict").done(function(a){if(webApp.MaxExtraStream<2)i.hide();else{i.show(),i.empty();for(var b=a?1:webApp.MaxExtraStream,c=0;b>c;c++)i.append('<option value="'+c+'" t="w_SecondStream'+(c+1)+'"></option>');i.translation()}});var a=h.$("#broad_ES_Div");webApp.MaxExtraStream<1?a.hide():a.show(),h.$("#broad_MainPort,#broad_ExtraPort").numberfield({max:65534,min:1025,allowDecimal:!1,allowNegative:!1}),k=h.$("#broad_MainIP").ipfield({type:"ipBroad"}),l=h.$("#broad_ExtraIP").ipfield({type:"ipBroad"}),h.render()},render:function(){d.ConfigManager.getConfig(["Multicast","DVRIP"]).done(function(b){m=b[0].params.table,n=a.extend(!0,{},m),DVRIP=b[1].params.table,modeExtr=1,h._renderElements()})},_renderElements:function(a){webApp.MaxExtraStream>1&&(h.$("[sel-for=onChangeES]").get(0).selectedIndex=modeExtr-1),h.$("#broad_exEnable").prop("checked",m.RTP[modeExtr].Enable),h.$("#broad_ExtraPort").numberfield("value",m.RTP[modeExtr].Port),l.ipfield("value",m.RTP[modeExtr].MulticastAddr),a||(h.$("#broad_mainEnable").prop("checked",m.RTP[0].Enable),h.$("#broad_MainPort").numberfield("value",m.RTP[0].Port),k.ipfield("value",m.RTP[0].MulticastAddr))},onChangeES:function(){h._saveTempJson(),modeExtr=h.$("[sel-for=onChangeES]").get(0).selectedIndex+1,h._renderElements(!0)},_saveTempJson:function(){m.RTP[modeExtr].MulticastAddr=l.ipfield("value"),m.RTP[modeExtr].Port=h.$("#broad_ExtraPort").numberfield("value"),m.RTP[modeExtr].Enable=h.$("#broad_exEnable").is(":checked")},onDefault:function(){d.ConfigManager.getDefault("Multicast").done(function(a){m=a,h._renderElements(),h.tip("success","Defaultsuccess")}).fail(function(){h.tip("error","Defaultfailure")})},onRefresh:function(){d.ConfigManager.getConfig("Multicast").done(function(a){m=a,h._renderElements(),h.tip("success","Operateingsuccess")}).fail(function(){h.tip("error","Operateingfailure")})},onConfirm:function(){m.RTP[0].MulticastAddr=k.ipfield("value"),DVRIP.MCASTAddress=k.ipfield("value"),m.RTP[0].Port=h.$("#broad_MainPort").numberfield("value"),DVRIP.MCASTPort=h.$("#broad_MainPort").numberfield("value"),m.RTP[0].Enable=h.$("#broad_mainEnable").is(":checked"),h._saveTempJson();var a;a=webApp.MaxExtraStream<2?m.RTP.length-1:m.RTP.length,o=!1;for(var b=0;a>b;b++){if(!f.chkPort(m.RTP[b].Port))return void h.tip("warning","Tip.Port in use Saving failure");(m.RTP[b].MulticastAddr!=n.RTP[b].MulticastAddr||m.RTP[b].Port!=n.RTP[b].Port)&&(o=!0);for(var c=b;a>c;c++)if(b!=c&&m.RTP[b].Enable&&m.RTP[c].Enable&&m.RTP[b].MulticastAddr==m.RTP[c].MulticastAddr&&m.RTP[b].Port==m.RTP[c].Port)return void h.tip("warning","w_Multicast port conflict")}d.ConfigManager.setConfig(["Multicast","DVRIP"],[m,DVRIP]).done(function(a){f.chkMutilCallRet(a)?(h.tip("success","Succeed in saving configure"),o&&setTimeout(function(){g.Reload()},3e3)):h.tip("error","Saving failure")})}})})}(jQuery);