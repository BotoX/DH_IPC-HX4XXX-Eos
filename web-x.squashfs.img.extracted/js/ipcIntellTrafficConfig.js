!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("traffic_scene",function(require,b,c){function d(a){for(var b=0;b<t.Lanes.length;b++)if(t.Lanes[b].Number===a)return b}function e(a,b){return a-b}function f(b){l.hide(),K=!0,a.alert(b,function(){K=!1,l.cover("#traffic_video")})}var g=require("jsCore/rpc"),h=require("jsCore/pageBase"),i=require("jsCore/modules/eventHandler"),j=require("common/common"),k=require("jsCore/rpcLogin"),l=require("jsCore/plugin"),m=require("jsCore/modules/timeSection"),n=require("jsCore/ability"),o=require("jsCore/modules/IntellMutex");require("jsCore/modules/ptzSetControl");var p,q,r,s,t,u,v,w=[tl("None"),tl("w_chuan"),tl("w_e"),tl("w_gans"),tl("w_ganz"),tl("w_gang"),tl("w_guiz"),tl("w_guil"),tl("w_hei"),tl("w_hu"),tl("w_jil"),tl("w_ji"),tl("w_tjin"),tl("w_jin"),tl("w_jing"),tl("w_liao"),tl("w_lu"),tl("w_meng"),tl("w_min"),tl("w_ning"),tl("w_qing"),tl("w_qiong"),tl("w_shan"),tl("w_su"),tl("w_wan"),tl("w_xiang"),tl("w_xin"),tl("w_yu"),tl("w_lyu"),tl("w_yue"),tl("w_yun"),tl("w_zang"),tl("w_zhe")],x=null,y=null,z=0,A=0,B=null,C="Gate",z=0,D=null,E=null,F=4,G=0,H=0,I=!1,J=!1;c.exports=h.extend({init:function(){if(x=this,x.eventHandler=new i("#tr_sc_eHandler",{RecordEnable:!1,RecordLatch:!1,MailEnable:!1,PtzLinkEnable:!1,SnapshotEnable:!(webApp.DeviceType.indexOf("SD")>-1)}),x.intellMutex=new o("ipcTraffic_mutex"),a.each(w,function(a,b){x.$("#tr_sc_local").append("<option value="+b+">"+b+"</option>")}),webApp.IsSDIntel?(x.$("#trasdPtzWrap").ptzSetControl(),x.$("#trasdPtzWrap").css("min-width","282px")):x.$("[data-cmd=setPreset]").parent().parent().remove(),x.$("#tr_sc_table").table({pageable:!1,height:140,columns:[{title:tl("w_lane"),width:"15%",render:function(a){return a._index+1}},{width:"25%",render:function(a){return tl("w_lane")+a.Number}},{action:"draw",icon:"i-draw",handle:function(a){var b=tl("w_lane")+a.Number;return l.SetCurShape(b),l.DeleteShape(b),l.AddShape(0,"TrafficLane",tl("w_lane")+"@"+a.Number,0,0),t.Lanes.splice(d(a.Number),1,{Number:a.Number}),!1},width:"50%"},{action:"delete",icon:"i-clear",handle:function(b){var c=this;return l.hide(),a.confirm(tl("Ok"),tl("w_sureDelLane"),function(){l.cover("#traffic_video"),l.DeleteShape(tl("w_lane")+b.Number),v.splice(d(b.Number),1),c.del(b)},function(){l.cover("#traffic_video")}),!1},titleIcon:"i-add",titleAction:function(b){return a(b.target).hasClass("disabled")?void 0:x._onDrawLane()},width:"10%"}],onRowSelect:function(a,b){return y=b.rowIndex,l.SetCurShape(tl("w_lane")+b.data.Number),!1}}),x._getTmp(),n.get("IVSCaps").done(function(a){H=a.MaxRules||10;var b=o.getIntellMutexTip("Traffic",a||{});b&&(x.intellMutex.add("intell",b),x.intellMutex.setCtrl("intell",!0)),x.intellMutex.add("tvout",'<span t="IntellMutexTVOut">'+tl("IntellMutexTVOut")+"</span>"),x.render()}),webCaps.is_new_IVSUI||x.$("#tr_sc_enable").click(function(){this.checked?x.intellMutex.show():x.intellMutex.hide()}),isEnable("is_show_plate")&&(x.$("#tr_vehicle_wrap").show(),x.$("#tr_flowStat_wrap").show()),webApp.DeviceType.indexOf("SD")>-1&&(x.$("#tr_vehicle_wrap").show(),x.$("#traffic_presets_wrap").show()),isEnable("is_numberOK_Gate")){x.$("[btn-for=onDrawLine]").parent().hide(),x.$("[btn-for=onShowTraSize]").parent().hide(),x.$("#tr_sc_table").hide(),x.$("#tr_sc_local").parent().hide().next().hide().prev().prev().hide(),a("[data-for=traffic_osd]").hide();var b="ANPR";a("[data-for=traffic_scene]").attr("t",b).text(b).translation()}},render:function(){I=!1,x.intellMutex.hide(),x.intellMutex.setCtrl("tvout",g_videoInConflict.DSP.hasConflict()),l.cover("#traffic_video",function(a){l.SetRegionNum(0),l.SetModuleMode(2),k.chkAuthority("Monitor_01")&&l.open(),a&&x.onRefresh()}),l.addEvent("OutPutStringInfo",function(a,b){b=JSON.parse(b),"OutPutRuleRect"===a?x._onRegionChange(b):"OutPutGlobalLaneInfo"===a&&x._onLaneChange(b)}),x._getConfig(!1)},leave:function(){l.hide(),l.addEvent("OutPutStringInfo",null),l.SetIVSConfig("",0),l.DeleteShape("DFilter")},_getConfig:function(a){g.ConfigManager.getConfig(["VideoAnalyseGlobal","VideoAnalyseModule","VideoAnalyseRule","TrafficFlowStat"]).done(function(b){p=b[0].params.table,q=b[1].params.table,r=b[2].params.table,s=b[3].result&&b[3].params.table,webCaps.is_new_IVSUI?(x._getNewConfig(a),a&&x.$("#tr_sc_tip").tip("success",tl("Operateingsuccess"))):(x._getOldConfig(),a&&x.$("#tr_sc_tip").tip("success",tl("Operateingsuccess")))}).fail(function(){x.$("#tr_sc_tip").tip("error",tl("Operateingfailure"))})},_getNewConfig:function(b){x._getTmp(),B={};var c=x.$("[sel-for = onChangePreset]").empty();webApp.DeviceType.indexOf("IPC")>-1?(B[0]="Scene",c.append("<option value = 0>0</option>"),c.val(z).change()):a.when(g.PTZ.getPresets(),g.ConfigManager.getConfig("PtzMovement")).done(function(d,f){"Preset"==f[A].Function&&(z=f[A].Index+1);var g=d||[],h={},i=[];a.each(g,function(a,b){h[b.Index]=b.Name}),a.each(p[A],function(b,c){b.indexOf("Scene")>-1&&("Gate"==c.Type||c.TypeList&&a.inArray("Gate",c.TypeList)>-1)&&(i.push(c.PtzPresetId),B[c.PtzPresetId]=b,i=i.sort(e))});for(var j=0;j<i.length;j++)c.append("<option value = "+i[j]+' class = "fn-color-ivsGreen">'+h[i[j]]+"</option>"),c.addClass("fn-color-ivsGreen");if(i.length<1)c.removeClass("fn-color-ivsGreen"),c.append("<option value = -1>"+tl("addPlanFirst")+"</option>"),x.$("[data-action=titleAction]").addClass("disabled"),x.disabled(x.$("[btn-for ^= onDraw],[btn-for ^= onClear]"),!0),z=-1,x.$("#tr_sc_table").table("dataSource",0),x.eventHandler.set(D.EventHandler),x.$("#tr_sc_enable").prop("checked",!1),x.$("#tr_sc_local").val(tl("w_zhe")),b&&x.$("#tr_sc_tip").tip("warning",tl("addPlanFirst"));else{x.$("[data-action=titleAction]").removeClass("disabled"),x.disabled(x.$("[btn-for ^= onDraw],[btn-for ^= onClear]"),!1);var k=z;a.inArray(z,i)<0&&(k=i[0]),c.val(k).change(),b&&x.$("#tr_sc_tip").tip("success",tl("Operateingsuccess"))}})},_getOldConfig:function(){for(var a=0;a<p.length;a++)if("Traffic"===p[a].Scene.Type)return t=p[a].Scene.Detail,u=q[a][0],v=r[a],void x._render()},_getTmp:function(){g.VideoInAnalyse.getTemplateRule("All",0).done(function(a){D=a[C].TrafficTollGate}).fail(function(){D={Type:"TrafficTollGate",Name:"TrafficTollGate",Enable:!1,ObjectTypes:["Vehicle","Plate"],PtzPresetId:0,Config:{LaneNumber:0,DetectLine:null,Direction:["Obverse","Reverse"],LastSnapPosition:100},EventHandler:{AlarmOutChannels:[0],AlarmOutEnable:!1,AlarmOutLatch:10,BeepEnable:!1,Dejitter:2,Delay:30,ExAlarmOutChannels:[0],ExAlarmOutEnable:!1,LogEnable:!1,MMSEnable:!1,MailEnable:!0,MatrixChannels:[0],MatrixEnable:!1,MessageEnable:!1,OnVideoMessageEnable:!1,PtzLink:[["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0]],PtzLinkEnable:!1,RecordChannels:[0],RecordEnable:!1,RecordLatch:10,SnapshotChannels:[0],SnapshotEnable:!0,SnapshotPeriod:0,SnapshotTimes:0,SnapshotTitleEnable:!0,TimeSection:[["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"]],TourChannels:[0],TourEnable:!1,TourSplit:"Split1",VoiceEnable:!1}}}),g.VideoInAnalyse.getTemplateModule("Gate").done(function(a){E=a.Gate})},_render:function(){var b={params:{table:[[{Scene:{Detail:{Lanes:t.Lanes,Type:t.Type}}}]]},TrafficLane:!0};isEnable("is_numberOK_Gate")?l.SetIVSConfig("",0):l.SetIVSConfig(JSON.stringify(b),0),l.SetCurPtzID(0);var c=u.DetectRegion,d={RuleRect:[[c[0][0],c[0][1]],[c[2][0],c[2][1]]]};l.SetObjectConfig(JSON.stringify(d)),x.$("#tr_sc_table").table("dataSource",t.Lanes).table("selectRow",t.Lanes.length-1),v[0]?(x.eventHandler.set(v[0].EventHandler),x.$("#tr_sc_enable").prop("checked",v[0].Enable)):(x.eventHandler.set(D.EventHandler),x.$("#tr_sc_enable").prop("checked",!1)),x.$("#tr_sc_vehicle").prop("checked","all"===t.ReportMode),x.$("#tr_sc_local").val(a.isArray(t.PlateHints)&&t.PlateHints.length>0?t.PlateHints[0]:tl("w_zhe")),s&&x.$("#tr_sc_flowStat").prop("checked",s.Config[0].Enable)},onShowTraSize:function(){if(u.SizeFilter){var a=u.SizeFilter,b=(a.MaxSize[0]/2).toInt(),c=(a.MinSize[0]/2).toInt(),d=(a.MaxSize[1]/2).toInt(),e=(a.MinSize[1]/2).toInt(),f=4095.5.toInt(),g=[f-b,f-c,f+b,f+c,f-d,f-e,f+d,f+e],h={DFilter:[[g[0],g[1]],[g[2],g[3]],[g[4],g[5]],[g[6],g[7]]]};I?(l.DeleteShape("DFilter"),I=!1):(l.SetObjectConfig(JSON.stringify(h)),l.SetCurShape("DFilter"),I=!0)}},onChangePreset:function(b){G=r[A].length,z=a(b.target).val()-0;var c=B[z];t=p[A][c].Detail,!t.Lanes&&(t.Lanes=[]),v=[],a.each(r[A],function(a,b){b.Class==C&&b.PtzPresetId==z&&(v.push(b),G--)}),a.each(q[A],function(a,b){b.Type==C&&b.PtzPresetId==z&&(u=b)}),g.PTZ.gotoPreset(z).always(function(){x._render()})},onDrawRegion:function(){return u.DetectRegion?l.SetCurShape("RuleRect"):(l.SetCurShape("save"),l.AddShape(6,"","RuleRect",0,0)),!1},onClearRegion:function(){return u.DetectRegion&&(l.DeleteShape("RuleRect"),u.DetectRegion=null),!1},_onRegionChange:function(a){var b=a.OutPutRuleRect;u.DetectRegion=[[b[0][0],b[0][1]],[b[0][0],b[1][1]],[b[1][0],b[1][1]],[b[1][0],b[0][1]]]},onDrawLine:function(){return 0!==t.Lanes.length&&t.Lanes[y].LeftLine?(l.AddShape(0,"TrafficLane",tl("w_lane")+t.Lanes[y].Number+"_line",-1,0),!1):f(tl("w_drawLaneFirst"))},onClearLine:function(){return 0!==t.Lanes.length&&t.Lanes[y].DetectLine?(l.DeleteShape(tl("w_lane")+y+"_line"),t.Lanes[y].DetectLine=null,!1):!1},_onDrawLane:function(){if(t.Lanes.length>=F)return!!x.$("#tr_sc_tip").tip("warning",tl("w_laneNumMax"));if(webCaps.is_new_IVSUI&&G+v.length>=H)return!!x.$("#tr_sc_tip").tip("warning",tl("w_laneNumMax"));var b=0;a.each(t.Lanes,function(a,c){return b!==c.Number?!1:void b++});var c={Number:b};x.$("#tr_sc_table").table("add",c,b).table("selectRow",b),l.AddShape(0,"TrafficLane",tl("w_lane")+"@"+b,0,0),D.Enable=x.$("#tr_sc_enable").prop("checked"),D.Name="TrafficTollGate"+b,D.Config.LaneNumber=b,D.PtzPresetId=z;({Type:"TrafficTollGate",Name:"TrafficTollGate"+b,Enable:x.$("#tr_sc_enable").prop("checked"),ObjectTypes:["Vehicle","Plate"],PtzPresetId:0,Config:{LaneNumber:b,DetectLine:null,Direction:["Obverse","Reverse"],LastSnapPosition:100},EventHandler:{AlarmOutChannels:[0],AlarmOutEnable:!1,AlarmOutLatch:10,BeepEnable:!1,Dejitter:2,Delay:30,ExAlarmOutChannels:[0],ExAlarmOutEnable:!1,LogEnable:!1,MMSEnable:!1,MailEnable:!0,MatrixChannels:[0],MatrixEnable:!1,MessageEnable:!1,OnVideoMessageEnable:!1,PtzLink:[["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0]],PtzLinkEnable:!1,RecordChannels:[0],RecordEnable:!1,RecordLatch:10,SnapshotChannels:[0],SnapshotEnable:!0,SnapshotPeriod:0,SnapshotTimes:0,SnapshotTitleEnable:!0,TimeSection:[["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"]],TourChannels:[0],TourEnable:!1,TourSplit:"Split1",VoiceEnable:!1}});return v.splice(b,0,a.extend(!0,{},D)),!1},_onLaneChange:function(b){a.each(t.Lanes,function(a,c){return c.Number===b[0].config.Lanes[0].Number?(t.Lanes.splice(a,1,b[0].config.Lanes[0]),v[a].Config.DetectLine=b[0].config.Lanes[0].DetectLine,!1):void 0})},onSetPeriod:function(){return v[0].EventHandler&&v[0].EventHandler.TimeSection&&(l.hide(),m.open(v[0].EventHandler.TimeSection).done(function(a){v[0].EventHandler.TimeSection=a}).always(function(){l.cover("#traffic_video")})),!1},onRefresh:function(){return x._getConfig(!0),!1},onDefault:function(){return-1==z?void x.$("#tr_sc_tip").tip("warning",tl("addPlanFirst")):(g.ConfigManager.getDefault(["VideoAnalyseGlobal","VideoAnalyseModule","VideoAnalyseRule","TrafficFlowStat"]).done(function(b){if(s=b[3].result&&b[3].params.table,webCaps.is_new_IVSUI){a.each(q[A],function(a,b){"Gate"==b.Type&&b.PtzPresetId===z&&(b.DetectRegion=E.DetectRegion,b.Category=E.Category,b.SizeFilter=E.SizeFilter)});for(var c=0;c<r[A].length;c++)r[A][c].Class==C&&r[A][c].PtzPresetId===z&&r[A].splice(c--,1);isEnable("is_numberOK_Gate")?r[A].push(a.extend(!0,{},D)):a.each(p[A],function(b,c){b.indexOf("Scene")>-1&&("Gate"==c.Type||c.TypeList&&a.inArray("Gate",c.TypeList)>-1)&&c.PtzPresetId===z&&(c.Detail.Lanes=[],c.Detail.PlateHints=[])}),J=!0,x._getNewConfig()}else q=b[1].params.table,p=b[0].params.table,r=b[2].params.table,x._getOldConfig();x.$("#tr_sc_tip").tip("success",tl("Operateingsuccess"))}).fail(function(){x.$("#tr_sc_tip").tip("error",tl("Defaultfailure"))}),!1)},onSave:function(){if(-1==z)return void x.$("#tr_sc_tip").tip("warning",tl("addPlanFirst"));if(!u.DetectRegion)return x.$("#tr_sc_tip").tip("warning",tl("w_regionNull"));var b=t.Lanes.length;if((!webCaps.is_new_IVSUI||webCaps.is_new_IVSUI&&!J)&&0===b)return x.$("#tr_sc_tip").tip("warning",tl("w_drawLane"));J=!1;for(var c=0;b>c;c++){if(!t.Lanes[c].LeftLine)return x.$("#tr_sc_tip").tip("warning",tl("w_drawLane")+t.Lanes[c].Number+"!");if(!t.Lanes[c].DetectLine)return x.$("#tr_sc_tip").tip("warning",tl("w_drawDetectLine")+t.Lanes[c].Number+"!")}a.each(v,function(a,b){b.Enable=x.$("#tr_sc_enable").prop("checked"),b.EventHandler=x.eventHandler.get()}),t.ReportMode=x.$("#tr_sc_vehicle").prop("checked")?"all":"plate",webApp.DeviceType.indexOf("IPC")<0&&(u.Category=x.$("#tr_sc_vehicle").prop("checked")?["Non-Motor","UnlicensedMotor"]:["Motor","UnlicensedMotor"]),x.$("#tr_sc_local").val()===tl("None")?delete t.PlateHints:t.PlateHints=[x.$("#tr_sc_local").val()],webCaps.is_new_IVSUI||g.ConfigManager.getConfig("TrafficSnapshot.Detector").done(function(b){a.each(b,function(a,b){b.Enable=!1}),a.each(t.Lanes,function(a,c){b[c.Number].Enable=!0}),g.ConfigManager.setConfig("TrafficSnapshot.Detector",b)}),x._filterConfig();var d=["VideoAnalyseGlobal","VideoAnalyseModule","VideoAnalyseRule"],e=[p,q,r];return s&&(s.Config[0].Enable=x.$("#tr_sc_flowStat").prop("checked"),d.push("TrafficFlowStat"),e.push(s)),g.ConfigManager.setConfig(d,e).done(function(a){j.chkMutilCallRet(a)?x.$("#tr_sc_tip").tip("success",tl("Succeed in saving configure")):x.$("#tr_sc_tip").tip("error",tl("Saving failure"))}),!1},_filterConfig:function(){if(a.each(t.Lanes,function(a,b){delete b.__id,delete b._index}),webCaps.is_new_IVSUI){for(var b=r[A],c=0;c<b.length;c++)b[c].Class==C&&b[c].PtzPresetId==z&&(b.splice(c,1),c--);a.merge(r[A],v)}},savePreset:function(){var a=x.$("[sel-for = onChangePreset]").val()-0,b=x.$("[sel-for = onChangePreset] option:selected").text();g.PTZ.setPreset(a,b).done(function(){x.$("#tr_sc_tip").tip("success",tl("Operateingsuccess"))}).fail(function(){x.$("#tr_sc_tip").tip("error",tl("Operateingfailure"))})}});var K=!1}),define("traffic_osd",function(require,b,c){var d=require("jsCore/rpc"),e=require("jsCore/pageBase"),f=null,g={"%09":"osd_num","%y%M%d%h%m%s":"osd_time","%12":"osd_color","%61":"osd_type","%46":"osd_logo","%58":"osd_plate","%86":"osd_preset"},h={osd_num:"%09",osd_time:"%y%M%d%h%m%s",osd_color:"%12",osd_type:"%61",osd_logo:"%46",osd_plate:"%58",osd_preset:"%86"},i=0,j=0,k="TrafficSnapshot",l=null;c.exports=e.extend({init:function(){f=this,f.$(":checkbox[name^=osd]").click(function(){var b=a(this);b.prop("checked")?f._addItem(b.attr("name")):f._delItem(b.attr("name"))}),f.$(".traffic_OSD_move").each(function(a,b){f[b.id]=new Drag.Move(b.id,{droppables:".traffic_OSD_item",limit:{x:[10,380],y:[10,10]},onStart:function(){this.element.addClass("traffic_OSD_moving")},onDrop:function(a,b){b&&b.hasClass("enable")&&b.getProperty("item-num")!=a.getProperty("move-num")&&b.addClass("moveTag")},onComplete:function(){{var a=f.$(".moveTag"),b=f.$("#"+this.element.id),c=f.$(".traffic_OSD_item[item-num="+b.attr("move-num")+"]");f.$(".traffic_OSD_move[move-num="+a.attr("item-num")+"]")}if(a.length){var d=a.attr("item-num"),e=a.position().left,g=f.$(".traffic_OSD_item.enable").length;if(b.attr("move-num")>a.attr("item-num"))for(var h=g-1;h>=d;h--)h>=b.attr("move-num")||f.$(".traffic_OSD_move[move-num="+h+"]")&&f.$(".traffic_OSD_move[move-num="+h+"]").css("left",e+10+74*(h-d+1)).attr("move-num",h+1);else for(var h=0;d>=h;h++)h<=b.attr("move-num")||f.$(".traffic_OSD_move[move-num="+h+"]")&&f.$(".traffic_OSD_move[move-num="+h+"]").css("left",e+10+74*(h-d-1)).attr("move-num",h-1);b.css("left",a.position().left+10).attr("move-num",a.attr("item-num")),a.removeClass("moveTag")}else b.css("left",c.position().left+10);b.removeClass("traffic_OSD_moving")}})}),isEnable("is_show_plate")&&(f.$("#osd_time_wrap").hide(),f.$("#osd_logo_wrap").show(),f.$("#osd_plate_wrap").show()),webApp.DeviceType.indexOf("SD")>-1&&(k="TrafficSnapshotNew",f.$("#osd_time_wrap").hide(),f.$("#osd_logo_wrap").show(),f.$("#osd_plate_wrap").show(),f.$("#osd_preset_wrap").show()),f.render()},destory:function(){f.$(".traffic_OSD_move").each(function(a,b){delete f[b.id]})},render:function(){plugin.cover("#traffic_osd_video",function(a){plugin.SetRegionNum(0),plugin.SetModuleMode(2),login.chkAuthority("Monitor_01")&&plugin.open(),a&&f.onRefresh()}),f._getConfig(!1)},leave:function(){plugin.hide()},onRefresh:function(){return f._getConfig(!0),!1},onDefault:function(){return d.ConfigManager.getDefault(k).done(function(a){l=a;var b=null;b="TrafficSnapshot"==k?l.OSD.OSDOrder:l[j].OSD.OSDOrder,f._render(b),f.$(".u-tip").tip("success",tl("Defaultsuccess"))}).fail(function(){f.disabled("[btn-for=onSave]"),f.$(".u-tip").tip("error",tl("Defaultfailure"))}),!1},onSave:function(){var b=[];return f.$(".traffic_OSD_move[move-num]").each(function(c,d){var e=a(d);b[e.attr("move-num")]=h[e.attr("id")]}),"TrafficSnapshot"==k?l.OSD.OSDOrder=b.join(""):l[j].OSD.OSDOrder=b.join(""),d.ConfigManager.setConfig(k,l).done(function(){f.$(".u-tip").tip("success",tl("Succeed in saving configure"))}).fail(function(){f.$(".u-tip").tip("error",tl("Saving failure"))}),!1},_getConfig:function(a){d.ConfigManager.getConfig(k).done(function(b){l=b;var c=null;c="TrafficSnapshot"==k?l.OSD.OSDOrder:l[j].OSD.OSDOrder,f._render(c),a&&f.$(".u-tip").tip("success",tl("Operateingsuccess"))}).fail(function(){f.disabled("[btn-for=onSave]"),f.$(".u-tip").tip("error",tl("Operateingfailure"))})},_addItem:function(a){var b=f.$(".traffic_OSD_item:not(.enable):first").addClass("enable").position();f.$("#"+a).attr("move-num",i).show().css("left",b.left+10),i++},_delItem:function(b){var c=f.$("#"+b).hide();f.$(".traffic_OSD_item.enable:last").removeClass("enable"),c.siblings("[move-num]").each(function(b,d){a(d).attr("move-num")>c.attr("move-num")&&a(d).css("left",function(a,b){return parseInt(b)-74}).attr("move-num",function(a,b){return b-1})}),i--,c.removeAttr("move-num","")},_render:function(b){i=0,f.$(".traffic_OSD_move").removeAttr("move-num").hide(),f.$(".traffic_OSD_item").removeClass("enable"),f.$(":checkbox[name]").prop("checked",!1);var c=[];a.each(h,function(a,d){var e=b.indexOf(d);e>-1&&(c[e]=d)}),a.each(c,function(a,b){f.$(":checkbox[name="+g[b]+"]").click()})}})})}(jQuery);