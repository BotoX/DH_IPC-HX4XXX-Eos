!function(a){define(function(require,b,c){function d(){function a(){n.Alarm.getOutState().done(function(a){for(var b=0;b<webApp.ALARM_OUT_NUMBER;b++)a&1<<b?s.$("[data-index="+b+"]").addClass("current"):s.$("[data-index="+b+"]").removeClass("current")})}q.chkAuthority("Alarm")&&webApp.ALARM_OUT_NUMBER&&(L=setInterval((a(),a),5e3))}function e(){clearInterval(L),L=null}function f(){g(),"Original Rate"===webApp.DisplayMode&&setTimeout(g,100)}function g(){var b=10,c=Math.max(document.documentElement.clientWidth-45),d=s.$(".main-right-container").width()||-10,e=s.$(".main-bottom").width()||c,f=s.$(".main-right-container").parent(),g=s.$(".main-bottom-container").height()||-4,h=e-b-d,i=Math.max(document.documentElement.clientHeight-56-54-33,390),j=Math.max(document.documentElement.clientHeight-56-54-33-g,390-g),k=webApp.DisplayMode;switch(w.videoBar("hasItem","video_triggerTrack")&&"Original Rate"==webApp.DisplayMode&&(k="adapted window"),w.videoBar("hasItem","video_fisheye")&&"Original Rate"==webApp.DisplayMode&&(k="adapted window"),k){case"Original Size":Video.resolution.x&&Video.resolution.y&&("nacl"!==o.type||h>=Video.resolution.x)&&(h=Video.resolution.x,i=Video.resolution.y),f.css({width:h+b+d,margin:"0 auto"});break;case"Original Rate":h=e-b-d,h/Video.rate<i?i=h/Video.rate:h=i*Video.rate,f.css({width:h+b+d,margin:"0 auto"});break;default:f.css({width:e,margin:"0"})}return-1!==webApp.DeviceType.indexOf("TPC")&&-1!==webApp.DeviceType.indexOf("-T")&&(i=j),v.css({width:h,height:i,background:"inherit"}),-1!==webApp.DeviceType.indexOf("TPC")&&y&&y.temperReport("resize"),w.css("width",h),a(".main-bottom-container").css("width",h),M||o.cover(v),!1}function h(){n.ConfigManager.getConfig(["Encode","EncodeEncrypt"]).done(function(a){var b=a[0].params.table[0].MainFormat[0].Video,c=a[1].result&&a[1].params.table[0][0];return"SVAC"===b.Compression&&(c.EncryptEnable&&o.SetDecodeKey(c.Key),b.SVCTLayer-1)?(w.videoBar("hideItem","video_svac",!1),void o.ChooseFrame(w.videoBar("isCurrent","video_svac",1)?1:0)):(w.videoBar("hideItem","video_svac",!0),void o.ChooseFrame(0))})}function i(a,b){o.SetVisibleVideoWnd(b,0),webApp.CHANNEL_NUMBER>1?(q.chkAuthority("Monitor_01")&&q.chkAuthority("Monitor_02")&&o.open(a,0,2),!q.chkAuthority("Monitor_01")&&q.chkAuthority("Monitor_02")&&(o.open(a,1,1),o.SetVideoWndTip(0,tl("noVideoAuthoity"))),q.chkAuthority("Monitor_01")&&!q.chkAuthority("Monitor_02")&&(o.open(a,0,1),o.SetVideoWndTip(1,tl("noVideoAuthoity"))),q.chkAuthority("Monitor_01")||q.chkAuthority("Monitor_02")||(o.SetVideoWndTip(0,tl("noVideoAuthoity")),o.SetVideoWndTip(1,tl("noVideoAuthoity")))):q.chkAuthority("Monitor_01")?o.open(a,0,1):o.SetVideoWndTip(0,tl("noVideoAuthoity"))}function j(){a.when(p.get("AudioInputCaps"),n.ConfigManager.getConfig("AudioInput")).done(function(a,b){var c=b[0].AudioSource;"LineIn"==c&&a.LineIn<2||"Mic"==c&&a.Mic<2?s.$("[btn-for=onVoice2]").hide():s.$("[btn-for=onVoice2]").show()})}function k(){webCaps.Anonymous||(F=(F+1)%65536,n.PTZ.attachStatusProc(u,F).done(function(){common.devNotify.subscribe("client.notifyPtzStream",m),G=!0}))}function l(){G&&(webCaps.Anonymous||n.PTZ.detachStatusProc(u,F))}function m(a){var b=a.status;null!=b.PresetID&&b.PresetID>=1&&b.PresetStatus&&"Reach"==b.PresetStatus&&b.PresetID!==E&&(webApp.PresetID=b.PresetID,y.temperReport("render"))}var n=require("jsCore/rpc"),o=require("jsCore/plugin"),p=require("jsCore/ability"),q=(require("common/common").Cookie,require("jsCore/rpcLogin")),r=require("jsCore/pageBase");require("jsCore/modules/ptzControl"),require("jsCore/modules/ptzSetting"),require("jsCore/modules/zoomFocus"),require("jsCore/modules/videoBar"),require("jsCore/modules/imageAdjust"),require("jsCore/modules/triggerTrack"),require("jsCore/modules/fishEye"),require("jsCore/modules/zoomFocus"),-1==webApp.DeviceType.indexOf("TPC")&&require("jsCore/modules/fishEye"),-1!==webApp.DeviceType.indexOf("TPC")&&-1!==webApp.DeviceType.indexOf("-T")&&require("jsCore/modules/temperReport"),-1!==webApp.DeviceType.indexOf("TPC")&&-1!==webApp.DeviceType.indexOf("-T")&&require("jsCore/modules/curTemper"),-1!==webApp.DeviceType.indexOf("TPC")&&require("jsCore/modules/tpcLocalFocus"),-1!==webApp.DeviceType.indexOf("TPC")&&require("jsCore/modules/tpcTracker"),-1!==webApp.DeviceType.indexOf("TPC")&&require("jsCore/modules/ptzDistance");var s=null,t=".preview",u=0,v=null,w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=0,G=!1,H=!1,I=!1,J=!1,K=!1;c.exports=r.extend({init:function(){if(s=this,v=s.$(".main-video"),w=s.$(".ui-video-bar").videoBar(),I=-1!==webApp.DeviceType.indexOf("TPC")&&-1===webApp.DeviceType.indexOf("SD")&&webApp.CHANNEL_NUMBER>1,p.get("VideoInFocusMode").done(function(a){J=a&&a.Support&&-1!==webApp.DeviceType.indexOf("TPC-AEBF5X00"),K=I||J}),q.chkAuthority("MPTZ")&&webApp.HasPtz||K){if(-1!==webApp.DeviceType.indexOf("SD")||-1!==webApp.DeviceType.indexOf("TPC")||K){var b={ptzJoystick:!0,autoFocus:p.get("AutoFocusButton").done(function(a){return a&&a.Support||J}),isPtzLocate:-1!==webApp.DeviceType.indexOf("TPC")||-1!==webApp.DeviceType.indexOf("SD"),isLaserDistMeasure:!1,channel:o.windowId};K&&(b.ptzJoystick=!1,b.showDirction=!1,b.showStep=!1,b.showAdjust=!1,b.title=!0),x=s.$(".main-ptz-control").ptzControl(b)}-1!==webApp.DeviceType.indexOf("SD")&&w.videoBar("toggleCurrent","video_ptz"),K&&w.videoBar("toggleCurrent","video_adjust")}-1!==webApp.DeviceType.indexOf("TPC")&&(-1!==webApp.DeviceType.indexOf("-T")&&(y=s.$(".main-report-container").temperReport({presetReal:webApp.PresetID}),k(),z=s.$(".main-report-container").curTemper()),A=s.$(".main-report-container").tpcLocalFocus(),B=s.$(".main-report-container").tpcTracker()),C=s.$(".main-image-adjust").imageAdjust(),s.$(".main-zoom-focus").zoomFocus({type:"preview"}),s.$(".main-trigger-track").triggerTrack(),p.get("VideoInputCaps").done(function(a){a&&a.FishEye&&(s.$(".main-fisheye").fishEye({closeIVS:function(){w.videoBar("isCurrent","video_ivsRule",0)&&(o.SetIVSEnable(!1),w.videoBar("hideItem","video_ivsRule",!0))},openIVS:function(){w.videoBar("isCurrent","video_ivsRule",0)&&(o.SetIVSEnable(!0),w.videoBar("hideItem","video_ivsRule",!1))},pluginMode:function(){w.videoBar("hideItem","video_fisheye",!1),w.videoBar("isCurrent","video_fisheye")&&s.$(".main-fisheye").show(),s.$("#video_ivsRule").parent("div").show()},chipMode:function(){w.videoBar("hideItem","video_fisheye",!0),s.$(".main-fisheye").hide(),s.$("#video_ivsRule").parent("div").hide()}}),w.videoBar("toggleCurrent","video_fisheye"))}),a.when(p.get("MaxExtraStream"),p.is("ExtraConflict")).then(function(a,b){1==a?(s.$("[btn-for=onConnectExtra]").show(),s.$("[btn-for=onConnectExtra2]").remove()):2==a?(s.$("[btn-for=onConnectExtra]").attr("t","w_SecondStream1").text(tl("w_SecondStream1")).show(),!b&&s.$("[btn-for=onConnectExtra2]").show()):(s.$("[btn-for=onConnectExtra]").remove(),s.$("[btn-for=onConnectExtra2]").remove())}),webApp.GongAnDetect&&(s.$("[btn-for=onConnectExtra3]").show(),s.$("[btn-for=onConnectExtra4]").show()),p.is("DSPConflict").done(function(a){a&&w.videoBar("hideItem","video_ivsRule",!0)});var c=s.$("#pre_type").empty().append('<option value="0">TCP</option>').off("change").on("change",s.onTypeChange);o.CheckFuncSupport(0).done(function(a){a&&c.append('<option value="4">UDP</option>')}),o.CheckFuncSupport(1).done(function(a){a&&c.append('<option value="3" t="w_multicast"></option>').translation()}),""!==o.type&&s.$("a[btn-for=onConnectMain]").addClass("current last"),N.init(),h(),s._initButtons(),-1!==webApp.DeviceType.indexOf("TPC")&&(s.$("[sel-for=onChangeResolute]").remove(),s.$("[btn-for=onCutResolute]").remove(),p.get("IsLaserDistMeasure").always(function(a){H=a,H?(D=s.$(".main-ptz-distance").show().ptzDistance(),s.$(".main-ptz-distance").on("click","[btn-for=onRun]",function(){w.videoBar("isCurrent","video_rayright")&&w.videoBar("toggleCurrent","video_rayright"),w.videoBar("hideItem","video_rayright",!0),D.ptzDistance("onRun")}).on("click","[btn-for=onClose]",function(){w.videoBar("hideItem","video_rayright",!1),D.ptzDistance("onClose")})):s.$(".main-ptz-distance").remove()})),p.get("PtzDirectionCalibration").done(function(a){a&&a.Support&&s.$("#b_dirAdjust").removeClass("fn-hide")}),p.get("AudioTalkMode").done(function(a){isHalf=a&&a[0],isHalf&&"Half"===isHalf&&(s.$("[btn-for=onTalk]").unbind("click"),s.$("#speakbut").off("mousedown"),s.$("#speakbut").off("mouseup"),s.$("#speakbut").off("mouseout"),s.$("#speakbut").on({mousedown:function(){s.$("[btn-for=onTalk]").hasClass("current")||(o.SetTalkFromDeviceEnable(!1),o.controlTalking(s.$("[btn-for=onTalk]")).then(function(a){a&&(s.$("[btn-for=onVoice]").hasClass("current")&&(o.state("dualAudioEnable1",!1),s.$("[btn-for=onVoice]").addClass("stopVoice")),s.$("[btn-for=onTalk]").addClass("current"))}))},mouseup:function(){s.$("[btn-for=onTalk]").hasClass("current")&&o.controlTalking(s.$("[btn-for=onTalk]")).then(function(a){a&&(s.$("[btn-for=onTalk]").removeClass("current"),s.$("[btn-for=onVoice]").hasClass("stopVoice")&&window.setTimeout(function(){o.state("dualAudioEnable1",!0),s.$("[btn-for=onVoice]").removeClass("stopVoice")},500))})},mouseout:function(){s.$("[btn-for=onTalk]").hasClass("current")&&o.controlTalking(s.$("[btn-for=onTalk]")).then(function(a){a&&(s.$("[btn-for=onTalk]").removeClass("current"),s.$("[btn-for=onVoice]").hasClass("stopVoice")&&window.setTimeout(function(){o.state("dualAudioEnable1",!0),s.$("[btn-for=onVoice]").removeClass("stopVoice")},500))})}}))}),s.render()},_initButtons:function(){var b=s.$("#pre_alarm_wrap").empty().off("click").on("click",function(a){var b=s.$(a.target),c=b.data("index");n.ConfigManager.getConfig("AlarmOut").done(function(a){b.hasClass("current")?(b.removeClass("current"),1==a[c].Mode?(a[c].Mode=0,n.ConfigManager.setConfig("AlarmOut",a)):(a[c].Mode=1,n.ConfigManager.setConfig("AlarmOut",a).done(function(){a[c].Mode=0,n.ConfigManager.setConfig("AlarmOut",a)}))):(b.addClass("current"),a[c].Mode=1,n.ConfigManager.setConfig("AlarmOut",a))})});if(q.chkAuthority("Alarm")&&webApp.ALARM_OUT_NUMBER){if(1===webApp.ALARM_OUT_NUMBER)b.append('<a class="main-top-icon-alarm" href="javascript:;" data-index="0" hidefocus="true" t="title::w_Alarm Out"></a>');else for(var c=webApp.ALARM_OUT_NUMBER;c>0;c--)b.append('<a class="main-top-icon-alarm" href="javascript:;" data-index="'+(c-1)+'" hidefocus="true" t="title::w_Alarm Out+'+c+'"></a>');b.translation()}0===webApp.AUDIO_OUT_NUMBER?s.$("[btn-for=onTalk]").remove():s.$("[btn-for=onTalk]").show(),0===webApp.AUDIO_IN_NUMBER?s.$("[btn-for=onVoice],[btn-for=onVoice1],[btn-for=onVoice2]").remove():1===webApp.AUDIO_IN_NUMBER?(s.$("[btn-for=onVoice]").show(),s.$("[btn-for=onVoice1],[btn-for=onVoice2]").remove()):2===webApp.AUDIO_IN_NUMBER&&(s.$("[btn-for=onVoice1],[btn-for=onVoice2]").show(),s.$("[btn-for=onVoice]").remove()),p.get("VideoInputCaps").done(function(a){a&&a.AutofocusPeak?s.$("[btn-for=onSetAF]").show():s.$("[btn-for=onSetAF]").remove()}),p.get("IntelliTracker").done(function(a){a&&a.Support?s.$("[btn-for=onTrackObject]").show():s.$("[btn-for=onTrackObject]").remove()}),p.get("PTZCaps").done(function(a){a&&a.SupportRegionFocus&&-1!==webApp.DeviceType.indexOf("SD")&&-1===webApp.DeviceType.indexOf("TPC")?s.$("[btn-for=onRegionFocus]").show():s.$("[btn-for=onRegionFocus]").remove(),a&&a.SDMeasureDistance&&a.SDMeasureDistance.Support?s.$("[btn-for=onMeasureDistance]").show():s.$("[btn-for=onMeasureDistance]").remove()}),-1!==webApp.DeviceType.indexOf("TPC")&&a.when(p.get("LensControl"),p.get("PresetFocusROI"),p.get("IntelligentFocus")).then(function(a,b,c){a&&b&&c?s.$("[btn-for=onRegionFocus]").show():s.$("[btn-for=onRegionFocus]").remove()}),webApp.GongAnDetect?(s.$("[btn-for=onZoneExpose]").show(),s.$("[sel-for=onChangeResolute]").show().change(),s.$("[btn-for=onCutResolute]").show()):(s.$("[btn-for=onZoneExpose]").remove(),s.$("[sel-for=onChangeResolute]").remove(),s.$("[btn-for=onCutResolute]").remove()),-1!==webApp.DeviceType.indexOf("SD")&&isEnable("is_show_mousecontrolptz")?s.$("[btn-for=onFigure]").show():s.$("[btn-for=onFigure]").remove();var d=-1!==webApp.DeviceType.indexOf("SD")&&isEnable("is_show_duck");d?(s.$("#b_duck").show(),s.$("#b_duckdrawn").show()):(s.$("#b_duck").remove(),s.$("#b_duckdrawn").remove()),-1!==webApp.DeviceType.indexOf("TPC")?(s.$("[btn-for=onSnap]").remove(),s.$("[btn-for=onSnap3]").remove(),s.$("[btn-for=onRecord]").remove(),webApp.CHANNEL_NUMBER>1?(s.$("[btn-for=onFixedFocus]").show(),s.$("[btn-for=onRecordAll]").show()):(s.$("[btn-for=onFixedFocus]").remove(),s.$("[btn-for=onRecordAll]").remove())):(s.$("[btn-for=onFixedFocus]").remove(),s.$("[btn-for=onRecordAll]").remove())},render:function(){switch(a(window).off("resize"+t),a(window).on("resize"+t,f),f(),w.videoBar("render",{showImage:!0,showPtz:q.chkAuthority("MPTZ")&&webApp.HasPtz&&-1!==webApp.DeviceType.indexOf("SD"),showRayRight:-1!==webApp.DeviceType.indexOf("TPC"),showFishEye:!0,showTemperReport:-1!==webApp.DeviceType.indexOf("TPC")&&-1!==webApp.DeviceType.indexOf("-T"),showWhRate:-1===webApp.DeviceType.indexOf("TPC"),showZoomFocus:-1===webApp.DeviceType.indexOf("TPC"),showOriginal:-1===webApp.DeviceType.indexOf("TPC"),showFluency:-1===webApp.DeviceType.indexOf("TPC"),showFullScreeny:-1===webApp.DeviceType.indexOf("TPC"),ptzOn:function(){!K&&s.$(".main-ptz-setting").show().ptzSetting("render"),s.$(".main-ptz-control").show(),f()},ptzOff:function(){s.$(".main-ptz-setting").hide(),s.$(".main-ptz-control").hide(),f()},imageOn:function(){s.$(".main-image-adjust").show(),f()},imageOff:function(){s.$(".main-image-adjust").hide(),f()},modeChange:f,zoomOn:function(){s.$(".main-zoom-focus").zoomFocus("render").show(),f()},zoomOff:function(){s.$(".main-zoom-focus").zoomFocus("leave").hide(),f()},wideviewOn:function(a){N._loginWideView(),a.isTrigger?o.ShowWideView(!0):(N.config[0].Enable=!0,n.ConfigManager.setConfig("WideViewControl",N.config).done(function(){o.ShowWideView(!0)}))},wideviewOff:function(a){a.isTrigger?o.ShowWideView(!1):(N.config[0].Enable=!1,n.ConfigManager.setConfig("WideViewControl",N.config).done(function(){o.ShowWideView(!1)}))},trackOn:function(){o.state("partialEnlarged")&&o.state("partialEnlarged",!1),o.state("activeLocalFocus")&&o.state("activeLocalFocus",!1),s.$(".main-trigger-track").triggerTrack("render").show(),f()},trackOff:function(){s.$(".main-trigger-track").triggerTrack("leave").hide(),f()},trackMode:function(){return s.$(".main-trigger-track").triggerTrack("getScreenMode")},fishEyeOn:function(){o.state("partialEnlarged")&&o.state("partialEnlarged",!1),o.state("activeLocalFocus")&&o.state("activeLocalFocus",!1),s.$(".main-fisheye").fishEye("render").show(),f()},fishEyeOff:function(){s.$(".main-fisheye").fishEye("leave").hide(),f()},reportOn:function(){s.$(".main-report-container").show(),y.temperReport("render"),f()},reportOff:function(){s.$(".main-report-container").hide(),f()},adjustOn:function(){s.$(".main-ptz-control").show(),f()},adjustOff:function(){s.$(".main-ptz-control").hide(),f()}}),w.videoBar("isCurrent","video_ptz")||w.videoBar("isCurrent","video_adjust")?(!K&&s.$(".main-ptz-setting").show().ptzSetting("render"),s.$(".main-ptz-control").show()):(s.$(".main-ptz-setting").hide(),s.$(".main-ptz-control").hide()),w.videoBar("isCurrent","video_zoomFocus")?s.$(".main-zoom-focus").zoomFocus("render").show():s.$(".main-zoom-focus").zoomFocus("leave").hide(),w.videoBar("isCurrent","video_image")?s.$(".main-image-adjust").show():s.$(".main-image-adjust").hide(),w.videoBar("isCurrent","video_report")?(s.$(".main-report-container").show(),y.temperReport("render")):s.$(".main-report-container").hide(),webApp.DisplayMode){case"Adaptive Window":w.videoBar("toggleCurrent","video_whRate",1);break;case"Original Rate":w.videoBar("toggleCurrent","video_whRate",0);break;case"Original Size":w.videoBar("isCurrent","video_original")?f():w.videoBar("toggleCurrent","video_original")}w.videoBar("hasItem","video_triggerTrack")&&(w.videoBar("isCurrent","video_triggerTrack")?s.$(".main-trigger-track").triggerTrack("render").show():s.$(".main-trigger-track").triggerTrack("leave").hide()),o.cover(v,function(a){o.SetModuleMode(0);var b=s.$(a?"a[btn-for=onConnectMain]":"a.last[btn-for^=onConnect]");if(s.$("a[btn-for^=onConnect]").removeClass("current"),b.length||(b=s.$("a[btn-for=onConnectMain]")),b.click(),w.videoBar("isCurrent","video_ivsRule",0)?o.SetIVSEnable(!0):w.videoBar("hasItem","video_triggerTrack")&&(o.SetIVSEnable(!0),o.ShowRuleState(!1)),w.videoBar("hasItem","video_triggerTrack")&&"Original Rate"==webApp.DisplayMode){var c=0!=s.$(".main-trigger-track").triggerTrack("getScreenMode")?2:1;o.SetShowMode(c)}w.videoBar("hasItem","video_fisheye")&&(s.$(".main-fisheye").fishEye("render"),a&&w.videoBar("toggleCurrent","video_whRate",0)),p.is("OcxStabilization").done(function(a){a&&n.ConfigManager.getConfig("VideoInPreviewOptions").done(function(a){var b=a[0];3===b.SwitchMode?o.ControlVideoStable(!!b.DayOptions.ImageStabilizationEnable):5===b.SwitchMode?o.ControlVideoStable(!!b.NightOptions.ImageStabilizationEnable):0===b.SwitchMode?o.ControlVideoStable(!!b.NormalOptions.ImageStabilizationEnable):2===b.SwitchMode&&n.Global.getCurrentTime().done(function(a){var c=new Date(a),d=new Date(a);d.setHours(b.DayOptions.BeginHour,b.DayOptions.BeginMinute,b.DayOptions.BeginSecond);var e=new Date(a);e.setHours(b.DayOptions.EndHour,b.DayOptions.EndMinute,b.DayOptions.EndSecond),o.ControlVideoStable(c>d&&e>c?!!b.DayOptions.ImageStabilizationEnable:!!b.NightOptions.ImageStabilizationEnable)})})}),h()}),o.addEvent("ResolutionChangePreview",f),o.addEvent("StateChangedPreview",function(){f(),w.videoBar("isCurrent","video_ivsRule",0)&&o.SetIVSEnable(!0),w.videoBar("isCurrent","video_triggerTrack")&&s.$(".main-trigger-track").triggerTrack("render").show(),1!=o.stream?w.videoBar("hideItem","video_svac",!0):h(),w.videoBar("hasItem","video_fisheye")&&s.$(".main-fisheye").fishEye("render")}),o.addEvent("DeviceReconnectedPreview",function(){w.videoBar("isCurrent","video_ivsRule",0)&&o.SetIVSEnable(!0)}),d(),N.render(),-1!=webApp.DeviceType.indexOf("TPC")&&(q.chkAuthority("MPTZ")&&webApp.HasPtz&&x.ptzControl("changeChannel",o.windowId),o.addEvent("WndSwitch",function(a){o.state("setAFEnable")&&o.state("setAFEnable",!1),o.state("partialEnlarged")&&o.state("partialEnlarged",!1),o.state("activeLocalFocus")&&o.state("activeLocalFocus",!1),o.state("enableMousePtz")&&o.state("enableMousePtz",!1),o.state("activePTZLocate")&&o.state("activePTZLocate",!1),o.state("activeManualLocate")&&o.state("activeManualLocate",!1),o.windowId=a,w.videoBar("isCurrent","video_image")&&C.imageAdjust("render"),-1!=webApp.DeviceType.indexOf("-T")&&z.curTemper("render"),q.chkAuthority("MPTZ")&&webApp.HasPtz&&x.ptzControl("changeChannel",o.windowId),H&&D.ptzDistance("changeWin",o.windowId)}),o.addEvent("VideoAnalyzeConfig",function(a){var b=JSON.parse(a);o.state("activeLocalFocus")?A.tpcLocalFocus("render",b):o.state("activeManualLocate")?B.tpcTracker("render",b):z.curTemper("getTemper",b)}),-1!=webApp.DeviceType.indexOf("-T")&&z.curTemper("render")),2===webApp.AUDIO_IN_NUMBER&&j()},leave:function(){a(window).off("resize"+t),w.videoBar("isCurrent","video_zoomFocus")&&s.$(".main-zoom-focus").zoomFocus("leave").hide(),w.videoBar("hasItem","video_fisheye")&&s.$(".main-fisheye").fishEye("leave"),H&&D.ptzDistance("getStatus")&&(D.ptzDistance("leave"),w.videoBar("hideItem","video_rayright",!1)),o.state("recordVideo")||o.close(),s._clearOCXFunction(),o.SetIVSEnable(!1),o.hide(),o.addEvent("ResolutionChangePreview",null),o.addEvent("StateChangedPreview",null),o.addEvent("DeviceReconnectedPreview",null),e(),N.leave(),-1!=webApp.DeviceType.indexOf("TPC")&&(-1!=webApp.DeviceType.indexOf("-T")&&z.curTemper("leave"),o.addEvent("VideoAnalyzeConfig",null),o.addEvent("WndSwitch",function(a){o.windowId=a,H&&D.ptzDistance("changeWin",o.windowId)}))},destory:function(){a(window).off("resize"+t),s.$("a[btn-for^=onConnect]").removeClass("current"),w.videoBar("isCurrent","video_zoomFocus")&&s.$(".main-zoom-focus").zoomFocus("leave").hide(),w.videoBar("isCurrent","video_fisheye")&&s.$(".main-fisheye").fishEye("leave").hide(),w.videoBar("isCurrent","video_triggerTrack")&&s.$(".main-trigger-track").triggerTrack("leave").hide(),w.videoBar("destroy"),N.destory(),-1!=webApp.DeviceType.indexOf("TPC")&&-1!=webApp.DeviceType.indexOf("-T")&&(y.temperReport("destroy"),z.curTemper("destory"),l(),common.devNotify.detach("client.notifyPtzStream"))},_clearOCXFunction:function(){o.state("dualAudioEnable1")&&o.state("dualAudioEnable1",!1),o.state("dualAudioEnable14")&&o.state("dualAudioEnable14",!1),o.state("dualAudioEnable15")&&o.state("dualAudioEnable15",!1),o.state("setAFEnable")&&o.state("setAFEnable",!1),o.state("partialEnlarged")&&o.state("partialEnlarged",!1),o.state("recordAllVideo")&&o.state("recordAllVideo",!1),o.state("activeLocalFocus")&&o.state("activeLocalFocus",!1),o.state("activeZoneExpose")&&o.state("activeZoneExpose",!1),o.state("enableMousePtz")&&o.state("enableMousePtz",!1),o.state("activePTZLocate")&&o.state("activePTZLocate",!1),o.state("activeManualLocate")&&o.state("activeManualLocate",!1),o.state("activeMeasureDistance")&&o.state("activeMeasureDistance",!1),w.videoBar("isCurrent","video_fisheye")&&o.SetFeShowMode(0)},onConnectMain:function(){if(s._clearOCXFunction(),p.is("DSPConflict").done(function(a){w.videoBar("hideItem","video_ivsRule",!!a)}),w.videoBar("isCurrent","video_ivsRule",0)&&o.SetIVSEnable(!0),w.videoBar("isCurrent","video_fluency",0)&&o.SetDelayTime(5),w.videoBar("isCurrent","video_fluency",1)&&o.SetDelayTime(4),w.videoBar("isCurrent","video_fluency",2)&&o.SetDelayTime(1),s.$("[btn-for=onConnectMain]").hasClass("current"))o.close(!0).done(function(a){a&&s.$("[btn-for=onConnectMain]").removeClass("current")});else{if(-1!=webApp.DeviceType.indexOf("TPC"))return i(1,webApp.CHANNEL_NUMBER),s.$("[btn-for=onConnectMain],[btn-for=onConnectExtra],[btn-for=onConnectExtra2]").removeClass("current last"),void s.$("[btn-for=onConnectMain]").addClass("current last");o.open(1).done(function(a){s.$("[btn-for^=onConnect]").removeClass("current last"),a&&s.$("[btn-for=onConnectMain]").addClass("current last")})}},onConnectExtra:function(){if(s._clearOCXFunction(),w.videoBar("isCurrent","video_ivsRule",0)&&o.SetIVSEnable(!0),w.videoBar("isCurrent","video_fluency",0)&&o.SetDelayTime(5),w.videoBar("isCurrent","video_fluency",1)&&o.SetDelayTime(4),w.videoBar("isCurrent","video_fluency",2)&&o.SetDelayTime(1),n.ConfigManager.getConfig(["EncodeCrop"]).done(function(a){if(a[0].result){var b=a[0].params.table[0].Extra1.Enable;p.is("DSPConflict").done(function(a){w.videoBar("hideItem","video_ivsRule",!!a||b)})}}),s.$("[btn-for=onConnectExtra]").hasClass("current"))o.close(!0).done(function(a){a&&s.$("[btn-for=onConnectExtra]").removeClass("current")});else{if(-1!=webApp.DeviceType.indexOf("TPC"))return i(2,webApp.CHANNEL_NUMBER),s.$("[btn-for=onConnectMain],[btn-for=onConnectExtra],[btn-for=onConnectExtra2]").removeClass("current last"),void s.$("[btn-for=onConnectExtra]").addClass("current last");o.open(2).done(function(a){s.$("[btn-for^=onConnect]").removeClass("current last"),a&&s.$("[btn-for=onConnectExtra]").addClass("current last")})}},onConnectExtra2:function(){if(s._clearOCXFunction(),w.videoBar("isCurrent","video_ivsRule",0)&&o.SetIVSEnable(!0),w.videoBar("isCurrent","video_fluency",0)&&o.SetDelayTime(5),w.videoBar("isCurrent","video_fluency",1)&&o.SetDelayTime(4),w.videoBar("isCurrent","video_fluency",2)&&o.SetDelayTime(1),n.ConfigManager.getConfig(["EncodeCrop"]).done(function(a){if(a[0].result){var b=a[0].params.table[0].Extra2.Enable;p.is("DSPConflict").done(function(a){w.videoBar("hideItem","video_ivsRule",!!a||b)}),b&&o.SetIVSEnable(!1)}}),s.$("[btn-for=onConnectExtra2]").hasClass("current"))o.close(!0).done(function(a){a&&s.$("[btn-for=onConnectExtra2]").removeClass("current")});else{if(-1!=webApp.DeviceType.indexOf("TPC"))return i(3,webApp.CHANNEL_NUMBER),s.$("[btn-for=onConnectMain],[btn-for=onConnectExtra],[btn-for=onConnectExtra2]").removeClass("current last"),void s.$("[btn-for=onConnectExtra2]").addClass("current last");o.open(3).done(function(a){s.$("[btn-for^=onConnect]").removeClass("current last"),a&&s.$("[btn-for=onConnectExtra2]").addClass("current last")})}},onConnectExtra3:function(){s._clearOCXFunction(),s.$("[btn-for=onConnectExtra3]").hasClass("current")?o.close(!0).done(function(a){a&&s.$("[btn-for=onConnectExtra3]").removeClass("current")}):o.open(2).done(function(a){s.$("[btn-for^=onConnect]").removeClass("current last"),a&&s.$("[btn-for=onConnectExtra3]").addClass("current last")})},onConnectExtra4:function(){s._clearOCXFunction(),s.$("[btn-for=onConnectExtra4]").hasClass("current")?o.close(!0).done(function(a){a&&s.$("[btn-for=onConnectExtra4]").removeClass("current")}):o.open(3).done(function(a){s.$("[btn-for^=onConnect]").removeClass("current last"),a&&s.$("[btn-for=onConnectExtra4]").addClass("current last")})},onTypeChange:function(){var b=q.getLoginInfo().logintype,c=s.$("#pre_type").val()-0;"ActiveDirectory"===b&&(c=13),"LDAP"===b&&(c=12);var d,e=s.$("[btn-for^=onConnect]");a.each(e,function(b,c){a(c).hasClass("current")&&(d=arguments[0])}),s.$("[btn-for^=onConnect]").removeClass("current"),s._clearOCXFunction(),o.state("recordVideo")&&o.state("recordVideo",!1),o.state("controlTalking")&&o.state("controlTalking",!1),o.setSocketType(c).done(function(){1===o.stream?s.onConnectMain():2===o.stream&&3===d?s.onConnectExtra3():2===o.stream?s.onConnectExtra():3===o.stream&&4===d?s.onConnectExtra4():3===o.stream&&s.onConnectExtra2()})},onSnap:function(){o.CatchPicture(6,"LiveSnapshot")},onSnap3:function(){o.CatchPictures(1,"LiveSnapshot")},onTalk:function(){o.controlTalking(s.$("[btn-for=onTalk]"))},onVoice:function(){o.dualAudioEnable(s.$("[btn-for=onVoice]"))},onVoice1:function(){o.dualAudioEnable(s.$("[btn-for=onVoice1]"))},onVoice2:function(){o.dualAudioEnable(s.$("[btn-for=onVoice2]"))},onSetAF:function(){!(-1!==webApp.DeviceType.indexOf("TPC")&&webApp.CHANNEL_NUMBER>1&&0===o.windowId)&&o.setAFEnable(s.$("[btn-for=onSetAF]"))},onRecord:function(){o.recordVideo(s.$("[btn-for=onRecord]"))},onRecordAll:function(){o.recordAllVideo(s.$("[btn-for=onRecordAll]"))},onTrackObject:function(){o.activeManualLocate(s.$("[btn-for=onTrackObject]"))},onEnlarged:function(){!o.state("partialEnlarged")&&w.videoBar("isCurrent","video_triggerTrack")&&w.videoBar("toggleCurrent","video_triggerTrack"),o.partialEnlarged(s.$("[btn-for=onEnlarged]")).done(function(){o.state("partialEnlarged")?(w.videoBar("hideItem","video_ivsRule"),s.$("#video_ivsRule").hasClass("current")&&(s.$("#video_ivsRule").removeClass("current"),s.$("#video_ivsRule").toggleClass("currentflag")),w.videoBar("isCurrent","video_ivsRule",0)&&o.SetIVSEnable(!1),w.videoBar("isCurrent","video_fisheye")&&w.videoBar("toggleCurrent","video_fisheye")):p.is("DSPConflict").done(function(a){if(!a){var b=!1,c=!1;n.ConfigManager.getConfig(["EncodeCrop"]).done(function(a){a[0].result&&(b=a[0].params.table[0].Extra1.Enable,c=a[0].params.table[0].Extra2.Enable),s.$("[btn-for=onConnectMain]").hasClass("current")?w.videoBar("hideItem","video_ivsRule",!1):s.$("[btn-for=onConnectExtra]").hasClass("current")?w.videoBar("hideItem","video_ivsRule",b):s.$("[btn-for=onConnectExtra2]").hasClass("current")&&w.videoBar("hideItem","video_ivsRule",c),w.videoBar("isCurrent","video_ivsRule",0)&&o.SetIVSEnable(!0)}).fail(function(){s.$("[btn-for=onConnectExtra1]").hasClass("current")?w.videoBar("hideItem","video_ivsRule",b):s.$("[btn-for=onConnectExtra2]").hasClass("current")&&w.videoBar("hideItem","video_ivsRule",c),w.videoBar("isCurrent","video_ivsRule",0)&&o.SetIVSEnable(!0)}),s.$("#video_ivsRule").hasClass("currentflag")&&(s.$("#video_ivsRule").toggleClass("current"),s.$("#video_ivsRule").removeClass("currentflag")),w.videoBar("hideItem","video_ivsRule",!1),w.videoBar("isCurrent","video_ivsRule",0)&&o.SetIVSEnable(!0)}})})},onDirAdjust:function(){n.PTZ.directionCalibration()},onRegionFocus:function(){o.activeLocalFocus(s.$("[btn-for=onRegionFocus]"))},onZoneExpose:function(){o.activeZoneExpose(s.$("[btn-for=onZoneExpose]"))},onDuckColorClick1:function(){o.messageMarkColorClick(1)},onDuckColorClick2:function(){o.messageMarkColorClick(2)},onDuckColorClick3:function(){o.messageMarkColorClick(3)},onDuckDrawnClick:function(){o.messageMarkDuckDrawnClick()},onDuckClick:function(){o.messageMarkDuckClick(s.$("[btn-for=onDuckClick]"))},onFigure:function(){o.enableMousePtz(s.$("[btn-for=onFigure]"))},onMeasureDistance:function(){o.activeMeasureDistance(s.$("[btn-for=onMeasureDistance]"))},onFixedFocus:function(){n.ThermographyManager.fixFocus(0,[0,1],0)},onCutResolute:function(){o.cutResolute(s.$("[btn-for=onCutResolute]"))},onChangeResolute:function(b){var c=a(b.target).val(),d=c.split("x");o.SetCalWndSize(d[0]-0,d[1]-0)}});var L=null,M=!1,N={support:!1,login:!1,init:function(){p.get("WideViewControl").done(function(a){a&&a[0]&&a[0].Support&&(N.support=!0,N._loginWideView(),N.render())})},render:function(){N.support&&n.ConfigManager.getConfig("WideViewControl").done(function(a){N.config=a,(N.config&&N.config[0].Enable&&""!==o.type)!==w.videoBar("isCurrent","video_wideview")&&w.videoBar("toggleCurrent","video_wideview")})},leave:function(){N.support&&w.videoBar("isCurrent","video_wideview")&&w.videoBar("toggleCurrent","video_wideview")},destory:function(){N.support&&N.login&&o.LogoutWideView()},_loginWideView:function(){N.login!==!0&&o.LoginWideView(o.ip,o.port,q.getLoginInfo().username,q.getLoginInfo().password,0).done(function(b){if(b){var c={1:tl("Password is error."),2:tl("The user is not exited."),3:tl("Login is overtime."),4:tl("The user has logined."),5:tl("The user is locked."),6:tl("The user is invalid."),7:tl("System is busying."),8:tl("Sub Connect Fail"),9:tl("Main Connect Fail"),10:tl("the number of connection is maximal.request is refused!")};o.hide(),a.alert(tl("WideView")+c[b]||tl("Login control failure!"),function(){o.cover(s.$(".main-video"))})}else N.login=!0})}}})}(jQuery);