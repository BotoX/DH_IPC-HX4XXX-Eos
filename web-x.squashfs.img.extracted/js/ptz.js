!function(a){define(function(require,b,c){function d(){e(),"Original Rate"===webApp.DisplayMode&&setTimeout(e,100)}function e(){var a=10,b=i.$(".main-right-container").width()||-10,c=i.$(".main-bottom").width(),d=i.$(".main-right-container").parent(),e=c-a-b,g=Math.max(document.documentElement.clientHeight-56-54-33,390),h=webApp.DisplayMode;switch(l.videoBar("hasItem","video_triggerTrack")&&"Original Rate"==webApp.DisplayMode&&(h="adapted window"),l.videoBar("hasItem","video_fisheye")&&"Original Rate"==webApp.DisplayMode&&(h="adapted window"),h){case"Original Size":Video.resolution.x&&Video.resolution.y&&("nacl"!==f.type||e>=Video.resolution.x)&&(e=Video.resolution.x,g=Video.resolution.y),d.css({width:e+a+b,margin:"0 auto"});break;case"Original Rate":e=c-a-b,e/Video.rate<g?g=e/Video.rate:e=g*Video.rate,d.css({width:e+a+b,margin:"0 auto"});break;default:d.css({width:c,margin:"0"})}return k.css({width:e,height:g,background:"inherit"}),l.css("width",e),n||f.cover(k),!1}var f=(require("jsCore/rpc"),require("jsCore/plugin")),g=(require("jsCore/ability"),require("common/common").Cookie,require("jsCore/rpcLogin")),h=require("jsCore/pageBase");require("jsCore/modules/ptzControl"),require("jsCore/modules/ptzSetting"),require("jsCore/modules/zoomFocus"),require("jsCore/modules/videoBar");var i=null,j=".ptz",k=null,l=null,m=null;c.exports=h.extend({init:function(){i=this,k=i.$(".main-video"),l=i.$(".ui-video-bar").videoBar(),m=i.$(".main-ptz-control").ptzControl({ptzJoystick:-1!==webApp.DeviceType.indexOf("TPC")||-1!==webApp.DeviceType.indexOf("IPC")?!1:!0,autoFocus:!1,isPtzLocate:-1!==webApp.DeviceType.indexOf("TPC")&&-1!==webApp.DeviceType.indexOf("SD")||webApp.HasPtz,isLaserDistMeasure:!1,channel:f.windowId}),i.$(".main-ptz-setting").ptzSetting(),i.$(".main-zoom-focus").zoomFocus({type:"preview"}),i.render()},render:function(){a(window).off("resize"+j),a(window).on("resize"+j,d),i.$(".main-ptz-setting").ptzSetting("render"),l.videoBar("render",{showImage:!1,showTrigger:!1,showPtz:g.chkAuthority("MPTZ")&&webApp.HasPtz&&-1!==webApp.DeviceType.indexOf("SD"),showRayRight:!1,showTemperReport:!1,showWhRate:-1!==webApp.DeviceType.indexOf("IPC")?!0:!1,showZoomFocus:!1,showOriginal:-1!==webApp.DeviceType.indexOf("IPC")?!0:!1,showFluency:-1!==webApp.DeviceType.indexOf("IPC")?!0:!1,showFullScreeny:-1!==webApp.DeviceType.indexOf("IPC")?!0:!1,showAdjust:!1,modeChange:d,zoomOn:function(){i.$(".main-zoom-focus").zoomFocus("render").show()},zoomOff:function(){i.$(".main-zoom-focus").zoomFocus("leave").hide()}}),l.videoBar("isCurrent","video_zoomFocus")?i.$(".main-zoom-focus").zoomFocus("render").show():i.$(".main-zoom-focus").zoomFocus("leave").hide(),f.cover(k,function(b){f.SetModuleMode(0);var c=a(b?"a[btn-for=onConnectMain]":"a.current[btn-for^=onConnect]");a("a[btn-for^=onConnect]").removeClass("current"),c=a("a[btn-for=onConnectMain]"),c.click(),l.videoBar("isCurrent","video_ivsRule",0)?f.SetIVSEnable(!0):l.videoBar("hasItem","video_triggerTrack")&&(f.SetIVSEnable(!0),f.ShowRuleState(!1))}),f.addEvent("ResolutionChangePTZ",d),f.addEvent("DeviceReconnectedPTZ",function(){l.videoBar("isCurrent","video_ivsRule",0)&&f.SetIVSEnable(!0)}),webApp.hideIVS===!0?i.$("#video_ivsRule").parent("div").hide():webApp.hideIVS===!1&&i.$("#video_ivsRule").parent("div").show(),d()},leave:function(){a(window).off("resize"+j),l.videoBar("isCurrent","video_zoomFocus")&&i.$(".main-zoom-focus").zoomFocus("leave").hide(),f.SetIVSEnable(!1),f.hide(),f.close(),f.addEvent("ResolutionChangePTZ",null),f.addEvent("DeviceReconnectedPTZ",null),f.state("activePTZLocate")&&f.state("activePTZLocate",!1)},destory:function(){a(window).off("resize"+j),l.videoBar("isCurrent","video_zoomFocus")&&i.$(".main-zoom-focus").zoomFocus("leave").hide(),l.videoBar("destroy")}});var n=!1})}(jQuery);