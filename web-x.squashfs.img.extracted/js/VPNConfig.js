!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("vpn",function(require,b,c){var d=require("jsCore/pageBase"),e=require("jsCore/rpc"),f=require("common/common"),g=f.Check,h=null,i=null,j=null,k=null;c.exports=d.extend({init:function(){var b=this;i=b.$("#vpn_address").ipfield({}),(a.browser.webkit||a.browser.msie)&&b.$(".vpn_cert_file").show(),isEnable("is_show_VPN_Certificate")?b.$(".vpn_certificate").show():b.$(".vpn_certificate").hide(),j=b.$("[cfg=Port]").numberfield({max:65535,min:1,allowDecimal:!1,allowNegative:!1}),k=a.validator([{element:b.$("[cfg=UserName]"),check:[g.noQuotation,g.noQuotation,g.require,g.require],errorMsg:["w_noInputMarks","w_noInputMarks","w_Need","w_Need"],events:["keyup","blur","keyup","blur"]},{element:b.$("[cfg=Password]"),check:[g.noQuotation,g.noQuotation],errorMsg:["w_noInputMarks","w_noInputMarks"],events:["keyup","blur"]}],function(a){a.parent().translation()}),b.$(".vpn_cert_file").mouseover(function(a){b.$(a.target).closest("form").find(".vpn_cert_browser").addClass("ui-button-hover")}).mouseout(function(a){b.$(a.target).closest("form").find(".vpn_cert_browser").removeClass("ui-button-hover")}).change(function(a){var c=b.$(a.target).val().split(/\\|\//),d=b.$(a.target).closest("form");d.find(".vpn_cert_path").val(c[c.length-1]),d.find(".vpn_cert_browser").blur(),d.find(".vpn_cert_file").blur()}),b.$(".vpn_cert_browser").click(function(a){b.$(a.target).closest("form").find(".vpn_cert_file").click(),b.$(a.target).blur()}),b.$(".vpn_cert_upload").click(function(a){var c=b.$(a.target).closest("form"),d=c.find(".vpn_cert_file").val();/\.crt$|\.key$/.test(d.toLowerCase())?c.find(".vpn_cert_submit").click():b.tip("warning","Bad file format!")}),b.render()},render:function(){e.ConfigManager.getConfig("VPN").done(function(a){VPN=a,h._renderElements()})},_renderElement:function(){i.ipfield("value",VPN.eth0.Address),a.each(h.$("[cfg]"),function(a,b){"checkbox"===h.$(b).prop("type")?h.$(b).prop("checked",VPN.eth0[h.$(b).prop("cfg")]):h.$(b).val(VPN.eth0[h.$(b).prop("cfg")]||"")}),isEnable("is_show_VPN_Certificate")&&h.onSelAuthMethod(),k.validate()},onSelAuthMethod:function(){h.$(".vpn_mode_user_wrap, .vpn_mode_pki_wrap").hide(),"USER"===h.$("[sel-for=onSelAuthMethod]").val()?h.$(".vpn_mode_user_wrap").show():h.$(".vpn_mode_pki_wrap").show()},onDefault:function(){e.ConfigManager.getDefault("VPN").done(function(a){VPN=a,h._renderElements(),h.tip("success","Defaultsuccess")}).fail(function(){h.tip("error","Defaultfailure")})},onRefresh:function(){e.ConfigManager.getConfig("VPN").done(function(a){VPN=a,h._renderElements(),h.tip("success","Operateingsuccess")}).fail(function(){h.tip("error","Operateingfailure")})},onConfirm:function(){return VPN.eth0.Address=i.ipfield("value"),VPN.eth0.Enable=h.$("[cfg=Enable]").is(":checked"),VPN.eth0.Port=j.numberfield("value"),VPN.eth0.UserName=h.$("[cfg=UserName]").val(),VPN.eth0.SslEnable=h.$("[cfg=SslEnable]").is(":checked"),VPN.eth0.Password=h.$("[cfg=Password]").val(),isEnable("is_show_VPN_Certificate")&&(VPN.eth0.AuthMethod=h.$("[cfg=AuthMethod]").val(),VPN.eth0.LzoEnable=h.$("[cfg=LzoEnable]").is(":checked")),"USER"===h.$("[cfg=AuthMethod]").val()&&k.isInvalid()?h.tip("warning",k.errors()[0].errorMsg):void e.ConfigManager.setConfig("VPN",VPN).done(function(){h.tip("success","Succeed in saving configure")}).fail(function(){h.tip("error","Saving failure")})}})})}(jQuery);