!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("Conn-Connect",function(require,b,c){function d(a,b){var c=b.attr("id"),d=b.attr("exceptport")-0;return!v.chkPort(a,d)||"con_udp_port"===c&&a===k.numberfield("value")-1||"con_http_port"===c&&a===k.numberfield("value")-1||"con_rtsp_port"===c&&a===k.numberfield("value")-1?!1:!0}function e(a,b){for(var c=0;c<q.length;++c)if(b[0]!==q[c]&&a===q[c].value)return!1;return!0}var f,g,h,i,j,k,l,m,n,o,p,q,r,s=require("jsCore/pageBase"),t=require("jsCore/rpc"),u=require("common/rpcBase"),v=require("common/common");c.exports=s.extend({init:function(){var b=this;j=b.$("#con_max_cons").numberfield({max:20,min:1,allowDecimal:!1,allowNegative:!1}),webApp.GongAnDetect&&(b.$("#con_max_cons").numberfield("max",28),b.$("#con_max_20").addClass("fn-hide"),b.$("#con_max_28").removeClass("fn-hide")),isEnable("is_hide_connectHttpsEnable")&&b.$("#https_enable_wrap").addClass("fn-hide"),k=b.$("#con_tcp_port"),l=b.$("#con_udp_port"),m=b.$("#con_http_port"),n=b.$("#con_rtsp_port"),o=b.$("#con_https_port"),p=b.$("#con_https_enable"),q=b.$("input[name=ports]"),q.numberfield({max:65534,allowDecimal:!1,allowNegative:!1}),p.on("change",function(){i.ServerCertificate&&""===i.ServerCertificate.CommonName&&(b.tip("error","w_CertificateNotAvailible"),p.prop("checked",i.Enable))}),r=a.validator([{element:k,check:[e,d],errorMsg:["w_f_port_same","Port in use!"],events:["blur","blur"],errorElem:".u-input-error"},{element:l,check:[e,d],errorMsg:["w_f_port_same","Port in use!"],events:["blur","blur"],errorElem:".u-input-error"},{element:m,check:[e,d],errorMsg:["w_f_port_same","Port in use!"],events:["blur","blur"]},{element:n,check:[e,d],errorMsg:["w_f_port_same","Port in use!"],events:["blur","blur"]},{element:o,check:[e,d],errorMsg:["w_f_port_same","Port in use!"],events:["blur","blur"]}],function(a){a.parent().translation()}),b.render()},render:function(){this._getConfig()},_render:function(a,b,c,d){j.numberfield("value",a.MaxConnections),k.numberfield("value",a.TCPPort),l.numberfield("value",a.UDPPort),m.numberfield("value",b.Port),n.numberfield("value",c.Port),o.numberfield("value",d.Port),p.prop("checked",d.Enable),"https:"===window.location.protocol.toLowerCase()&&p.prop("disabled",!0),r.validate()},_getConfig:function(a){var b=this;t.ConfigManager.getConfig(["DVRIP","Web","RTSP","Https"]).done(function(c){f=c[0].params.table,g=c[1].params.table,h=c[2].params.table,i=c[3].params.table,b._render(f,g,h,i),a&&b.tip("success","Operateingsuccess"),b.disabled("[btn-for=onSave]",!1)}).fail(function(){b.tip("error","Operateingfailure"),b.disabled("[btn-for=onSave]",!0)})},onSave:function(){var a=this;return r.isInvalid()?a.tip("warning",r.errors()[0].errorMsg):void t.ConfigManager.getConfig("DVRIP").done(function(b){f=b,f.MaxConnections=j.numberfield("value"),i.Enable=p.prop("checked"),f.TCPPort=k.numberfield("value"),f.UDPPort=l.numberfield("value"),g.Port=m.numberfield("value"),i.Port=o.numberfield("value"),h.Port=n.numberfield("value"),t.ConfigManager.setConfig(["DVRIP","Web","RTSP"],[f,g,h]).done(function(b){v.chkMutilCallRet(b)?(a.tip("success","Succeed in saving configure"),webApp.isNeedReboot(b)&&webApp.reboot("The configration take effect! The device is restarting now,please reconnect later...")):a.tip("error","Saving failure")}),i.Enable&&i.ServerCertificate?u.CertManager.getSvrCertInfo().done(function(){t.ConfigManager.setConfig("Https",i).done(function(b){a.tip("success","Succeed in saving configure"),webApp.isNeedReboot(b)&&webApp.reboot("The configration take effect! The device is restarting now,please reconnect later...")}).fail(function(){a.tip("error","Saving failure")}),a.tip("success","Succeed in saving configure")}).fail(function(){a.tip("error","w_CertificateNotAvailible")}):t.ConfigManager.setConfig("Https",i).done(function(b){a.tip("success","Succeed in saving configure"),webApp.isNeedReboot(b)&&webApp.reboot("The configration take effect! The device is restarting now,please reconnect later...")}).fail(function(){a.tip("error","Saving failure")})})},onRefresh:function(){this._getConfig(!0)},onDefault:function(){var a=this;t.ConfigManager.getDefault(["DVRIP","Web","RTSP","Https"]).done(function(b){var c=i;if(f=b[0].params.table,g=b[1].params.table,h=b[2].params.table,i=b[3].params.table,isEnable("is_hide_connectHttpsEnable")){var d=c;c=i,i=d,i.Port=c.Port}a._render(f,g,h,i),a.disabled("[btn-for=onSave]",!1),a.tip("success","Defaultsuccess")}).fail(function(){a.disabled("[btn-for=onSave]",!0),a.tip("error","Defaultfailure")})}})}),define("Conn-Onvif",function(require,a,b){var c,d=require("jsCore/rpc"),e=require("jsCore/pageBase");b.exports=e.extend({init:function(){var a=this;a.render()},render:function(){this._getConfig()},_render:function(a){this.$("input[name=ra_login][loginchk="+(a.OnvifLoginCheck?1:0)+"]").prop("checked",!0)},_getConfig:function(a){var b=this;d.ConfigManager.getConfig("UserGlobal").done(function(d){c=d||{},b._render(c),b.disabled("[btn-for=onSave]",!1),a&&b.tip("success","Operateingsuccess")}).fail(function(){b.disabled("[btn-for=onSave]",!0),b.tip("error","Operateingfailure")})},onSave:function(){var a=this;c.OnvifLoginCheck=!!(a.$("input[name=ra_login]:checked").attr("loginchk")-0),d.ConfigManager.setConfig("UserGlobal",c).done(function(){a.tip("success","Succeed in saving configure")}).fail(function(){a.tip("error","Saving failure")})},onRefresh:function(){this._getConfig(!0)},onDefault:function(){var a=this;d.ConfigManager.getDefault("UserGlobal").done(function(b){c=b||{},a._render(c),a.disabled("[btn-for=onSave]",!1),a.tip("success","Defaultsuccess")}).fail(function(){a.disabled("[btn-for=onSave]",!0),a.tip("error","Defaultfailure")})}})})}(jQuery);